# üìä API Endpoints Decision Matrix

**Stand:** [Workshop-Datum]  
**Teilnehmer:** [Namen der Entscheider]

## üéØ Entscheidungs-Kategorien

- **KEEP** ‚úÖ - Endpoint bleibt unver√§ndert
- **DEPRECATE** ‚ö†Ô∏è - Endpoint wird auslaufen
- **CHANGE** üîÑ - Breaking Change erforderlich
- **ADD** ‚ûï - Neuer Endpoint wird hinzugef√ºgt
- **REMOVE** ‚ùå - Endpoint wird entfernt

## üìä Decision Matrix

### üîê Authentication Endpoints

| Current Endpoint        | Test Expectation | Decision | New Endpoint | Priority | Migration Effort | Notes            |
| ----------------------- | ---------------- | -------- | ------------ | -------- | ---------------- | ---------------- |
| POST /api/auth/login    | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Funktioniert gut |
| POST /api/auth/register | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK      |
| POST /api/auth/logout   | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK      |
| GET /api/auth/validate  | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK      |

### üìÖ Calendar API

| Current Endpoint         | Test Expectation                          | Decision      | New Endpoint                              | Priority   | Migration Effort | Notes                  |
| ------------------------ | ----------------------------------------- | ------------- | ----------------------------------------- | ---------- | ---------------- | ---------------------- |
| GET /api/calendar        | GET /api/calendar/events                  | **CHANGE** üîÑ | GET /api/calendar/events                  | **HIGH**   | Medium           | Tests erwarten /events |
| POST /api/calendar       | POST /api/calendar/events                 | **CHANGE** üîÑ | POST /api/calendar/events                 | **HIGH**   | Medium           | Konsistenz wichtig     |
| GET /api/calendar/:id    | GET /api/calendar/events/:id              | **CHANGE** üîÑ | GET /api/calendar/events/:id              | **HIGH**   | Medium           | RESTful pattern        |
| PUT /api/calendar/:id    | PUT /api/calendar/events/:id              | **CHANGE** üîÑ | PUT /api/calendar/events/:id              | **HIGH**   | Medium           | RESTful pattern        |
| DELETE /api/calendar/:id | DELETE /api/calendar/events/:id           | **CHANGE** üîÑ | DELETE /api/calendar/events/:id           | **HIGH**   | Medium           | RESTful pattern        |
| -                        | GET /api/calendar/availability            | **ADD** ‚ûï    | GET /api/calendar/availability            | **MEDIUM** | Low              | Neues Feature          |
| -                        | GET /api/calendar/availability/free-slots | **ADD** ‚ûï    | GET /api/calendar/availability/free-slots | **LOW**    | Low              | Nice to have           |

**Migration Notes:**

- Response format √§ndern: `data.eventId` statt komplettes Event
- Field names: `visibility_scope` ‚Üí `org_level`

### üí¨ Chat API

| Current Endpoint                          | Test Expectation              | Decision    | New Endpoint                  | Priority   | Migration Effort | Notes                    |
| ----------------------------------------- | ----------------------------- | ----------- | ----------------------------- | ---------- | ---------------- | ------------------------ |
| POST /api/chat/conversations              | POST /api/chat/channels       | **KEEP** ‚úÖ | -                             | -          | -                | Conversations ist besser |
| GET /api/chat/conversations               | GET /api/chat/channels        | **KEEP** ‚úÖ | -                             | -          | -                | Tests anpassen           |
| GET /api/chat/conversations/:id           | -                             | **KEEP** ‚úÖ | -                             | -          | -                | Gut so                   |
| POST /api/chat/conversations/:id/messages | POST /api/chat/messages       | **KEEP** ‚úÖ | -                             | -          | -                | Nested ist korrekt       |
| -                                         | GET /api/chat/messages        | **ADD** ‚ûï  | GET /api/chat/messages        | **LOW**    | Medium           | F√ºr globale Suche        |
| -                                         | PUT /api/chat/messages/:id    | **ADD** ‚ûï  | PUT /api/chat/messages/:id    | **MEDIUM** | Low              | Edit Feature             |
| -                                         | DELETE /api/chat/messages/:id | **ADD** ‚ûï  | DELETE /api/chat/messages/:id | **MEDIUM** | Low              | Delete Feature           |
| PUT /api/chat/conversations/:id/read      | -                             | **KEEP** ‚úÖ | -                             | -          | -                | Sinnvolle Action         |
| GET /api/chat/attachments/:filename       | -                             | **KEEP** ‚úÖ | -                             | -          | -                | Standard OK              |
| GET /api/chat/users                       | -                             | **KEEP** ‚úÖ | -                             | -          | -                | Hilfreich                |
| GET /api/chat/unread-count                | -                             | **KEEP** ‚úÖ | -                             | -          | -                | Performance              |

**Migration Notes:**

- Tests m√ºssen "conversations" akzeptieren, nicht "channels"
- Message endpoints als Erg√§nzung, nicht Ersatz

### üë• Employee/Admin API

| Current Endpoint                            | Test Expectation | Decision         | New Endpoint               | Priority   | Migration Effort | Notes                    |
| ------------------------------------------- | ---------------- | ---------------- | -------------------------- | ---------- | ---------------- | ------------------------ |
| POST /api/admin/employees                   | ‚úÖ Matches       | **KEEP**         | -                          | -          | None             | Standard OK              |
| GET /api/admin/employees                    | ‚úÖ Matches       | **KEEP**         | -                          | -          | None             | Standard OK              |
| GET /api/admin/employees/:id                | ‚úÖ Matches       | **KEEP**         | -                          | -          | None             | Standard OK              |
| PUT /api/admin/employees/:id                | ‚úÖ Matches       | **KEEP**         | -                          | -          | None             | Standard OK              |
| POST /api/admin/upload-document/:employeeId | -                | **DEPRECATE** ‚ö†Ô∏è | POST /api/documents/upload | **MEDIUM** | High             | Zu documents verschieben |
| GET /api/admin/dashboard-stats              | ‚úÖ Matches       | **KEEP**         | -                          | -          | None             | N√ºtzlich                 |

### üìã Blackboard API

| Current Endpoint     | Test Expectation           | Decision   | New Endpoint               | Priority | Migration Effort | Notes          |
| -------------------- | -------------------------- | ---------- | -------------------------- | -------- | ---------------- | -------------- |
| GET /api/blackboard  | ‚úÖ Matches                 | **KEEP**   | -                          | -        | None             | Funktioniert   |
| POST /api/blackboard | ‚úÖ Matches                 | **KEEP**   | -                          | -        | None             | Multipart OK   |
| -                    | PUT /api/blackboard/:id    | **ADD** ‚ûï | PUT /api/blackboard/:id    | **LOW**  | Low              | Update Feature |
| -                    | DELETE /api/blackboard/:id | **ADD** ‚ûï | DELETE /api/blackboard/:id | **LOW**  | Low              | Delete Feature |

### üí° KVP API

| Current Endpoint           | Test Expectation | Decision | New Endpoint | Priority | Migration Effort | Notes           |
| -------------------------- | ---------------- | -------- | ------------ | -------- | ---------------- | --------------- |
| GET /api/kvp               | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK     |
| POST /api/kvp              | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK     |
| GET /api/kvp/categories    | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Hilfreich       |
| GET /api/kvp/stats         | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Dashboard       |
| GET /api/kvp/:id           | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Standard OK     |
| GET /api/kvp/:id/comments  | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Sub-resource OK |
| POST /api/kvp/:id/comments | ‚úÖ Matches       | **KEEP** | -            | -        | None             | Sub-resource OK |

### üìÖ Shifts API

| Current Endpoint          | Test Expectation  | Decision       | New Endpoint | Priority | Migration Effort | Notes              |
| ------------------------- | ----------------- | -------------- | ------------ | -------- | ---------------- | ------------------ |
| GET /api/shifts/templates | ?                 | **ANALYZE** üîç | TBD          | **HIGH** | Unknown          | Tests analysieren  |
| GET /api/shifts/plans     | ?                 | **ANALYZE** üîç | TBD          | **HIGH** | Unknown          | Tests analysieren  |
| -                         | Various endpoints | **ANALYZE** üîç | TBD          | **HIGH** | Unknown          | 60/66 Tests failed |

### üè¢ Departments & Teams API

| Current Endpoint         | Test Expectation | Decision | New Endpoint | Priority | Migration Effort | Notes      |
| ------------------------ | ---------------- | -------- | ------------ | -------- | ---------------- | ---------- |
| All department endpoints | ‚úÖ Matches       | **KEEP** | -            | -        | None             | RESTful OK |
| All team endpoints       | ‚úÖ Matches       | **KEEP** | -            | -        | None             | RESTful OK |

## üìà Priorisierung

### üî¥ Critical (Sofort)

- Keine identifiziert

### üü† High Priority (Sprint 1-2)

1. Calendar API Migration zu `/events`
2. Shifts API Analyse und Fixes
3. Validation Error Format vereinheitlichen

### üü° Medium Priority (Sprint 3-4)

1. Chat message edit/delete endpoints
2. Document upload consolidation
3. Calendar availability features

### üü¢ Low Priority (Backlog)

1. Blackboard edit/delete
2. Global message search
3. Calendar free-slots

## üí∞ Impact Analysis

### Frontend Impact

| Area       | Affected Components     | Effort | Risk   |
| ---------- | ----------------------- | ------ | ------ |
| Calendar   | CalendarView, EventForm | HIGH   | Medium |
| Chat       | Tests only              | LOW    | Low    |
| Validation | All forms               | MEDIUM | Low    |

### Backend Impact

| Area            | Affected Code      | Effort | Risk |
| --------------- | ------------------ | ------ | ---- |
| Calendar Routes | 5 endpoints        | MEDIUM | Low  |
| Response Format | Middleware         | LOW    | Low  |
| Tests           | All calendar tests | HIGH   | Low  |

## üöÄ Migration Plan

### Phase 1: Preparation (Week 1)

- [ ] Update OpenAPI Spec
- [ ] Create migration guide
- [ ] Setup feature flags

### Phase 2: Backend (Week 2-3)

- [ ] Implement new endpoints
- [ ] Add deprecation headers
- [ ] Update tests

### Phase 3: Frontend (Week 3-4)

- [ ] Update API calls
- [ ] Test thoroughly
- [ ] Update documentation

### Phase 4: Cleanup (Week 5)

- [ ] Remove old endpoints
- [ ] Final testing
- [ ] Go-live

## üìù Notes & Discussions

### Calendar API

- **Pro RESTful:** Klare Struktur, Standard-konform
- **Contra:** Breaking Change f√ºr Frontend
- **Entscheidung:** Migration wert f√ºr Konsistenz

### Chat Terminology

- **"Conversations" vs "Channels":** Conversations ist moderner
- **Entscheidung:** Bei Conversations bleiben, Tests anpassen

### Validation Errors

- **"field" vs "path":** Field ist klarer f√ºr Frontend
- **Entscheidung:** Auf "field" standardisieren

## ‚úÖ Action Items

| Action                   | Owner         | Due Date | Status |
| ------------------------ | ------------- | -------- | ------ |
| Update OpenAPI Spec      | Backend Lead  | [Date]   | üî≤     |
| Create Migration Guide   | Tech Lead     | [Date]   | üî≤     |
| Update Calendar Tests    | QA Lead       | [Date]   | üî≤     |
| Frontend Impact Analysis | Frontend Lead | [Date]   | üî≤     |
| Communication Plan       | Product Owner | [Date]   | üî≤     |

---

**Letztes Update:** [Timestamp]  
**N√§chstes Review:** [Date]
