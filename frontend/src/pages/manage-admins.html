<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin-Verwaltung - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Critical Layout State - Prevents Layout Shift -->
    <script src="/scripts/critical/sidebar-init.js"></script>

    <!-- Unified Navigation CSS - Load immediately to prevent FOUC -->
    <link rel="stylesheet" href="/styles/unified-navigation.css" />
    <!-- Dashboard Styles -->
    <link rel="stylesheet" href="/styles/dashboard-theme.css" />
    <link rel="stylesheet" href="/styles/breadcrumb-alignment.css" />
    <link rel="stylesheet" href="/styles/manage-admins.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />

    <!-- Common Scripts with ApiClient -->
    <script type="module" src="/scripts/common.js"></script>
  </head>
  <body>
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Breadcrumb -->
        <div id="breadcrumb-container"></div>

        <div class="container">
          <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center">
              <div>
                <h2 class="card-title">Admin-Verwaltung</h2>
                <p class="text-secondary">Verwalten Sie alle Administratoren im System</p>
              </div>
            </div>

            <div class="table-responsive">
              <div id="admins-loading" class="loading u-hidden">
                <div class="spinner"></div>
                <p>Administratoren werden geladen...</p>
              </div>

              <div id="admins-table-content">
                <!-- Tabelle wird hier dynamisch eingef√ºgt -->
              </div>

              <div id="admins-empty" class="empty-state u-hidden">
                <div class="empty-state-icon">üë•</div>
                <div class="empty-state-title">Keine Administratoren gefunden</div>
                <div class="empty-state-text">Erstellen Sie Ihren ersten Administrator, um das System zu verwalten.</div>
              </div>
            </div>
          </div>
          <!-- End of card -->
        </div>
        <!-- End of container -->
      </main>
    </div>

    <!-- Add/Edit Admin Modal -->
    <div id="admin-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="admin-modal-title">Neuer Administrator</h3>
          <button class="modal-close" id="close-admin-modal">&times;</button>
        </div>
        <form id="admin-form">
          <div class="modal-body">
            <input type="hidden" id="admin-id" />

            <div class="form-group">
              <label class="form-label" for="admin-first-name">Vorname *</label>
              <input type="text" id="admin-first-name" name="firstName" class="form-control" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="admin-last-name">Nachname *</label>
              <input type="text" id="admin-last-name" name="lastName" class="form-control" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="admin-email">E-Mail *</label>
              <input type="email" id="admin-email" name="email" class="form-control" required />
            </div>

            <div class="form-group" id="email-confirm-group">
              <label class="form-label" for="admin-email-confirm">E-Mail wiederholen *</label>
              <input type="email" id="admin-email-confirm" name="emailConfirm" class="form-control" required />
              <small class="text-danger u-hidden" id="email-error">E-Mail-Adressen stimmen nicht √ºberein</small>
            </div>

            <div class="form-group" id="password-group">
              <label class="form-label" for="admin-password">Passwort *</label>
              <input type="password" id="admin-password" name="password" class="form-control" />
            </div>

            <div class="form-group" id="password-confirm-group">
              <label class="form-label" for="admin-password-confirm">Passwort wiederholen *</label>
              <input type="password" id="admin-password-confirm" name="passwordConfirm" class="form-control" />
              <small class="text-danger u-hidden" id="password-error">Passw√∂rter stimmen nicht √ºberein</small>
            </div>

            <div class="form-group">
              <label class="form-label" for="admin-employee-number">Personalnummer *</label>
              <input
                type="text"
                id="admin-employee-number"
                name="employeeNumber"
                class="form-control"
                placeholder="z.B. ABC-123 oder 2025-001"
                maxlength="10"
                pattern="[A-Za-z0-9\-]{1,10}"
                required
              />
              <small class="form-text text-secondary">Max. 10 Zeichen (Buchstaben, Zahlen, Bindestrich)</small>
            </div>

            <div class="form-group">
              <label class="form-label" for="admin-position">Position *</label>
              <select id="admin-position" name="position" class="form-control" required>
                <option value="">Bitte w√§hlen...</option>
                <option value="bereichsleiter">Bereichsleiter</option>
                <option value="personalleiter">Personalleiter</option>
                <option value="geschaeftsfuehrer">Gesch√§ftsf√ºhrer</option>
                <option value="werksleiter">Werksleiter</option>
                <option value="produktionsleiter">Produktionsleiter</option>
                <option value="qualitaetsleiter">Qualit√§tsleiter</option>
                <option value="it-leiter">IT-Leiter</option>
                <option value="vertriebsleiter">Vertriebsleiter</option>
                <option value="mitarbeiter">Mitarbeiter</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="admin-notes">Notizen</label>
              <textarea id="admin-notes" name="notes" class="form-control" rows="3"></textarea>
            </div>

            <div class="form-group" id="active-status-group" style="display: none">
              <label class="checkbox-label">
                <input type="checkbox" id="admin-is-active" name="isActive" checked />
                <span class="checkbox-text">Aktiv</span>
              </label>
              <small class="form-text text-secondary">Deaktivierte Administratoren k√∂nnen sich nicht anmelden</small>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-admin-modal">Abbrechen</button>
            <button type="submit" class="btn btn-primary">Speichern</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-admin-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Administrator l√∂schen</h3>
          <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>M√∂chten Sie diesen Administrator wirklich l√∂schen?</p>
          <p class="text-secondary">Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.</p>
          <input type="hidden" id="delete-admin-id" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancel-delete-modal">Abbrechen</button>
          <button type="button" class="btn btn-danger" id="confirm-delete-admin">L√∂schen</button>
        </div>
      </div>
    </div>

    <!-- Permissions Modal -->
    <div id="permissions-modal" class="modal">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h3 class="modal-title">Abteilungsberechtigungen verwalten</h3>
          <button class="modal-close" id="close-permissions-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="admin-info-box">
            <p>
              <strong>Administrator:</strong>
              <span id="perm-admin-name"></span>
            </p>
            <p>
              <strong>E-Mail:</strong>
              <span id="perm-admin-email"></span>
            </p>
          </div>

          <div class="form-group">
            <label class="form-label">Berechtigungstyp</label>
            <div class="permission-type-selection">
              <label class="radio-label">
                <input type="radio" name="permission-type" value="none" checked />
                <span class="radio-text">Keine Abteilungen</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="permission-type" value="specific" />
                <span class="radio-text">Spezifische Abteilungen</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="permission-type" value="all" />
                <span class="radio-text">Alle Abteilungen</span>
              </label>
            </div>
          </div>

          <div id="department-select-container" class="form-group" style="display: none">
            <label class="form-label">Abteilungen ausw√§hlen</label>
            <select id="department-select" multiple class="form-control" style="min-height: 150px">
              <!-- Wird dynamisch bef√ºllt -->
            </select>
            <small class="form-text text-secondary">Halten Sie Strg/Cmd gedr√ºckt f√ºr Mehrfachauswahl</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancel-permissions-modal">Abbrechen</button>
          <button type="button" class="btn btn-primary" id="save-permissions">Speichern</button>
        </div>
      </div>
    </div>

    <!-- Floating Add Button -->
    <button id="add-admin-btn" class="add-admin-btn">+</button>

    <!-- Navigation Components -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
    <script type="module" src="/scripts/auth/role-switch.ts"></script>
    <!-- Breadcrumb -->
    <script type="module" src="/scripts/components/breadcrumb.js"></script>

    <!-- Page Script -->
    <script type="module" src="/scripts/manage/admins/index.ts"></script>
  </body>
</html>
