<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Umfrage-Verwaltung - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Critical Layout State - Prevents Layout Shift -->
    <script>
      // Set sidebar state IMMEDIATELY to prevent any layout shift
      (function () {
        const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        document.documentElement.setAttribute('data-sidebar', sidebarCollapsed ? 'collapsed' : 'expanded');
        // Also set CSS custom properties for immediate use
        document.documentElement.style.setProperty('--sidebar-width', sidebarCollapsed ? '60px' : '250px');
        document.documentElement.style.setProperty('--content-margin', sidebarCollapsed ? '60px' : '250px');
        document.documentElement.style.setProperty('--grid-columns', sidebarCollapsed ? '4' : '3');
        document.documentElement.style.setProperty('--widget-columns', sidebarCollapsed ? '5' : '3');
        document.documentElement.style.setProperty('--card-padding', sidebarCollapsed ? '2rem' : '1.5rem');
      })();
    </script>
    <script src="/feature-flags.js"></script>
    <link rel="stylesheet" href="/styles/lib/fontawesome.min.css" />
    <!-- Font Awesome CDN als Fallback -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      @import url('/styles/dashboard-theme.css');
      @import url('/styles/breadcrumb-alignment.css');
      /* Glassmorphismus Design-Standards */

      /* Dramatischer Hintergrund-Gradient */
      body {
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        background: #000;
      }

      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(5deg, transparent, rgba(0, 142, 255, 0.1) 100%, #01000482 0, rgba(0, 0, 4, 0.6) 100%, #000);
        pointer-events: none;
        z-index: -1;
      }

      /* Header und Sidebar werden von unified-navigation gehandelt */

      /* Survey-specific styles */
      .survey-container {
        margin: 0 auto;
      }

      .survey-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-xl);
      }

      .survey-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
      }

      .survey-title i {
        color: var(--primary-color);
      }

      /* Survey Cards Grid */
      .surveys-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
      }

      .survey-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: var(--shadow-sm);
        border-radius: var(--radius-md);
        /* animation: fadeInUp 0.6s ease-out; */
        padding: var(--spacing-lg);

        cursor: pointer;
        margin-top: 10px;
        margin-left: -5px;
      }

      .survey-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        border-color: var(--primary-color);
      }

      .survey-card-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: var(--spacing-md);
      }

      .survey-card-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
      }

      .survey-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 500;
        text-transform: uppercase;
      }

      .survey-status.draft {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
      }

      .survey-status.active {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
      }

      .survey-status.closed {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
      }

      .survey-status.archived {
        background: rgba(158, 158, 158, 0.2);
        color: #9e9e9e;
      }

      .survey-card-description {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-md);
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .survey-stats {
        display: flex;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-md);
      }

      .survey-stat {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .survey-stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
      }

      .survey-stat-label {
        font-size: 0.8rem;
        color: var(--text-secondary);
        text-transform: uppercase;
      }

      .survey-actions {
        display: flex;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-md);
      }

      .survey-action-btn {
        flex: 1;
        padding: var(--spacing-2sm);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-md);
        color: var(--text-primary);
        font-size: 0.9rem;
        cursor: pointer;

        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
      }

      .survey-action-btn:hover {
        background: rgba(33, 150, 243, 0.2);
        border-color: var(--primary-color);
      }

      /* Create Survey Modal */
      .modal,
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        backdrop-filter: blur(10px);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        transition:
          opacity 0.1s ease,
          visibility 0.1s ease;
      }

      .modal-overlay {
        display: flex;
        opacity: 0;
        visibility: hidden;
        transition:
          opacity 0.1s ease,
          visibility 0.1s ease;
      }

      .modal-overlay.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content,
      .modal-container {
        backdrop-filter: blur(20px) saturate(180%);
        background: #121212c4;
        border: 1px solid hsla(0, 0%, 100%, 0.1);
        border-radius: var(--radius-md);
        box-shadow:
          0 8px 32px #0006,
          inset 0 1px #ffffff1a;
        display: flex;
        flex-direction: column;
        max-height: 85vh !important;
        max-width: 1150px;
        overflow: auto;
        transform: translateY(0);
        width: 90%;
      }

      .modal-header {
        align-items: center;
        background: #ffffff05;
        display: flex;
        justify-content: space-between;
        padding: var(--spacing-lg);
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .close-btn {
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 1.5rem;
        cursor: pointer;
        padding: var(--spacing-xs);
        border-radius: 50%;
      }

      .close-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
      }

      .modal-content form {
        padding: var(--spacing-lg);
        flex: 1;
        max-height: calc(85vh - 120px);
        overflow-y: auto;
      }

      .modal-content .form-actions {
        padding: var(--spacing-lg);
        border-top: 1px solid var(--border-color);
        margin: 0 calc(-1 * var(--spacing-lg)) calc(-1 * var(--spacing-lg));
        background: rgba(255, 255, 255, 0.02);
      }

      /* Question Builder */
      .question-builder {
        margin-top: var(--spacing-lg);
      }

      .question-item {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-md);
        position: relative;
      }

      .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-md);
      }

      .question-number {
        background: var(--primary-color);
        color: #fff;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
      }

      .question-actions {
        display: flex;
        gap: var(--spacing-xs);
      }

      .question-action,
      .remove-question {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: var(--text-secondary);
        padding: var(--spacing-xs);
        border-radius: 50%;
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .question-action:hover,
      .remove-question:hover {
        background: rgba(244, 67, 54, 0.3);
        color: #ff5252;
        transform: scale(1.1);
      }

      .question-action.delete:hover {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
      }

      .remove-question svg {
        width: 14px;
        height: 14px;
      }

      /* Utility Classes */
      .u-hidden {
        display: none !important;
      }

      /* Checkbox Styles */
      .checkbox-label {
        display: flex;
        align-items: center;
        cursor: pointer;
        user-select: none;
        gap: 12px;
        padding: 10px;
      }

      .checkbox-label input[type='checkbox'] {
        position: absolute;
        opacity: 0;
        width: 0;
        height: 0;
      }

      .checkbox-custom {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.05);
        position: relative;
        transition: all 0.3s ease;
      }

      .checkbox-label input[type='checkbox']:checked + .checkbox-custom {
        background: var(--primary-color);
        border-color: var(--primary-color);
      }

      .checkbox-custom::after {
        content: '';
        position: absolute;
        display: none;
        left: 6px;
        top: 2px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .checkbox-label input[type='checkbox']:checked + .checkbox-custom::after {
        display: block;
      }

      .checkbox-label:hover .checkbox-custom {
        border-color: var(--primary-color);
        background: rgba(33, 150, 243, 0.1);
      }

      .checkbox-text {
        color: var(--text-primary);
        font-size: 14px;
        font-weight: 500;
      }

      /* Form Elements */
      .form-group {
        margin-bottom: var(--spacing-lg);
      }

      .form-label {
        display: block;
        margin-bottom: var(--spacing-sm);
        color: var(--text-primary);
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: var(--spacing-2sm);
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        font-size: 1rem;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }

      textarea.form-control {
        min-height: 100px;
        resize: vertical;
      }

      select.form-control {
        cursor: pointer;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-top: var(--spacing-sm);
      }

      .checkbox-group input[type='checkbox'] {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      /* Options for multiple choice */
      .options-container {
        margin-top: var(--spacing-md);
      }

      .option-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
      }

      .option-input {
        flex: 1;
        padding: var(--spacing-2sm);
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
      }

      .remove-option {
        background: rgba(244, 67, 54, 0.2);
        border: none;
        color: #f44336;
        padding: var(--spacing-xs);
        border-radius: 50%;
        cursor: pointer;

        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .remove-option:hover {
        background: rgba(244, 67, 54, 0.3);
      }

      .add-option-btn {
        background: rgba(76, 175, 80, 0.2);
        border: none;
        color: #4caf50;
        padding: var(--spacing-2sm);
        border-radius: var(--radius-sm);
        cursor: pointer;

        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        font-size: 0.9rem;
      }

      .add-option-btn:hover {
        background: rgba(76, 175, 80, 0.3);
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: var(--spacing-md);
        margin-top: var(--spacing-xl);
        justify-content: flex-end;
      }

      .btn {
        padding: var(--spacing-2sm);
        border-radius: var(--radius-md);
        border: none;
        font-weight: 500;
        cursor: pointer;

        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        color: #fff;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(33, 150, 243, 0.3);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .btn-success {
        background: linear-gradient(135deg, #4caf50, #66bb6a);
        color: #fff;
      }

      .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: var(--spacing-xl) * 2;
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: 40px;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-state-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--spacing-md);
      }

      .empty-state-description {
        max-width: 500px;
        margin: 0 auto var(--spacing-lg) auto;
        line-height: 1.6;
      }

      /* Templates Section */
      .drafts-section,
      .templates-section {
        margin-top: var(--spacing-xl);
        padding-top: var(--spacing-xl);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .drafts-header,
      .templates-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
      }

      .drafts-title,
      .templates-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .template-grid {
        display: grid;
        gap: var(--spacing-lg);
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        margin-bottom: var(--spacing-xl);
      }

      .template-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: var(--spacing-lg);
        cursor: pointer;
      }

      .template-card:hover {
        background: rgba(33, 150, 243, 0.1);
        border-color: var(--primary-color);
        transform: translateY(-2px);
      }

      .template-name {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
      }

      .template-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.4;
      }

      /* Custom Dropdowns */
      .custom-dropdown {
        position: relative;
        width: 100%;
      }

      .dropdown-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-2sm);
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid hsla(0, 0%, 100%, 0.1);
        border-radius: var(--radius-sm);
        color: #fff;
        cursor: pointer;
      }

      .dropdown-display:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .dropdown-display svg {
        transition: transform 0.3s ease;
      }

      .dropdown-display.active svg {
        transform: rotate(180deg);
      }

      .dropdown-options {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid hsla(0, 0%, 100%, 0.1);
        border-radius: var(--radius-sm);
        box-shadow: var(--shadow-sm);
        max-height: 200px;
        overflow-y: auto;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);

        z-index: 1001;
      }

      .dropdown-options.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-option {
        padding: 10px 12px;
        color: var(--text-primary);
        cursor: pointer;

        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .dropdown-option:last-child {
        border-bottom: none;
      }

      /* Scrollbar styling for dropdowns */
      .dropdown-options::-webkit-scrollbar {
        width: 6px;
      }

      .dropdown-options::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }

      .dropdown-options::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 3px;
      }

      .dropdown-options::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Floating Add Button */
      .add-survey-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: rgba(33, 150, 243, 0.2);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(33, 150, 243, 0.3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        color: var(--primary-color);
        cursor: pointer;
        box-shadow: 0 4px 16px rgba(33, 150, 243, 0.3);
        z-index: 100;
        transition: all 0.3s ease;
      }

      .add-survey-btn:hover {
        background: rgba(33, 150, 243, 0.3);
        transform: scale(1.1);
        box-shadow: 0 6px 24px rgba(33, 150, 243, 0.4);
      }
    </style>
    <link rel="stylesheet" href="/styles/user-info-update.css" />
  </head>
  <body>
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <main class="main-content">
        <!-- Breadcrumb -->
        <div id="breadcrumb-container"></div>

        <div class="container">
          <div class="card">
            <div class="card-header">
              <div>
                <h2 class="card-title">Umfrage-Verwaltung</h2>
                <p class="text-secondary">Erstellen und verwalten Sie Mitarbeiterumfragen</p>
              </div>
            </div>
            <div class="card-body">
              <!-- Active Surveys -->
              <h2>Aktive Umfragen</h2>
              <div id="activeSurveys" class="surveys-grid">
                <!-- Surveys will be loaded here -->
              </div>

              <!-- Draft Surveys -->
              <div class="drafts-section">
                <div class="drafts-header">
                  <h2 class="drafts-title">Entwürfe</h2>
                </div>
                <div id="draftSurveys" class="surveys-grid">
                  <!-- Draft surveys will be loaded here -->
                </div>
              </div>

              <!-- Templates Section -->
              <div class="templates-section">
                <div class="templates-header">
                  <h2 class="templates-title">Vorlagen</h2>
                </div>
                <div id="surveyTemplates" class="template-grid">
                  <!-- Templates will be loaded here -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Create/Edit Survey Modal -->
    <div id="surveyModal" class="modal">
      <div class="modal-content modal-container">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">Neue Umfrage erstellen</h2>
          <button class="close-btn" data-action="close">&times;</button>
        </div>

        <form id="surveyForm">
          <div class="form-group">
            <label class="form-label">Titel der Umfrage</label>
            <input type="text" id="surveyTitle" class="form-control" required />
          </div>

          <div class="form-group">
            <label class="form-label">Beschreibung</label>
            <textarea id="surveyDescription" class="form-control"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">Einstellungen</label>
            <div class="checkbox-group">
              <input type="checkbox" id="isAnonymous" />
              <label for="isAnonymous">Anonyme Umfrage (Antworten können nicht zu Mitarbeitern zurückverfolgt werden)</label>
            </div>
            <div class="checkbox-group">
              <input type="checkbox" id="isMandatory" />
              <label for="isMandatory">Verpflichtende Teilnahme</label>
            </div>
            <p style="margin-top: var(--spacing-sm); color: var(--text-secondary); font-size: 0.85rem">
              <i class="fas fa-info-circle"></i>
              Bei anonymen Umfragen werden keine Benutzerdaten gespeichert. Sie können nicht sehen, wer geantwortet hat.
            </p>
          </div>

          <div class="form-group">
            <label class="form-label">Laufzeit</label>
            <div style="display: flex; gap: var(--spacing-md)">
              <div class="u-flex-1">
                <label class="form-label" class="u-fs-09rem">Startdatum</label>
                <input type="datetime-local" id="startDate" class="form-control" />
              </div>
              <div class="u-flex-1">
                <label class="form-label" class="u-fs-09rem">Enddatum</label>
                <input type="datetime-local" id="endDate" class="form-control" />
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Zielgruppe</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="assignmentDropdownDisplay" data-action="toggle-dropdown" data-dropdown="assignmentDropdown">
                <span>Ganze Firma</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="assignmentDropdownDropdown">
                <div class="dropdown-option" data-action="select-assignment" data-value="all_users" data-text="Ganze Firma">
                  Ganze Firma
                </div>
                <div class="dropdown-option" data-action="select-assignment" data-value="department" data-text="Abteilung">Abteilung</div>
                <div class="dropdown-option" data-action="select-assignment" data-value="team" data-text="Team">Team</div>
              </div>
              <input type="hidden" id="assignmentType" value="all_users" />
            </div>
          </div>

          <!-- Department Selection (hidden by default) -->
          <div class="form-group u-hidden" id="departmentSelection">
            <label class="form-label">Abteilungen auswählen</label>
            <select
              id="departmentSelect"
              multiple
              class="form-control"
              style="min-height: 120px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1)"
            >
              <!-- Department options will be loaded here -->
            </select>
            <small class="form-text" style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block">
              Halten Sie Strg/Cmd gedrückt für Mehrfachauswahl
            </small>
          </div>

          <!-- Team Selection (hidden by default) -->
          <div class="form-group u-hidden" id="teamSelection">
            <label class="form-label">Teams auswählen</label>
            <select
              id="teamSelect"
              multiple
              class="form-control"
              style="min-height: 120px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1)"
            >
              <!-- Team options will be loaded here -->
            </select>
            <small class="form-text" style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block">
              Halten Sie Strg/Cmd gedrückt für Mehrfachauswahl
            </small>
          </div>

          <div class="question-builder">
            <h3 style="margin-bottom: var(--spacing-md)">Fragen</h3>
            <div id="questionsList">
              <!-- Questions will be added here -->
            </div>
            <button type="button" class="btn btn-secondary" data-action="add-question">
              <i class="fas fa-plus"></i>
              Frage hinzufügen
            </button>
          </div>

          <div class="action-buttons">
            <button type="button" class="btn btn-secondary" data-action="close">Abbrechen</button>
            <button type="button" class="btn btn-primary" data-action="save-survey" data-status="draft">
              <i class="fas fa-save"></i>
              Als Entwurf speichern
            </button>
            <button type="button" class="btn btn-success" data-action="save-survey" data-status="active">
              <i class="fas fa-paper-plane"></i>
              Umfrage starten
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Floating Add Button -->
    <button class="add-survey-btn" data-action="show-create-modal">+</button>

    <script type="module" src="/scripts/auth.js"></script>
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
    <script type="module" src="/scripts/role-switch.ts"></script>
    <!-- Breadcrumb -->
    <script type="module" src="/scripts/components/breadcrumb.js"></script>

    <!-- Survey Admin Module -->
    <script type="module" src="/scripts/survey-admin.ts"></script>

    <script type="module">
      import { modalManager } from '/scripts/utils/modal-manager.ts';

      // Make modalManager available globally
      window.modalManager = modalManager;

      // Event Delegation for HTML-specific actions
      document.addEventListener('click', function (e) {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const action = target.dataset.action;

        switch (action) {
          case 'toggle-dropdown': {
            const dropdown = target.dataset.dropdown;
            if (window.surveyAdmin && window.surveyAdmin.toggleDropdown) {
              window.surveyAdmin.toggleDropdown(dropdown);
            }
            break;
          }
          case 'select-assignment': {
            const value = target.dataset.value;
            const text = target.dataset.text;
            if (window.surveyAdmin && window.surveyAdmin.selectAssignmentOption) {
              window.surveyAdmin.selectAssignmentOption(value, text);
            }
            break;
          }
          case 'add-question':
            if (window.surveyAdmin && window.surveyAdmin.addQuestion) {
              window.surveyAdmin.addQuestion();
            }
            break;
          case 'save-survey': {
            const status = target.dataset.status;
            if (window.surveyAdmin && window.surveyAdmin.saveSurvey) {
              window.surveyAdmin.saveSurvey(status);
            }
            break;
          }
          case 'show-create-modal':
            if (window.surveyAdmin && window.surveyAdmin.showCreateModal) {
              window.surveyAdmin.showCreateModal();
            }
            break;
        }
      });
    </script>
  </body>
</html>
