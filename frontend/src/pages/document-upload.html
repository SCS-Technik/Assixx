<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dokument hochladen - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      @import url('/styles/dashboard-theme.css');
      /* Glassmorphismus Design-Standards - Wie im Admin Dashboard */

      /* Dramatischer Hintergrund-Gradient */
      body {
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        background: #000;
      }

      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(0deg, transparent 0%, rgba(0, 142, 255, 0.03) 100%, #01000482 60%, rgba(0, 0, 4, 0.6) 90%, black 100%);
        pointer-events: none;
        z-index: -1;
      }

      /* Header und Sidebar werden von unified-navigation gehandelt */

      /* Fix for sidebar title alignment */
      .sidebar-title {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        margin: 0 0 16px 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        background: rgba(33, 150, 243, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(33, 150, 243, 0.2);
      }

      /* Glassmorphismus Upload Section - wie card im Dashboard */
      .upload-section {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        margin-bottom: var(--spacing-lg);
        overflow: hidden;
        position: relative;
        transition: all 0.3s ease;
        animation: fadeInUp 0.6s ease-out;
      }

      .upload-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .upload-section:hover::before {
        opacity: 1;
      }

      .upload-section:hover {
        transform: translateY(-5px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.03);
      }

      /* Card Header f√ºr Upload Title - wie im Dashboard */
      .card-header {
        background: rgba(255, 255, 255, 0.01);
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .upload-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .upload-title::before {
        content: '';
        width: 4px;
        height: 20px;
        background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
        border-radius: 2px;
      }

      .card-body {
        padding: var(--spacing-lg);
      }

      .upload-form {
        max-width: 800px;
        margin: 0 auto;
      }

      .form-group {
        margin-bottom: var(--spacing-md);
      }

      /* Form Controls - wie im Dashboard */
      .form-control {
        width: 100%;
        padding: 10px 15px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-sm);
        color: var(--text-primary);
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .form-control:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .form-control:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.2);
        outline: none;
      }

      /* Form Label */
      .form-label {
        display: block;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 8px;
        font-size: 14px;
      }

      /* Custom Glassmorphismus Dropdown - Nach Design Standards */
      .custom-dropdown {
        position: relative;
        width: 100%;
      }

      .dropdown-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: var(--spacing-md);
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--radius-sm);
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
        min-height: 46px;
      }

      .dropdown-display:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .dropdown-display.active {
        border-color: rgba(0, 142, 255, 0.5);
        box-shadow: 0 0 0 3px rgba(0, 142, 255, 0.15);
      }

      .dropdown-display.active svg {
        transform: rotate(180deg);
      }

      .dropdown-display span {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .dropdown-display svg {
        transition: transform 0.3s ease;
      }

      .dropdown-options {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.8);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--radius-sm);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        max-height: 200px;
        overflow-y: auto;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s ease;
        z-index: 1001;
      }

      .dropdown-options.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .dropdown-option {
        padding: 10px 12px;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .dropdown-option:last-child {
        border-bottom: none;
      }

      .dropdown-option:hover {
        background: rgba(33, 150, 243, 0.2);
        color: white;
        padding-left: 16px;
      }

      .dropdown-option.selected {
        background: rgba(33, 150, 243, 0.15);
        font-weight: 500;
      }

      /* Placeholder Styling */
      .dropdown-display.placeholder span {
        color: rgba(255, 255, 255, 0.5);
        font-style: italic;
      }

      /* Textarea spezifisch */
      textarea.form-control {
        min-height: 100px;
        resize: vertical;
      }

      /* Page Header - wie im Dashboard */
      .page-header {
        margin-bottom: var(--spacing-lg);
      }

      .page-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        text-shadow: 0 0 20px rgba(33, 150, 243, 0.3);
      }

      .form-row {
        display: flex;
        flex-wrap: wrap;
        margin: 0 -10px;
      }

      .form-col {
        flex: 1;
        min-width: 200px;
        padding: 0 10px;
      }

      .file-drop-area {
        position: relative;
        border: 2px dashed rgba(255, 255, 255, 0.15);
        border-radius: var(--radius-md);
        padding: 30px;
        text-align: center;
        transition: all 0.3s;
        margin-bottom: var(--spacing-md);
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
      }

      .file-drop-area:hover,
      .file-drop-area.drag-over {
        border-color: rgba(33, 150, 243, 0.5);
        background: rgba(33, 150, 243, 0.05);
        box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
      }

      .file-icon {
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--primary-color);
        margin-bottom: var(--spacing-sm);
      }

      .file-icon svg {
        width: 48px;
        height: 48px;
      }

      .file-message {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xs);
      }

      .file-restrictions {
        background: rgba(33, 150, 243, 0.05);
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(33, 150, 243, 0.1);
        border-radius: var(--radius-sm);
        padding: var(--spacing-sm);
        margin-top: var(--spacing-xs);
        margin-bottom: var(--spacing-md);
        color: rgba(255, 255, 255, 0.7);
        font-size: 12px;
      }

      .file-input {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 100%;
        opacity: 0;
        cursor: pointer;
      }

      .file-info {
        display: none;
        background: rgba(33, 150, 243, 0.08);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(33, 150, 243, 0.2);
        border-radius: var(--radius-sm);
        padding: 10px 15px;
        margin-top: var(--spacing-sm);
        color: var(--text-primary);
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
      }

      .file-info.active {
        display: flex;
        align-items: center;
        justify-content: space-between;
        animation: fadeInUp 0.3s ease-out;
      }

      .pdf-preview-container {
        display: none;
        margin: var(--spacing-md) 0;
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--radius-md);
        overflow: hidden;
        max-height: 400px;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      }

      .pdf-preview-container.active {
        display: block;
        animation: fadeInUp 0.3s ease-out;
      }

      .pdf-preview {
        width: 100%;
        height: 400px;
        border: none;
      }

      .preview-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        padding: var(--spacing-sm);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .preview-title {
        font-weight: 600;
        color: var(--text-primary);
      }

      .preview-close {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 18px;
        padding: 5px;
        border-radius: var(--radius-sm);
        transition: all 0.2s;
      }

      .preview-close:hover {
        color: var(--error-color);
        background: rgba(255, 255, 255, 0.05);
        transform: scale(1.1);
      }

      .file-name {
        font-weight: 600;
        max-width: 70%;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .file-size {
        color: var(--text-secondary);
        font-size: 14px;
      }

      /* Button Styles wie im Dashboard */
      .btn {
        padding: 10px 24px;
        border-radius: var(--radius-sm);
        font-weight: 500;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      /* Second-Level Button f√ºr Upload (mit Gradient) */
      .btn-primary {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
        color: white;
        position: relative;
        overflow: hidden;
        box-shadow:
          0 1px 4px rgba(33, 150, 243, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.2);
      }

      .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
      }

      .btn-primary:hover::before {
        left: 100%;
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .btn svg {
        margin-right: 8px;
      }

      /* Alert Styles - wie stat-cards im Dashboard */
      .alert {
        padding: 15px 20px;
        border-radius: var(--radius-sm);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        animation: fadeInUp 0.3s ease-out;
        transition: all 0.3s ease;
      }

      .alert .icon {
        margin-right: 15px;
        font-size: 24px;
      }

      .alert-success {
        background: rgba(16, 185, 129, 0.15);
        color: #10b981;
        border: 1px solid rgba(16, 185, 129, 0.3);
        box-shadow:
          0 4px 12px rgba(16, 185, 129, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      .alert-danger {
        background: rgba(244, 67, 54, 0.15);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
        box-shadow:
          0 4px 12px rgba(244, 67, 54, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      /* Animationen */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-spinner {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-right: 8px;
      }

      .loading-spinner svg {
        animation: spin 1.5s linear infinite;
      }

      /* Recipient Type Selector Styles */
      .recipient-type-selector {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 20px;
      }

      .radio-option {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .radio-option:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(33, 150, 243, 0.3);
      }

      .radio-option input[type='radio'] {
        margin-right: 8px;
        accent-color: var(--primary-color);
      }

      .radio-option input[type='radio']:checked + span {
        color: var(--primary-color);
        font-weight: 500;
      }

      .radio-option input[type='radio']:checked {
        transform: scale(1.1);
      }

      .radio-option:has(input[type='radio']:checked) {
        background: rgba(33, 150, 243, 0.1);
        border-color: rgba(33, 150, 243, 0.5);
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.15);
      }

      /* Anpassungen f√ºr mobile Ger√§te */
      @media (max-width: 768px) {
        .form-row {
          flex-direction: column;
        }

        .form-col {
          width: 100%;
          margin-bottom: var(--spacing-md);
        }
      }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />
  </head>
  <body>
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Main Content Area -->
      <main class="main-content">
        <div class="page-header">
          <h1 class="page-title">Dokument hochladen</h1>
        </div>

        <div id="upload-success" class="alert alert-success" style="display: none">
          <span class="icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
              />
            </svg>
          </span>
          <div>
            <strong>Erfolg!</strong>
            <p>Dokument wurde erfolgreich hochgeladen.</p>
          </div>
        </div>

        <div id="upload-error" class="alert alert-danger" style="display: none">
          <span class="icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
            </svg>
          </span>
          <div>
            <strong>Fehler!</strong>
            <p id="error-message">Beim Hochladen des Dokuments ist ein Fehler aufgetreten.</p>
          </div>
        </div>

        <div class="upload-section">
          <div class="card-header">
            <h2 class="upload-title">Dokument-Informationen</h2>
          </div>
          <div class="card-body">
            <form id="upload-form" class="upload-form">
              <div class="form-row">
                <div class="form-col">
                  <div class="form-group">
                    <label class="form-label">Empf√§nger-Typ</label>
                    <div class="recipient-type-selector">
                      <label class="radio-option">
                        <input type="radio" name="recipientType" value="user" checked onchange="updateRecipientSelector('user')" />
                        <span>Einzelner Mitarbeiter</span>
                      </label>
                      <label class="radio-option">
                        <input type="radio" name="recipientType" value="team" onchange="updateRecipientSelector('team')" />
                        <span>Team</span>
                      </label>
                      <label class="radio-option">
                        <input type="radio" name="recipientType" value="department" onchange="updateRecipientSelector('department')" />
                        <span>Abteilung</span>
                      </label>
                      <label class="radio-option">
                        <input type="radio" name="recipientType" value="company" onchange="updateRecipientSelector('company')" />
                        <span>Gesamte Firma</span>
                      </label>
                    </div>
                  </div>

                  <div class="form-group" id="recipientSelectorGroup">
                    <label for="user-select" class="form-label" id="recipientLabel">Mitarbeiter ausw√§hlen</label>
                    <div class="custom-dropdown" id="userDropdownContainer">
                      <div class="dropdown-display placeholder" id="userDisplay" onclick="toggleDropdown('user')">
                        <span>Bitte Mitarbeiter ausw√§hlen</span>
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                          <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </div>
                      <div class="dropdown-options" id="userDropdown">
                        <!-- Wird dynamisch bef√ºllt -->
                      </div>
                      <input type="hidden" name="userId" id="userValue" />
                    </div>

                    <div class="custom-dropdown" id="teamDropdownContainer" style="display: none">
                      <div class="dropdown-display placeholder" id="teamDisplay" onclick="toggleDropdown('team')">
                        <span>Bitte Team ausw√§hlen</span>
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                          <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </div>
                      <div class="dropdown-options" id="teamDropdown">
                        <!-- Wird dynamisch bef√ºllt -->
                      </div>
                      <input type="hidden" name="teamId" id="teamValue" />
                    </div>

                    <div class="custom-dropdown" id="departmentDropdownContainer" style="display: none">
                      <div class="dropdown-display placeholder" id="departmentDisplay" onclick="toggleDropdown('department')">
                        <span>Bitte Abteilung ausw√§hlen</span>
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                          <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </div>
                      <div class="dropdown-options" id="departmentDropdown">
                        <!-- Wird dynamisch bef√ºllt -->
                      </div>
                      <input type="hidden" name="departmentId" id="departmentValue" />
                    </div>

                    <div
                      id="companyInfo"
                      style="
                        display: none;
                        padding: 12px;
                        background: rgba(33, 150, 243, 0.1);
                        border-radius: 8px;
                        border: 1px solid rgba(33, 150, 243, 0.3);
                      "
                    >
                      <i class="fas fa-info-circle" style="color: #2196f3; margin-right: 8px"></i>
                      Das Dokument wird f√ºr alle Mitarbeiter der Firma sichtbar sein.
                    </div>
                  </div>

                  <div class="form-group">
                    <label for="category-select" class="form-label">Kategorie</label>
                    <div class="custom-dropdown">
                      <div class="dropdown-display placeholder" id="categoryDisplay" onclick="toggleDropdown('category')">
                        <span>Bitte Kategorie ausw√§hlen</span>
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                          <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </div>
                      <div class="dropdown-options" id="categoryDropdown">
                        <div class="dropdown-option" onclick="selectOption('category', 'salary', 'Gehaltsabrechnung')">
                          Gehaltsabrechnung
                        </div>
                        <div class="dropdown-option" onclick="selectOption('category', 'contract', 'Vertrag')">Vertrag</div>
                        <div class="dropdown-option" onclick="selectOption('category', 'certificate', 'Zertifikat/Zeugnis')">
                          Zertifikat/Zeugnis
                        </div>
                        <div class="dropdown-option" onclick="selectOption('category', 'other', 'Sonstiges')">Sonstiges</div>
                      </div>
                      <input type="hidden" name="category" id="categoryValue" required />
                    </div>
                  </div>
                </div>

                <div class="form-col">
                  <div class="form-group">
                    <label for="year-input" class="form-label">Jahr (optional)</label>
                    <input type="number" id="year-input" name="year" class="form-control" min="1900" max="2100" placeholder="z.B. 2025" />
                  </div>

                  <div class="form-group">
                    <label for="month-select" class="form-label">Monat (optional)</label>
                    <div class="custom-dropdown">
                      <div class="dropdown-display placeholder" id="monthDisplay" onclick="toggleDropdown('month')">
                        <span>Monat ausw√§hlen (optional)</span>
                        <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                          <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                        </svg>
                      </div>
                      <div class="dropdown-options" id="monthDropdown">
                        <div class="dropdown-option" onclick="selectOption('month', '', 'Kein Monat')">Kein Monat</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Januar', 'Januar')">Januar</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Februar', 'Februar')">Februar</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'M√§rz', 'M√§rz')">M√§rz</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'April', 'April')">April</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Mai', 'Mai')">Mai</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Juni', 'Juni')">Juni</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Juli', 'Juli')">Juli</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'August', 'August')">August</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'September', 'September')">September</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Oktober', 'Oktober')">Oktober</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'November', 'November')">November</div>
                        <div class="dropdown-option" onclick="selectOption('month', 'Dezember', 'Dezember')">Dezember</div>
                      </div>
                      <input type="hidden" name="month" id="monthValue" />
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="description-input" class="form-label">Beschreibung (optional)</label>
                <textarea
                  id="description-input"
                  name="description"
                  class="form-control"
                  rows="3"
                  placeholder="Zus√§tzliche Informationen zum Dokument"
                ></textarea>
              </div>

              <div class="file-drop-area" id="drop-area">
                <span class="file-icon">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                  </svg>
                </span>
                <div class="file-message">Datei hierher ziehen oder klicken, um auszuw√§hlen</div>
                <p class="text-secondary">(Nur PDF-Dateien erlaubt, max. 5MB)</p>
                <div class="file-restrictions">
                  <small>Erlaubte Dateitypen: PDF (.pdf)</small>
                  <br />
                  <small>Maximale Dateigr√∂√üe: 5 MB</small>
                </div>
                <input type="file" id="file-input" name="document" class="file-input" accept=".pdf" required />
              </div>

              <div class="file-info" id="file-info">
                <div class="file-name" id="file-name">document.pdf</div>
                <div class="file-size" id="file-size">0 KB</div>
              </div>

              <div class="pdf-preview-container" id="pdf-preview-container">
                <div class="preview-controls">
                  <span class="preview-title">Dokument-Vorschau</span>
                  <button type="button" class="preview-close" id="preview-close">√ó</button>
                </div>
                <iframe class="pdf-preview" id="pdf-preview"></iframe>
              </div>

              <div class="form-group" style="text-align: center; margin-top: 30px">
                <button type="submit" class="btn btn-primary" id="upload-button">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path
                      d="M14,13V17H10V13H7L12,8L17,13M19.35,10.03C18.67,6.59 15.64,4 12,4C9.11,4 6.6,5.64 5.35,8.03C2.34,8.36 0,10.9 0,14A6,6 0 0,0 6,20H19A5,5 0 0,0 24,15C24,12.36 21.95,10.22 19.35,10.03Z"
                    />
                  </svg>
                  Dokument hochladen
                </button>
              </div>
            </form>
          </div>
        </div>
      </main>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        console.log('Document upload page loaded');

        // Datei-Upload-Bereich einrichten
        setupFileUpload();

        // Mitarbeiter-Liste laden
        loadEmployees();
        loadTeams();
        loadDepartments();

        // Formular-Einreichung einrichten
        const uploadForm = document.getElementById('upload-form');
        if (uploadForm) {
          uploadForm.addEventListener('submit', uploadDocument);
        }

        // Dropdown-Funktionalit√§t einrichten
        setupDropdowns();
      });

      // Empf√§nger-Selector aktualisieren
      function updateRecipientSelector(type) {
        const userContainer = document.getElementById('userDropdownContainer');
        const teamContainer = document.getElementById('teamDropdownContainer');
        const departmentContainer = document.getElementById('departmentDropdownContainer');
        const companyInfo = document.getElementById('companyInfo');
        const recipientLabel = document.getElementById('recipientLabel');

        // Alle Container verstecken
        userContainer.style.display = 'none';
        teamContainer.style.display = 'none';
        departmentContainer.style.display = 'none';
        companyInfo.style.display = 'none';

        // Required-Attribute zur√ºcksetzen
        document.getElementById('userValue').removeAttribute('required');
        document.getElementById('teamValue').removeAttribute('required');
        document.getElementById('departmentValue').removeAttribute('required');

        // Je nach Typ anzeigen
        switch (type) {
          case 'user':
            userContainer.style.display = 'block';
            document.getElementById('userValue').setAttribute('required', 'required');
            recipientLabel.textContent = 'Mitarbeiter ausw√§hlen';
            break;
          case 'team':
            teamContainer.style.display = 'block';
            document.getElementById('teamValue').setAttribute('required', 'required');
            recipientLabel.textContent = 'Team ausw√§hlen';
            break;
          case 'department':
            departmentContainer.style.display = 'block';
            document.getElementById('departmentValue').setAttribute('required', 'required');
            recipientLabel.textContent = 'Abteilung ausw√§hlen';
            break;
          case 'company':
            companyInfo.style.display = 'block';
            recipientLabel.textContent = 'Empf√§nger';
            break;
        }
      }

      // Teams laden
      async function loadTeams() {
        const token = localStorage.getItem('token');
        try {
          const response = await fetch('/api/teams', {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const teams = await response.json();
            const teamDropdown = document.getElementById('teamDropdown');

            teamDropdown.innerHTML = teams
              .map(
                (team) => `
              <div class="dropdown-option" onclick="selectOption('team', '${team.id}', '${team.name}')">
                ${team.name}
              </div>
            `,
              )
              .join('');
          }
        } catch (error) {
          console.error('Error loading teams:', error);
        }
      }

      // Abteilungen laden
      async function loadDepartments() {
        const token = localStorage.getItem('token');
        try {
          const response = await fetch('/api/departments', {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const departments = await response.json();
            const departmentDropdown = document.getElementById('departmentDropdown');

            departmentDropdown.innerHTML = departments
              .map(
                (dept) => `
              <div class="dropdown-option" onclick="selectOption('department', '${dept.id}', '${dept.name}')">
                ${dept.name}
              </div>
            `,
              )
              .join('');
          }
        } catch (error) {
          console.error('Error loading departments:', error);
        }
      }

      // Best√§tigungsdialog anzeigen
      function showConfirmationDialog(formData, callback) {
        const recipientType = document.querySelector('input[name="recipientType"]:checked').value;
        let recipientDisplay = '';

        switch (recipientType) {
          case 'user':
            recipientDisplay = `Mitarbeiter: ${document.getElementById('userDisplay').querySelector('span').textContent}`;
            break;
          case 'team':
            recipientDisplay = `Team: ${document.getElementById('teamDisplay').querySelector('span').textContent}`;
            break;
          case 'department':
            recipientDisplay = `Abteilung: ${document.getElementById('departmentDisplay').querySelector('span').textContent}`;
            break;
          case 'company':
            recipientDisplay = 'Empf√§nger: Gesamte Firma';
            break;
        }

        const categoryDisplay = document.getElementById('categoryDisplay').querySelector('span').textContent;
        const fileInput = document.getElementById('file-input');
        const fileName = fileInput.files[0].name;

        const confirmMsg =
          `Bitte best√§tigen Sie den Dokument-Upload:\n\n` +
          `${recipientDisplay}\n` +
          `Kategorie: ${categoryDisplay}\n` +
          `Dateiname: ${fileName}\n` +
          (formData.get('year') ? `Jahr: ${formData.get('year')}\n` : '') +
          (formData.get('month') ? `Monat: ${formData.get('month')}\n` : '') +
          (formData.get('description') ? `\nBeschreibung: ${formData.get('description')}` : '');

        if (confirm(confirmMsg)) {
          callback();
        }
      }

      // Datei-Upload-Bereich einrichten
      function setupFileUpload() {
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');

        if (!dropArea || !fileInput) return;

        // Drag & Drop Events
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
          dropArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
          });
        });

        ['dragenter', 'dragover'].forEach((eventName) => {
          dropArea.addEventListener(eventName, () => {
            dropArea.classList.add('drag-over');
          });
        });

        ['dragleave', 'drop'].forEach((eventName) => {
          dropArea.addEventListener(eventName, () => {
            dropArea.classList.remove('drag-over');
          });
        });

        // Datei fallen lassen
        dropArea.addEventListener('drop', (e) => {
          const dt = e.dataTransfer;
          const files = dt.files;

          if (files.length > 0) {
            fileInput.files = files;
            updateFileInfo(files[0]);
          }
        });

        // Datei ausw√§hlen
        fileInput.addEventListener('change', () => {
          if (fileInput.files.length > 0) {
            updateFileInfo(fileInput.files[0]);
          } else {
            fileInfo.classList.remove('active');
          }
        });

        // Datei-Informationen aktualisieren und Vorschau anzeigen
        function updateFileInfo(file) {
          if (!file) return;

          // √úberpr√ºfen, ob es eine PDF-Datei ist
          if (!file.type || file.type !== 'application/pdf') {
            const fileExt = file.name.split('.').pop().toLowerCase();

            // Detaillierte Fehlermeldung basierend auf dem Dateityp
            if (fileExt === 'jpg' || fileExt === 'jpeg' || fileExt === 'png' || fileExt === 'gif') {
              showError('Bilddateien sind nicht erlaubt. Bitte konvertieren Sie das Bild in ein PDF-Dokument.');
            } else if (fileExt === 'doc' || fileExt === 'docx') {
              showError('Word-Dokumente sind nicht erlaubt. Bitte exportieren Sie die Datei als PDF.');
            } else if (fileExt === 'xls' || fileExt === 'xlsx') {
              showError('Excel-Dateien sind nicht erlaubt. Bitte exportieren Sie die Datei als PDF.');
            } else if (fileExt === 'txt') {
              showError('Textdateien sind nicht erlaubt. Bitte konvertieren Sie die Datei in ein PDF-Dokument.');
            } else {
              showError(`Dateityp "${fileExt}" wird nicht unterst√ºtzt. Nur PDF-Dateien sind erlaubt.`);
            }

            // Dateiauswahl zur√ºcksetzen
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
              fileInput.value = '';
            }

            return;
          }

          // √úberpr√ºfen Sie die Dateigr√∂√üe (max. 5 MB)
          const maxSize = 5 * 1024 * 1024; // 5 MB in Bytes
          if (file.size > maxSize) {
            showError(`Die Datei ist zu gro√ü (${formatFileSize(file.size)}). Die maximale Dateigr√∂√üe betr√§gt 5 MB.`);

            // Dateiauswahl zur√ºcksetzen
            const fileInput = document.getElementById('file-input');
            if (fileInput) {
              fileInput.value = '';
            }

            return;
          }

          // Fehlermeldung ausblenden, wenn alles in Ordnung ist
          hideError();

          fileName.textContent = file.name;
          fileSize.textContent = formatFileSize(file.size);
          fileInfo.classList.add('active');

          // PDF-Vorschau erstellen
          const pdfPreviewContainer = document.getElementById('pdf-preview-container');
          const pdfPreview = document.getElementById('pdf-preview');
          const previewClose = document.getElementById('preview-close');

          if (pdfPreviewContainer && pdfPreview) {
            // Datei-URL erstellen
            const fileUrl = URL.createObjectURL(file);

            // iframe-Quelle setzen
            pdfPreview.src = fileUrl;

            // Container anzeigen
            pdfPreviewContainer.classList.add('active');

            // Schlie√üen-Button-Funktionalit√§t
            if (previewClose) {
              previewClose.addEventListener('click', () => {
                pdfPreviewContainer.classList.remove('active');
                // Optional: URL-Objekt freigeben, wenn die Vorschau geschlossen wird
                URL.revokeObjectURL(fileUrl);
              });
            }
          }
        }

        // Dateigr√∂√üe formatieren
        function formatFileSize(bytes) {
          if (bytes === 0) return '0 Bytes';

          const k = 1024;
          const sizes = ['Bytes', 'KB', 'MB', 'GB'];
          const i = Math.floor(Math.log(bytes) / Math.log(k));

          return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
      }

      // Mitarbeiter f√ºr das Dropdown laden
      async function loadEmployees() {
        const token = localStorage.getItem('token');
        const userDropdown = document.getElementById('userDropdown');

        if (!userDropdown) return;

        try {
          const response = await fetch('/admin/employees', {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            const employees = await response.json();
            console.log(`Loaded ${employees.length} employees`);

            // Dropdown leeren
            userDropdown.innerHTML = '';

            // Mitarbeiter zum Dropdown hinzuf√ºgen
            employees.forEach((employee) => {
              const option = document.createElement('div');
              option.className = 'dropdown-option';
              option.textContent = `${employee.first_name} ${employee.last_name}`;
              option.onclick = () => selectOption('user', employee.id, `${employee.first_name} ${employee.last_name}`);
              userDropdown.appendChild(option);
            });
          } else {
            console.error('Failed to load employees');
            showError('Mitarbeiterliste konnte nicht geladen werden.');
          }
        } catch (error) {
          console.error('Error loading employees:', error);
          showError('Fehler beim Laden der Mitarbeiterliste: ' + error.message);
        }
      }

      // Dokument hochladen
      async function uploadDocument(e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);
        const token = localStorage.getItem('token');
        const uploadButton = document.getElementById('upload-button');

        // Empf√§nger-Typ ermitteln
        const recipientType = document.querySelector('input[name="recipientType"]:checked').value;
        formData.append('recipientType', recipientType);

        // √úberpr√ºfen, ob alle erforderlichen Felder ausgef√ºllt sind
        const category = formData.get('category');
        const fileInput = document.getElementById('file-input');

        let recipientId = null;
        let recipientName = '';

        switch (recipientType) {
          case 'user':
            recipientId = formData.get('userId');
            recipientName = document.getElementById('userDisplay').querySelector('span').textContent;
            if (!recipientId || recipientId === '') {
              showError('Bitte w√§hlen Sie einen Mitarbeiter aus.');
              return;
            }
            break;
          case 'team':
            recipientId = formData.get('teamId');
            recipientName = document.getElementById('teamDisplay').querySelector('span').textContent;
            if (!recipientId || recipientId === '') {
              showError('Bitte w√§hlen Sie ein Team aus.');
              return;
            }
            break;
          case 'department':
            recipientId = formData.get('departmentId');
            recipientName = document.getElementById('departmentDisplay').querySelector('span').textContent;
            if (!recipientId || recipientId === '') {
              showError('Bitte w√§hlen Sie eine Abteilung aus.');
              return;
            }
            break;
          case 'company':
            recipientName = 'Gesamte Firma';
            // Kein recipientId n√∂tig f√ºr company
            break;
        }

        if (!category || !fileInput.files.length) {
          showError('Bitte f√ºllen Sie alle erforderlichen Felder aus und w√§hlen Sie eine Datei aus.');
          return;
        }

        // Entferne nicht ben√∂tigte Felder aus FormData
        const cleanFormData = new FormData();

        // F√ºge nur die ben√∂tigten Felder hinzu
        cleanFormData.append('recipientType', recipientType);
        cleanFormData.append('document', fileInput.files[0]);
        cleanFormData.append('category', category);

        // F√ºge optionale Felder nur hinzu, wenn sie einen Wert haben
        const description = formData.get('description');
        if (description) cleanFormData.append('description', description);

        const year = formData.get('year');
        if (year) cleanFormData.append('year', year);

        const month = formData.get('month');
        if (month) cleanFormData.append('month', month);

        // F√ºge nur den relevanten Empf√§nger hinzu
        switch (recipientType) {
          case 'user':
            cleanFormData.append('userId', formData.get('userId'));
            break;
          case 'team':
            cleanFormData.append('teamId', formData.get('teamId'));
            break;
          case 'department':
            cleanFormData.append('departmentId', formData.get('departmentId'));
            break;
          // Bei 'company' wird kein spezifischer Empf√§nger ben√∂tigt
        }

        // Best√§tigungsdialog anzeigen
        showConfirmationDialog(cleanFormData, async () => {
          // Button-Zustand √§ndern
          if (uploadButton) {
            uploadButton.disabled = true;
            uploadButton.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="loading-spinner">
                            <path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z" />
                        </svg>
                        Wird hochgeladen...
                    `;
          }

          // Erfolgs- und Fehlerelemente
          hideError();
          hideSuccess();

          try {
            const response = await fetch('/api/documents/upload', {
              method: 'POST',
              headers: {
                Authorization: `Bearer ${token}`,
              },
              body: cleanFormData,
            });

            const result = await response.json();

            if (response.ok) {
              console.log('Upload successful:', result);
              form.reset();

              // Dropdowns zur√ºcksetzen
              document.getElementById('userDisplay').querySelector('span').textContent = 'Bitte Mitarbeiter ausw√§hlen';
              document.getElementById('userDisplay').classList.add('placeholder');
              document.getElementById('teamDisplay').querySelector('span').textContent = 'Bitte Team ausw√§hlen';
              document.getElementById('teamDisplay').classList.add('placeholder');
              document.getElementById('departmentDisplay').querySelector('span').textContent = 'Bitte Abteilung ausw√§hlen';
              document.getElementById('departmentDisplay').classList.add('placeholder');
              document.getElementById('categoryDisplay').querySelector('span').textContent = 'Bitte Kategorie ausw√§hlen';
              document.getElementById('categoryDisplay').classList.add('placeholder');
              document.getElementById('monthDisplay').querySelector('span').textContent = 'Monat ausw√§hlen (optional)';
              document.getElementById('monthDisplay').classList.add('placeholder');

              // Empf√§nger-Typ zur√ºck auf 'user' setzen
              document.querySelector('input[name="recipientType"][value="user"]').checked = true;
              updateRecipientSelector('user');

              // Datei-Info und Vorschau zur√ºcksetzen
              const fileInfo = document.getElementById('file-info');
              const pdfPreviewContainer = document.getElementById('pdf-preview-container');
              const pdfPreview = document.getElementById('pdf-preview');

              if (fileInfo) {
                fileInfo.classList.remove('active');
              }

              if (pdfPreviewContainer) {
                pdfPreviewContainer.classList.remove('active');
              }

              if (pdfPreview && pdfPreview.src) {
                // URL-Objekt freigeben
                URL.revokeObjectURL(pdfPreview.src);
                pdfPreview.src = '';
              }

              showSuccess('Dokument wurde erfolgreich hochgeladen!');
            } else {
              console.error('Upload failed:', result);
              showError('Fehler: ' + (result.message || 'Unbekannter Fehler'));
            }
          } catch (error) {
            console.error('Error uploading document:', error);
            showError('Fehler: ' + (error.message || 'Unbekannter Fehler'));
          } finally {
            // Button-Zustand zur√ºcksetzen
            if (uploadButton) {
              uploadButton.disabled = false;
              uploadButton.innerHTML = `
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,13V17H10V13H7L12,8L17,13M19.35,10.03C18.67,6.59 15.64,4 12,4C9.11,4 6.6,5.64 5.35,8.03C2.34,8.36 0,10.9 0,14A6,6 0 0,0 6,20H19A5,5 0 0,0 24,15C24,12.36 21.95,10.22 19.35,10.03Z" />
                        </svg>
                        Dokument hochladen
                    `;
            }
          }
        });
      }

      // Erfolgsmeldung anzeigen
      function showSuccess(message) {
        const successAlert = document.getElementById('upload-success');
        if (successAlert) {
          const messageElement = successAlert.querySelector('p');
          if (messageElement) {
            messageElement.textContent = message;
          }
          successAlert.style.display = 'flex';

          // Nach 5 Sekunden ausblenden
          setTimeout(() => {
            successAlert.style.display = 'none';
          }, 5000);
        }
      }

      // Erfolgsmeldung ausblenden
      function hideSuccess() {
        const successAlert = document.getElementById('upload-success');
        if (successAlert) {
          successAlert.style.display = 'none';
        }
      }

      // Fehlermeldung anzeigen
      function showError(message) {
        const errorAlert = document.getElementById('upload-error');
        if (errorAlert) {
          const messageElement = document.getElementById('error-message');
          if (messageElement) {
            messageElement.textContent = message;
          }
          errorAlert.style.display = 'flex';
        }
      }

      // Fehlermeldung ausblenden
      function hideError() {
        const errorAlert = document.getElementById('upload-error');
        if (errorAlert) {
          errorAlert.style.display = 'none';
        }
      }

      // Dropdown-Funktionen
      function toggleDropdown(type) {
        const display = document.getElementById(type + 'Display');
        const dropdown = document.getElementById(type + 'Dropdown');

        // Alle anderen schlie√üen
        document.querySelectorAll('.dropdown-display').forEach((d) => {
          if (d !== display) d.classList.remove('active');
        });
        document.querySelectorAll('.dropdown-options').forEach((d) => {
          if (d !== dropdown) d.classList.remove('active');
        });

        display.classList.toggle('active');
        dropdown.classList.toggle('active');
      }

      function selectOption(type, value, text) {
        const display = document.getElementById(type + 'Display');
        const dropdown = document.getElementById(type + 'Dropdown');
        const input = document.getElementById(type + 'Value');

        display.querySelector('span').textContent = text;
        display.classList.remove('placeholder');
        input.value = value;

        display.classList.remove('active');
        dropdown.classList.remove('active');

        // Markiere ausgew√§hlte Option
        dropdown.querySelectorAll('.dropdown-option').forEach((opt) => {
          opt.classList.remove('selected');
          if (opt.textContent === text) {
            opt.classList.add('selected');
          }
        });
      }

      function setupDropdowns() {
        // Click-Outside-to-Close
        document.addEventListener('click', function (e) {
          if (!e.target.closest('.custom-dropdown')) {
            document.querySelectorAll('.dropdown-display').forEach((d) => d.classList.remove('active'));
            document.querySelectorAll('.dropdown-options').forEach((d) => d.classList.remove('active'));
          }
        });
      }
    </script>

    <!-- Unified Navigation -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
  </body>
</html>
