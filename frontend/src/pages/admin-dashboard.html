<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Critical Layout State - Prevents Layout Shift -->
    <script>
      // Set sidebar state IMMEDIATELY to prevent any layout shift
      (function () {
        const sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
        document.documentElement.setAttribute('data-sidebar', sidebarCollapsed ? 'collapsed' : 'expanded');
        // Also set CSS custom properties for immediate use
        document.documentElement.style.setProperty('--sidebar-width', sidebarCollapsed ? '60px' : '250px');
        document.documentElement.style.setProperty('--content-margin', sidebarCollapsed ? '60px' : '250px');
        document.documentElement.style.setProperty('--grid-columns', sidebarCollapsed ? '4' : '3');
      })();
    </script>
    <style>
      @import url('/styles/dashboard-theme.css');
      /* Glassmorphismus Design-Standards */

      /* Fix for sidebar title alignment */
      .sidebar-title {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        margin: 0 0 16px 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        background: rgba(33, 150, 243, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(33, 150, 243, 0.2);
      }

      .sidebar-title .title-icon {
        display: flex;
        align-items: center;
        font-size: 1.1rem;
      }

      /* Dramatischer Hintergrund-Gradient */
      body {
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        background: #000;
      }

      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(5deg, transparent, rgba(0, 142, 255, 0.1) 100%, #01000482 0, rgba(0, 0, 4, 0.6) 100%, #000);
        pointer-events: none;
        z-index: -1;
      }

      /* Glassmorphismus f√ºr Stat-Cards */
      .stat-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.03);
      }

      /* Glassmorphismus f√ºr Cards */
      .card,
      .compact-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      /* Ansprechendere Compact-Cards */
      .compact-card {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .compact-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .compact-card:hover::before {
        opacity: 1;
      }

      .compact-card:hover {
        transform: translateY(-5px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.03);
      }

      .compact-card .card-header {
        background: rgba(255, 255, 255, 0.01);
        backdrop-filter: blur(10px);
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 10px 10px 0 0;
      }

      .compact-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .compact-card .card-title::before {
        content: '';
        width: 4px;
        height: 20px;
        background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
        border-radius: 2px;
      }

      .compact-content {
        padding: var(--spacing-lg);
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .compact-list {
        margin: var(--spacing-md) 0;
        flex: 1;
      }

      .compact-list .list-item {
        padding: var(--spacing-sm) var(--spacing-md);
        margin-bottom: var(--spacing-sm);
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius-sm);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.2s ease;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .compact-list .list-item:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(0, 142, 255, 0.3);
        transform: translateX(5px);
        color: var(--text-primary);
      }

      .compact-list .list-item strong {
        color: var(--text-primary);
        font-weight: 500;
      }

      .view-all-link {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.85rem;
        transition: color 0.2s ease;
        padding: 8px 0;
        margin-top: auto;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .view-all-link:hover {
        color: var(--primary-light);
      }

      .view-all-link .arrow {
        font-size: 0.9rem;
        transition: transform 0.2s ease;
      }

      .view-all-link:hover .arrow {
        transform: translateX(3px);
      }

      /* Button in Compact-Cards */
      .compact-card .btn-block {
        width: 100%;
        padding: 10px 16px;
        font-weight: 500;
        font-size: 0.9rem;
        letter-spacing: 0.3px;
        margin-bottom: var(--spacing-md);
      }

      /* Form-Controls mit Glassmorphismus */
      .form-control,
      .search-input {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #fff;
        transition: all 0.3s ease;
      }

      .form-control:focus,
      .search-input:focus {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(0, 142, 255, 0.5);
        box-shadow:
          0 0 0 3px rgba(0, 142, 255, 0.15),
          inset 0 1px 2px rgba(0, 0, 0, 0.2);
        outline: none;
      }

      /* Deaktivierte Form-Controls */
      .form-control:disabled {
        background: rgba(255, 255, 255, 0.01);
        border-color: rgba(255, 255, 255, 0.08);
        color: rgba(255, 255, 255, 0.4);
        cursor: not-allowed;
        opacity: 0.6;
      }

      .form-control:disabled::placeholder {
        color: rgba(255, 255, 255, 0.3);
      }

      /* Buttons mit Glassmorphismus und Shine-Effekt */
      .btn {
        position: relative;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, rgba(0, 142, 255, 0.2), rgba(0, 142, 255, 0.1));
        border-color: rgba(0, 142, 255, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .btn::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
        transform: rotate(45deg) translate(-70%, -70%);
        transition: transform 0.6s;
      }

      .btn:hover::after {
        transform: rotate(45deg) translate(-30%, -30%);
      }

      /* Tabellen mit Glassmorphismus */
      .table {
        background: transparent;
      }

      .table thead th {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .table tbody tr {
        background: rgba(255, 255, 255, 0.01);
        transition: all 0.3s ease;
      }

      .table tbody tr:hover {
        background: rgba(255, 255, 255, 0.03);
      }

      /* Admin Grid - Gleiche H√∂he f√ºr alle Cards */
      .admin-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-lg);
        align-items: stretch;
      }

      @media (max-width: 1200px) {
        .admin-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .admin-grid {
          grid-template-columns: 1fr;
        }
      }

      .admin-grid > div {
        display: flex;
      }

      /* Animationen */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card,
      .card,
      .compact-card {
        animation: fadeInUp 0.6s ease-out;
      }

      @keyframes subtle-pulse {
        0% {
          box-shadow:
            0 8px 32px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        50% {
          box-shadow:
            0 8px 32px rgba(0, 142, 255, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        100% {
          box-shadow:
            0 8px 32px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
      }

      /* .stat-card:hover animation entfernt */

      /* Action buttons in tables - equal width */
      .table td:last-child .btn {
        min-width: 110px;
        margin: 2px;
      }

      /* Status buttons - Outline style like Secondary buttons */
      .btn-status-active {
        background: transparent;
        border: 1px solid #ff6b35;
        color: #ff6b35;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .btn-status-active:hover {
        background: rgba(255, 107, 53, 0.1);
        border-color: #ff5722;
        color: #ff5722;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
      }

      .btn-status-inactive {
        background: transparent;
        border: 1px solid #28a745;
        color: #28a745;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .btn-status-inactive:hover {
        background: rgba(40, 167, 69, 0.1);
        border-color: #218838;
        color: #218838;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
      }

      /* Blackboard Preview Styles */
      .blackboard-preview {
        min-height: 200px;
      }

      .blackboard-preview .list-item {
        padding: 12px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.02);
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .blackboard-preview .list-item:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(255, 255, 255, 0.1);
        transform: translateX(4px);
      }

      .blackboard-preview .list-item::before {
        content: 'üìå';
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 14px;
        opacity: 0.8;
      }

      .blackboard-preview .list-item-content {
        margin-left: 24px;
      }

      .blackboard-preview .list-item-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .blackboard-preview .list-item-meta {
        font-size: 0.85rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .blackboard-preview .priority-badge {
        display: inline-flex;
        align-items: center;
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 500;
      }

      .blackboard-preview .priority-urgent {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
      }

      .blackboard-preview .priority-high {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
      }

      .blackboard-preview .priority-normal {
        background: rgba(33, 150, 243, 0.2);
        color: #2196f3;
        border: 1px solid rgba(33, 150, 243, 0.3);
      }

      .blackboard-preview .priority-low {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
      }

      /* Skeleton Loading */
      .loading-placeholder {
        padding: 8px 0;
      }

      .skeleton {
        background: linear-gradient(90deg, rgba(255, 255, 255, 0.05) 25%, rgba(255, 255, 255, 0.1) 50%, rgba(255, 255, 255, 0.05) 75%);
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: 4px;
        margin-bottom: 8px;
      }

      .skeleton-text {
        height: 48px;
        width: 100%;
      }

      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      /* Empty State */
      .blackboard-empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-secondary);
      }

      .blackboard-empty-state i {
        font-size: 48px;
        opacity: 0.3;
        margin-bottom: 16px;
      }

      /* Additional Badge Styles */
      .badge-warning {
        background: rgba(255, 193, 7, 0.2);
        color: #ffc107;
      }

      .badge-secondary {
        background: rgba(108, 117, 125, 0.2);
        color: #6c757d;
      }

      /* Info Button Style */
      .btn-info {
        background: rgba(23, 162, 184, 0.2);
        border: 1px solid rgba(23, 162, 184, 0.3);
        color: #17a2b8;
        transition: all 0.3s ease;
      }

      .btn-info:hover {
        background: rgba(23, 162, 184, 0.3);
        border-color: #17a2b8;
        transform: translateY(-1px);
      }

      /* Global Layout Shift Prevention using CSS Custom Properties */
      :root {
        /* These are set by inline script above */
        --sidebar-width: 250px;
        --content-margin: 250px;
        --grid-columns: 3;
        --card-max-width: 100%;
        --widget-padding: 1.5rem;
      }

      /* When sidebar is collapsed */
      [data-sidebar='collapsed'] {
        --sidebar-width: 60px;
        --content-margin: 60px;
        --grid-columns: 4;
        --card-max-width: 100%;
        --widget-padding: 2rem;
      }

      /* Apply to all main content */
      .main-content {
        margin-left: var(--content-margin);
        transition: margin-left 0.3s ease;
      }

      /* Apply to all grids */
      .admin-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        max-width: 100%;
      }

      /* Apply to all cards and widgets */
      .card,
      .widget,
      .stat-card,
      .blackboard-widget {
        transition: all 0.3s ease;
        max-width: var(--card-max-width);
      }

      /* Prevent any layout shift during initial load */
      body:not(.loaded) * {
        transition: none !important;
      }

      /* Breadcrumb Styles sind jetzt in breadcrumb.js enthalten */
    </style>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="/styles/lib/fontawesome.min.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />
    <link rel="stylesheet" href="/styles/blackboard-widget.css" />
  </head>
  <body>
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Breadcrumb Navigation (au√üerhalb der Sections f√ºr permanente Sichtbarkeit) -->
        <div id="breadcrumb-container"></div>

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section">
          <!-- Dashboard Stats Grid -->
          <div class="dashboard-grid">
            <div class="stat-card">
              <div class="stat-value" id="employee-count">0</div>
              <div class="stat-label">Mitarbeiter</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="document-count">0</div>
              <div class="stat-label">Dokumente</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="department-count">0</div>
              <div class="stat-label">Abteilungen</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="team-count">0</div>
              <div class="stat-label">Teams</div>
            </div>
          </div>

          <!-- Blackboard Widget -->
          <div id="blackboard-widget-container" style="margin-top: 2rem" data-sidebar-state="loading"></div>

          <!-- Main Grid Container -->
          <div class="admin-grid">
            <!-- Employee Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Mitarbeiter</h2>
                <p class="text-secondary" style="margin: 0; margin-top: 4px">Mitarbeiter verwalten und hinzuf√ºgen</p>
              </div>
              <div class="compact-content">
                <button class="btn btn-primary btn-block mb-3" id="new-employee-button" onclick="showEmployeeModal()">
                  Neuer Mitarbeiter
                </button>
                <div class="compact-list" id="recent-employees">
                  <!-- Wird dynamisch gef√ºllt: Letzte 5 Mitarbeiter -->
                </div>
                <a href="#" class="view-all-link" id="manage-employees-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Document Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Dokumente</h2>
                <p class="text-secondary" style="margin: 0; margin-top: 4px">Dokumente hochladen und verwalten</p>
              </div>
              <div class="compact-content">
                <a href="/document-upload" class="btn btn-primary btn-block mb-3">Dokument hochladen</a>
                <div class="compact-list" id="recent-documents">
                  <!-- Wird dynamisch gef√ºllt: Letzte 5 Dokumente -->
                </div>
                <a href="/documents-search" class="view-all-link" id="manage-documents-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Department Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Abteilungen</h2>
                <p class="text-secondary" style="margin: 0; margin-top: 4px">Abteilungsstruktur organisieren</p>
              </div>
              <div class="compact-content">
                <a href="/departments" class="btn btn-primary btn-block mb-3">Abteilungen verwalten</a>
                <div class="compact-list" id="department-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </div>
                <a href="#" class="view-all-link" id="manage-departments-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Team Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Teams</h2>
                <p class="text-secondary" style="margin: 0; margin-top: 4px">Teams erstellen und verwalten</p>
              </div>
              <div class="compact-content">
                <button class="btn btn-primary btn-block mb-3" onclick="showTeamModal()">Neues Team</button>
                <div class="compact-list" id="team-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </div>
                <a href="#" class="view-all-link" onclick="showAllTeams()">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Kalender Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Kalender</h2>
                <p class="text-secondary" style="margin: 0; margin-top: 4px">Termine und Events verwalten</p>
              </div>
              <div class="compact-content">
                <a href="/calendar" class="btn btn-primary btn-block mb-3">Kalender √∂ffnen</a>
                <div class="compact-list" id="calendar-events-list">
                  <!-- Wird dynamisch gef√ºllt -->
                  <div class="list-item">
                    <div class="list-item-content">
                      <strong>N√§chste Termine</strong>
                      <p class="text-secondary">Keine anstehenden Termine</p>
                    </div>
                  </div>
                </div>
                <a href="/calendar" class="view-all-link">
                  Alle anzeigen
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Recently Added Section -->
          <div class="card mt-4">
            <div class="card-header">
              <h2 class="card-title">K√ºrzlich hinzugef√ºgt</h2>
              <p class="text-secondary" style="margin: 0; margin-top: 4px">Neueste Mitarbeiter und Dokumente</p>
            </div>
            <div class="recent-activity-grid">
              <div class="recent-section">
                <h3>Neue Mitarbeiter</h3>
                <ul id="recent-employees-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
              <div class="recent-section">
                <h3>Neue Dokumente</h3>
                <ul id="recent-documents-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
              <div class="recent-section">
                <h3>Aktivit√§ten</h3>
                <ul id="recent-activities-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Payslips Section removed - now using documents-payroll.html -->

        <!-- Employees Section -->
        <section id="employees-section" class="content-section" style="display: none">
          <button class="btn btn-primary mb-3" id="employees-section-new-button" onclick="showNewEmployeeModal()">Neuer Mitarbeiter</button>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Mitarbeiter√ºbersicht</h2>
              <p class="text-secondary" style="margin: 0; margin-top: 4px">Alle Mitarbeiter verwalten und bearbeiten</p>
            </div>
            <div class="flex-between mb-3">
              <div class="filter-buttons">
                <button id="show-all-employees" class="btn btn-sm btn-primary">Alle anzeigen</button>
                <button id="filter-employees-active" class="btn btn-sm btn-secondary">Aktive anzeigen</button>
                <button id="filter-employees-inactive" class="btn btn-sm btn-secondary">Inaktive anzeigen</button>
              </div>
              <div class="search-container">
                <input type="text" id="employee-search" class="search-input" placeholder="Name, E-Mail oder Position..." />
                <button id="employee-search-btn" class="btn btn-secondary">Suchen</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>E-Mail</th>
                    <th>Mitarbeiter-ID</th>
                    <th>Position</th>
                    <th>Abteilung</th>
                    <th>Status</th>
                    <th>Verf√ºgbarkeit</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="employees-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Documents Section -->
        <section id="documents-section" class="content-section" style="display: none">
          <div class="flex-between mb-3">
            <div>
              <button class="btn btn-primary" onclick="window.location.href='/document-upload'">
                <i class="fas fa-upload me-2"></i>
                Dokument hochladen
              </button>
              <a href="/documents" class="btn btn-secondary ms-2">Zur Dokumenten√ºbersicht</a>
            </div>
            <div class="search-container">
              <input type="text" id="document-search" class="search-input" placeholder="Dokumentname, Mitarbeiter oder Kategorie..." />
              <button id="document-search-btn" class="btn btn-secondary">Suchen</button>
            </div>
          </div>

          <div class="mb-3">
            <button id="show-all-documents" class="btn btn-sm btn-secondary">Alle anzeigen</button>
            <button id="filter-documents-archived" class="btn btn-sm btn-secondary">Archivierte anzeigen</button>
            <button id="filter-documents-active" class="btn btn-sm btn-secondary">Aktive anzeigen</button>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Dokumenten√ºbersicht</h2>
              <p class="text-secondary" style="margin: 0; margin-top: 4px">Alle Dokumente verwalten und durchsuchen</p>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Dateiname</th>
                    <th>Mitarbeiter</th>
                    <th>Kategorie</th>
                    <th>Hochgeladen am</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="documents-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Departments Section -->
        <!-- Departments Section wurde nach departments.html verschoben -->

        <!-- Teams Section -->
        <section id="teams-section" class="content-section" style="display: none">
          <button class="btn btn-primary mb-3" onclick="showTeamModal()">Neues Team</button>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Team√ºbersicht</h2>
              <p class="text-secondary" style="margin: 0; margin-top: 4px">Teams und Mitgliedschaften verwalten</p>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Abteilung</th>
                    <th>Beschreibung</th>
                    <th>Mitglieder</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="teams-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="content-section" style="display: none">
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">System-Einstellungen</h2>
            </div>
            <p>Einstellungen werden hier implementiert...</p>
          </div>
        </section>
      </main>
    </div>

    <!-- Modals -->
    <!-- Department Modal wurde nach departments.html verschoben -->

    <!-- Team Modal -->
    <div id="team-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Neues Team</h3>
          <button class="modal-close" onclick="hideTeamModal()">&times;</button>
        </div>
        <form id="team-form">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Beschreibung</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Abteilung</label>
            <select name="department_id" class="form-control">
              <option value="">Keine Abteilung</option>
              <!-- Wird dynamisch gef√ºllt -->
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Team erstellen</button>
        </form>
      </div>
    </div>

    <!-- Employee Status Modal -->
    <div id="employee-status-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Mitarbeiter-Status √§ndern</h3>
          <button class="modal-close" onclick="hideModal('employee-status-modal')">&times;</button>
        </div>
        <form id="employee-status-form">
          <input type="hidden" id="status-employee-id" />
          <div class="form-group">
            <label class="form-label">Mitarbeiter</label>
            <input type="text" id="status-employee-name" class="form-control" readonly />
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="employee-status-display" onclick="toggleDropdown('employee-status')">
                <span>Verf√ºgbar</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="employee-status-dropdown" style="display: none">
                <div class="dropdown-option" onclick="selectDropdownOption('employee-status', 'available', 'Verf√ºgbar')">
                  <span class="badge badge-success">Verf√ºgbar</span>
                </div>
                <div class="dropdown-option" onclick="selectDropdownOption('employee-status', 'vacation', 'Urlaub')">
                  <span class="badge badge-warning">Urlaub</span>
                </div>
                <div class="dropdown-option" onclick="selectDropdownOption('employee-status', 'sick', 'Krank')">
                  <span class="badge badge-danger">Krank</span>
                </div>
                <div class="dropdown-option" onclick="selectDropdownOption('employee-status', 'unavailable', 'Beurlaubt')">
                  <span class="badge badge-secondary">Beurlaubt</span>
                </div>
              </div>
              <input type="hidden" name="status" id="employee-status-select" value="available" />
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Von Datum</label>
            <input type="date" name="start_date" id="availability-start-date" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Bis Datum</label>
            <input type="date" name="end_date" id="availability-end-date" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Notiz (optional)</label>
            <textarea name="notes" class="form-control" rows="3" placeholder="z.B. Familienurlaub, Krankmeldung bis..."></textarea>
          </div>
          <div class="button-group">
            <button type="submit" class="btn btn-primary">Status speichern</button>
            <button type="button" class="btn btn-secondary" onclick="hideModal('employee-status-modal')">Abbrechen</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Employee Modal -->
    <div id="employee-modal" class="modal" style="display: none" data-debug="employee-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Neuer Mitarbeiter</h3>
          <button class="modal-close" id="close-employee-modal">&times;</button>
        </div>
        <form id="create-employee-form">
          <div class="form-group">
            <label class="form-label">E-Mail</label>
            <input type="email" name="email" id="email" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">E-Mail best√§tigen</label>
            <input type="email" name="email_confirm" id="email_confirm" class="form-control" required />
            <small id="email-error" class="error-message" style="color: red; display: none">
              Die E-Mail-Adressen stimmen nicht √ºberein
            </small>
          </div>
          <div class="form-group">
            <label class="form-label">Passwort</label>
            <input type="password" name="password" id="password" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Passwort best√§tigen</label>
            <input type="password" name="password_confirm" id="password_confirm" class="form-control" required />
            <small id="password-error" class="error-message" style="color: red; display: none">Die Passw√∂rter stimmen nicht √ºberein</small>
          </div>
          <div class="form-group">
            <label class="form-label">Vorname</label>
            <input type="text" name="first_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Nachname</label>
            <input type="text" name="last_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Alter</label>
            <input type="number" name="age" class="form-control" min="18" max="100" required />
          </div>
          <!-- Mitarbeiter-ID wird automatisch generiert -->
          <!-- IBAN-Feld wurde entfernt -->
          <div class="form-group">
            <label class="form-label">Position</label>
            <input type="text" name="position" class="form-control" />
          </div>
          <div class="form-group">
            <label class="form-label">Abteilung</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="employee-department-display" onclick="toggleDropdown('employee-department')">
                <span>Keine Abteilung</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="employee-department-dropdown" style="display: none">
                <div class="dropdown-option" data-value="" onclick="selectDropdownOption('employee-department', '', 'Keine Abteilung')">
                  Keine Abteilung
                </div>
                <!-- Wird dynamisch gef√ºllt -->
              </div>
              <input type="hidden" name="department_id" id="employee-department-select" />
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn btn-primary">Mitarbeiter erstellen</button>
            <button type="button" class="btn btn-secondary" id="cancel-employee-button">Abbrechen</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Document Modal -->
    <div id="document-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Dokument hochladen</h3>
          <button class="modal-close" onclick="hideModal('document-modal')">&times;</button>
        </div>
        <form id="document-upload-form" enctype="multipart/form-data">
          <div class="form-group">
            <label class="form-label">Mitarbeiter ausw√§hlen</label>
            <select name="employeeId" id="upload-employee-select" class="form-control" required>
              <option value="">Bitte w√§hlen...</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Dokumenttyp</label>
            <select name="category" class="form-control">
              <option value="payslip">Lohnabrechnung</option>
              <option value="contract">Vertrag</option>
              <option value="certificate">Bescheinigung</option>
              <option value="other">Sonstiges</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Datei ausw√§hlen</label>
            <input type="file" name="document" class="form-control" accept="application/pdf" required />
          </div>
          <button type="submit" class="btn btn-primary">Dokument hochladen</button>
        </form>
      </div>
    </div>

    <!-- Department Modal ist bereits weiter oben definiert -->
    <!-- Team Modal ist bereits weiter oben definiert -->

    <!-- Modal Styles -->
    <style>
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        animation: fadeInUp 0.3s ease-out;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--text-secondary);
        cursor: pointer;
      }

      .modal-close:hover {
        color: var(--text-primary);
      }

      .table-row-inactive {
        background-color: rgba(255, 165, 0, 0.1);
      }

      .table-row-archived {
        background-color: rgba(128, 128, 128, 0.1);
      }

      .modal form {
        padding: var(--spacing-lg);
      }

      /* Button Group Styles */
      .btn-group {
        display: inline-flex;
        vertical-align: middle;
        gap: 4px;
      }

      .btn-group > .btn {
        position: relative;
        flex: 0 1 auto;
      }

      /* Utility Classes */
      .me-1 {
        margin-right: 0.25rem !important;
      }

      /* Better button styles for tables */
      .table .btn-sm {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
        line-height: 1.5;
        border-radius: var(--radius-sm);
      }
    </style>

    <!-- Custom Dropdown Styles -->
    <style>
      .custom-dropdown {
        position: relative;
        width: 100%;
      }

      .dropdown-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .dropdown-display:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .dropdown-display.active svg {
        transform: rotate(180deg);
      }

      .dropdown-display svg {
        transition: transform 0.3s ease;
      }

      .dropdown-options {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.98);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        max-height: 200px;
        overflow-y: auto;
        z-index: 1001;
      }

      .dropdown-option {
        padding: 10px 12px;
        color: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .dropdown-option:last-child {
        border-bottom: none;
      }

      .dropdown-option:hover {
        background: rgba(33, 150, 243, 0.2);
        color: white;
        padding-left: 16px;
      }
    </style>

    <!-- JavaScript -->
    <!-- Verhindert mehrfache Best√§tigungsdialoge -->
    <script type="module" src="/scripts/confirm-once.ts"></script>

    <script>
      console.log('Admin dashboard HTML loaded');

      // Globale Modal-Funktionen direkt definieren
      window.showModal = function (modalId) {
        console.log('showModal called with:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found, showing it');
          modal.style.display = 'flex';
        } else {
          console.error('Modal element not found:', modalId);
        }
      };

      window.hideModal = function (modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'none';
        } else {
          console.error('Modal element not found:', modalId);
        }
      };
    </script>

    <!-- Performance Monitoring Script -->
    <script>
      // Add performance monitoring to all fetch requests
      (function () {
        const originalFetch = window.fetch;
        let requestCounter = 0;

        window.fetch = function (...args) {
          const requestId = ++requestCounter;
          const url = args[0];
          const startTime = performance.now();

          console.log(`[Performance] Request #${requestId} starting: ${url}`);

          return originalFetch
            .apply(this, args)
            .then((response) => {
              const endTime = performance.now();
              const duration = (endTime - startTime).toFixed(2);
              console.log(`[Performance] Request #${requestId} completed: ${url} - ${duration}ms (Status: ${response.status})`);
              return response;
            })
            .catch((error) => {
              const endTime = performance.now();
              const duration = (endTime - startTime).toFixed(2);
              console.error(`[Performance] Request #${requestId} failed: ${url} - ${duration}ms`, error);
              throw error;
            });
        };

        // Log page load performance
        window.addEventListener('load', () => {
          const perfData = performance.getEntriesByType('navigation')[0];
          if (perfData) {
            console.log('[Performance] Page Load Metrics:');
            console.log(`  - DOM Content Loaded: ${perfData.domContentLoadedEventEnd.toFixed(2)}ms`);
            console.log(`  - Load Complete: ${perfData.loadEventEnd.toFixed(2)}ms`);
            console.log(`  - Total Resources: ${performance.getEntriesByType('resource').length}`);
          }
        });
      })();
    </script>

    <!-- Unified Navigation -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
    <script type="module" src="/scripts/show-section.ts"></script>
    <script type="module" src="/scripts/admin-dashboard.ts"></script>
    <script type="module" src="/scripts/employee-deletion.ts"></script>
    <script type="module" src="/scripts/role-switch.ts"></script>
    <script src="/scripts/blackboard-widget.js" type="module"></script>

    <!-- Breadcrumb Component -->
    <script type="module">
      import { initBreadcrumb } from '/scripts/components/breadcrumb.js';
      // Breadcrumb wird automatisch generiert basierend auf der URL
      initBreadcrumb();
    </script>

    <!-- Initialize dashboard on page load -->
    <script type="module">
      // Check if user should be on admin dashboard by reading from JWT token
      const token = localStorage.getItem('token');
      let activeRole = null;
      let userRole = localStorage.getItem('userRole');

      // Parse the JWT token to get the actual active role
      if (token) {
        try {
          const payload = JSON.parse(atob(token.split('.')[1]));
          activeRole = payload.activeRole || payload.role;
          userRole = payload.role;

          // Update localStorage to match token
          localStorage.setItem('activeRole', activeRole);
          if (userRole) {
            localStorage.setItem('userRole', userRole);
          }

          console.log('[Admin Dashboard] Token analysis:', {
            tokenRole: payload.role,
            tokenActiveRole: payload.activeRole,
            finalActiveRole: activeRole,
          });
        } catch (e) {
          console.error('[Admin Dashboard] Error parsing token:', e);
          activeRole = localStorage.getItem('activeRole') || userRole;
        }
      } else {
        activeRole = localStorage.getItem('activeRole') || userRole;
      }

      // Admin and root users can access admin dashboard when in admin mode
      if ((userRole === 'admin' || userRole === 'root') && activeRole === 'admin') {
        // User is correctly on admin dashboard
        console.log('[Admin Dashboard] User has admin access');
      } else if ((userRole === 'admin' || userRole === 'root') && activeRole === 'employee') {
        // User has switched to employee role - redirect
        console.log('[Admin Dashboard] User has switched to employee - redirecting');
        window.location.replace('/employee-dashboard');
      } else if (userRole === 'root' && activeRole === 'root') {
        // Root user is in root mode - redirect to root dashboard
        console.log('[Admin Dashboard] Root user in root mode - redirecting to root dashboard');
        window.location.replace('/root-dashboard');
      } else if (userRole === 'employee') {
        // Employee trying to access admin dashboard - redirect
        console.log('[Admin Dashboard] Employee detected - redirecting to employee dashboard');
        window.location.replace('/employee-dashboard');
      } else if (!userRole) {
        // No user role - redirect to login
        console.log('[Admin Dashboard] No user role - redirecting to login');
        window.location.replace('/login');
      }

      // Ensure dashboard section is shown on page load
      document.addEventListener('DOMContentLoaded', () => {
        // Small delay to ensure all modules are loaded
        setTimeout(() => {
          // Check if a specific section was requested in URL
          const urlParams = new URLSearchParams(window.location.search);
          const requestedSection = urlParams.get('section');

          // If no specific section or 'dashboard-section' requested, show dashboard
          if (!requestedSection || requestedSection === 'dashboard-section' || requestedSection === 'dashboard') {
            // Use showSection directly (it's already imported statically)
            if (typeof showSection === 'function') {
              showSection('dashboard');
            } else {
              // Fallback if function not available
              const dashboardSection = document.getElementById('dashboard-section');
              if (dashboardSection) {
                // Hide all sections
                document.querySelectorAll('.content-section').forEach((section) => {
                  section.style.display = 'none';
                });
                // Show dashboard
                dashboardSection.style.display = 'block';
              }
            }
          }
        }, 100);
      });
    </script>
    <script>
      // Direkte Event-Listener hinzuf√ºgen
      console.log('Adding direct event listeners');

      // Performance monitoring helper
      function measurePerformance(label, fn) {
        const startTime = performance.now();
        console.log(`[Performance] Starting: ${label}`);

        const result = fn();

        if (result && result.then) {
          // Handle promises
          return result
            .then((res) => {
              const endTime = performance.now();
              console.log(`[Performance] Completed: ${label} - ${(endTime - startTime).toFixed(2)}ms`);
              return res;
            })
            .catch((err) => {
              const endTime = performance.now();
              console.error(`[Performance] Failed: ${label} - ${(endTime - startTime).toFixed(2)}ms`, err);
              throw err;
            });
        } else {
          // Handle synchronous functions
          const endTime = performance.now();
          console.log(`[Performance] Completed: ${label} - ${(endTime - startTime).toFixed(2)}ms`);
          return result;
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        console.log('[Performance] DOMContentLoaded event fired');
        const pageStartTime = performance.now();
        // Event-Listener f√ºr das Schlie√üen des Mitarbeiter-Modals
        const closeEmployeeModalBtn = document.getElementById('close-employee-modal');
        const cancelEmployeeBtn = document.getElementById('cancel-employee-button');
        const employeeModal = document.getElementById('employee-modal');

        if (closeEmployeeModalBtn && employeeModal) {
          console.log('Close employee modal button found, adding event listener');
          closeEmployeeModalBtn.addEventListener('click', function () {
            console.log('Close button clicked, hiding employee modal');
            employeeModal.style.display = 'none';
          });
        }

        if (cancelEmployeeBtn && employeeModal) {
          console.log('Cancel employee button found, adding event listener');
          cancelEmployeeBtn.addEventListener('click', function () {
            console.log('Cancel button clicked, hiding employee modal');
            employeeModal.style.display = 'none';
          });
        }

        // Schlie√üen des Modals beim Klick au√üerhalb
        employeeModal?.addEventListener('click', function (event) {
          if (event.target === employeeModal) {
            console.log('Clicked outside modal content, hiding employee modal');
            employeeModal.style.display = 'none';
          }
        });
        console.log('DOM loaded, setting up debugging handlers');

        // Debug-Funktionen f√ºr alle Buttons (ENTFERNT - blockiert role-switch)
        // document.querySelectorAll('button').forEach((button) => {
        //   console.log('Found button:', button.textContent || button.innerHTML);
        //   button.addEventListener('click', function (e) {
        //     console.log('Button clicked:', this.textContent || this.innerHTML);
        //   });
        // });

        // Spezieller Listener f√ºr den Dokument-Upload-Button
        const docUploadBtn = document.querySelector('button[type="submit"]');
        if (docUploadBtn && docUploadBtn.textContent.includes('Gehaltsabrechnung hochladen')) {
          console.log('Dokument Upload Button gefunden:', docUploadBtn.textContent);
          // Button ist bereits Teil eines Formulars, kein zus√§tzlicher Listener n√∂tig
        } else {
          console.log('Dokument Upload Button ist ein Submit-Button im Formular');
        }

        // Direkter Link f√ºr Sidebar-Links
        document.querySelectorAll('.sidebar-link').forEach((link) => {
          console.log('Found sidebar link:', link.textContent);
          link.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            console.log('Sidebar link clicked:', href);

            if (href === '#departments') {
              e.preventDefault();
              window.location.href = '/departments';
            } else if (href === '#employees') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing employees section');
              showSection('employees');
            } else if (href === '#documents') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing documents section');
              showSection('documents');
            } else if (href === '#teams') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing teams section');
              showSection('teams');
            } else if (href === '#settings') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing settings section');
              showSection('settings');
            }
          });
        });

        // Department button code removed - button doesn't exist in HTML

        // Listener f√ºr "Abteilungen verwalten" Link wurde entfernt - Navigation erfolgt jetzt direkt
      });
    </script>
    <script>
      // Custom Dropdown Funktionen
      function toggleDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId + '-dropdown');
        const display = document.getElementById(dropdownId + '-display');

        if (dropdown && display) {
          dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
          display.classList.toggle('active');

          // Optional: Close when clicking outside
          if (dropdown.style.display === 'block') {
            setTimeout(() => {
              document.addEventListener('click', function closeDropdown(e) {
                if (!e.target.closest('.custom-dropdown')) {
                  dropdown.style.display = 'none';
                  display.classList.remove('active');
                  document.removeEventListener('click', closeDropdown);
                }
              });
            }, 100);
          }
        }
      }

      function selectDropdownOption(dropdownId, value, text) {
        const hiddenInput = document.getElementById(dropdownId + '-select');
        const display = document.getElementById(dropdownId + '-display');
        const dropdown = document.getElementById(dropdownId + '-dropdown');

        if (hiddenInput && display && dropdown) {
          hiddenInput.value = value;
          display.querySelector('span').textContent = text;
          dropdown.style.display = 'none';
          display.classList.remove('active');

          // Spezielle Logik f√ºr Employee Status Dropdown
          if (dropdownId === 'employee-status') {
            const startDateInput = document.getElementById('availability-start-date');
            const endDateInput = document.getElementById('availability-end-date');

            if (startDateInput && endDateInput) {
              if (value === 'available') {
                // Bei "Verf√ºgbar" Datumsfelder deaktivieren und leeren
                startDateInput.disabled = true;
                endDateInput.disabled = true;
                startDateInput.value = '';
                endDateInput.value = '';
                startDateInput.removeAttribute('required');
                endDateInput.removeAttribute('required');
              } else {
                // Bei anderen Status Datumsfelder aktivieren
                startDateInput.disabled = false;
                endDateInput.disabled = false;
                startDateInput.setAttribute('required', 'required');
                endDateInput.setAttribute('required', 'required');
              }
            }
          }
        }
      }
    </script>
    <script>
      // Funktionstabelle direkt definieren

      // Departments-Tabelle wurde nach departments.html verschoben

      // Department-Funktionen wurden nach departments.html verschoben

      // Department-Funktionen wurden nach departments.html verschoben

      // Load documents table
      async function loadDocumentsTable() {
        console.log('Loading documents table');
        const token = localStorage.getItem('token');

        try {
          const response = await fetch('/api/documents', {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const data = await response.json();
            const documents = data.documents || data;
            console.log(`Loaded ${documents.length} documents`);

            const tbody = document.getElementById('documents-table-body');
            if (tbody) {
              tbody.innerHTML = documents
                .map((doc) => {
                  // Bestimme den Empf√§nger-Text basierend auf recipient_type
                  let recipientDisplay = '-';
                  if (doc.recipient_type === 'user' && doc.employee_name) {
                    recipientDisplay = doc.employee_name;
                  } else if (doc.recipient_type === 'team' && doc.team_name) {
                    recipientDisplay = `Team: ${doc.team_name}`;
                  } else if (doc.recipient_type === 'department' && doc.department_name) {
                    recipientDisplay = `Abteilung: ${doc.department_name}`;
                  } else if (doc.recipient_type === 'company') {
                    recipientDisplay = 'Gesamte Firma';
                  } else if (doc.employee_name) {
                    // Fallback f√ºr alte Dokumente
                    recipientDisplay = doc.employee_name;
                  }

                  return `
                    <tr>
                      <td>${doc.file_name || doc.filename || '-'}</td>
                      <td>${recipientDisplay}</td>
                      <td>${doc.category || '-'}</td>
                      <td>${doc.upload_date ? new Date(doc.upload_date).toLocaleDateString('de-DE') : '-'}</td>
                      <td>
                        <span class="badge ${doc.is_archived ? 'badge-secondary' : 'badge-success'}">
                          ${doc.is_archived ? 'Archiviert' : 'Aktiv'}
                        </span>
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <button class="btn btn-sm btn-primary" onclick="downloadDocument(${doc.id})" title="Herunterladen">
                            <i class="fas fa-download me-1"></i>
                            Download
                          </button>
                          ${
                            !doc.is_archived
                              ? `
                            <button class="btn btn-sm btn-warning" onclick="archiveDocument(${doc.id})" title="Archivieren">
                              <i class="fas fa-archive me-1"></i>
                              Archiv
                            </button>
                          `
                              : ''
                          }
                          <button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})" title="L√∂schen">
                            <i class="fas fa-trash me-1"></i>
                            L√∂schen
                          </button>
                        </div>
                      </td>
                    </tr>
                  `;
                })
                .join('');
            }
          }
        } catch (error) {
          console.error('Error loading documents:', error);
        }
      }

      // Mitarbeiter-Status √§ndern
      async function changeEmployeeStatus(employeeId) {
        console.log(`Changing status for employee ${employeeId}`);
        const token = localStorage.getItem('token');

        try {
          // Mitarbeiter-Daten laden
          const response = await fetch(`/api/users/${employeeId}`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (!response.ok) {
            console.error('Response not OK:', response.status, response.statusText);
            const errorData = await response.text();
            console.error('Error data:', errorData);
            throw new Error('Failed to load employee data');
          }

          const employee = await response.json();
          console.log('Employee data loaded:', employee);

          // Modal-Felder bef√ºllen
          const employeeIdInput = document.getElementById('status-employee-id');
          const employeeName = document.getElementById('status-employee-name');
          const statusDropdown = document.getElementById('employee-status-dropdown');
          const statusDisplay = document.getElementById('employee-status-display');

          console.log('DOM Elements:', {
            employeeIdInput: employeeIdInput,
            employeeName: employeeName,
            employeeNameType: employeeName ? employeeName.tagName : 'null',
          });

          if (employeeIdInput) {
            employeeIdInput.value = employeeId;
            console.log('Set employee ID:', employeeId);
          }
          if (employeeName) {
            const fullName = `${employee.first_name || ''} ${employee.last_name || ''}`;
            employeeName.value = fullName;
            console.log('Set employee name:', fullName);
          } else {
            console.error('Employee name input not found!');
          }

          // Aktuellen Status setzen
          const currentStatus = employee.availability_status || 'available';
          if (statusDisplay) {
            const statusText =
              {
                available: 'Verf√ºgbar',
                vacation: 'Urlaub',
                sick: 'Krank',
                unavailable: 'Nicht verf√ºgbar',
              }[currentStatus] || 'Verf√ºgbar';
            statusDisplay.querySelector('span').textContent = statusText;
          }

          // Datumsfelder initial setzen
          const startDateInput = document.getElementById('availability-start-date');
          const endDateInput = document.getElementById('availability-end-date');

          if (startDateInput && endDateInput) {
            if (currentStatus === 'available') {
              // Bei "Verf√ºgbar" Datumsfelder deaktivieren
              startDateInput.disabled = true;
              endDateInput.disabled = true;
              startDateInput.value = '';
              endDateInput.value = '';
              startDateInput.removeAttribute('required');
              endDateInput.removeAttribute('required');
            } else {
              // Bei anderen Status Datumsfelder aktivieren und vorhandene Werte setzen
              startDateInput.disabled = false;
              endDateInput.disabled = false;
              startDateInput.setAttribute('required', 'required');
              endDateInput.setAttribute('required', 'required');

              // Vorhandene Daten setzen falls vorhanden
              if (employee.availability_start) {
                startDateInput.value = employee.availability_start.split('T')[0];
              }
              if (employee.availability_end) {
                endDateInput.value = employee.availability_end.split('T')[0];
              }
            }
          }

          // Modal √∂ffnen
          const modal = document.getElementById('employee-status-modal');
          if (modal) {
            modal.style.display = 'flex';
            console.log('Modal opened');

            // Form zur√ºcksetzen - NACH dem Setzen der Werte!
            // Das war das Problem - form.reset() l√∂scht alle Werte
            const form = document.getElementById('employee-status-form');
            if (form) {
              // Nur die Date-Felder und Notes zur√ºcksetzen, nicht alle Felder
              const startDate = form.querySelector('input[name="start_date"]');
              const endDate = form.querySelector('input[name="end_date"]');
              const notes = form.querySelector('textarea[name="notes"]');

              if (startDate) startDate.value = '';
              if (endDate) endDate.value = '';
              if (notes) notes.value = '';

              // Hidden input f√ºr status setzen
              const hiddenInput = form.querySelector('input[name="status"]');
              if (hiddenInput) hiddenInput.value = currentStatus;
            }
          }
        } catch (error) {
          console.error('Error loading employee for status change:', error);
          alert('Fehler beim Laden der Mitarbeiterdaten');
        }
      }

      // Employee Status Form Submit Handler
      document.addEventListener('DOMContentLoaded', () => {
        const statusForm = document.getElementById('employee-status-form');
        if (statusForm) {
          statusForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(statusForm);
            const employeeId = document.getElementById('status-employee-id').value;
            const token = localStorage.getItem('token');

            const statusData = {
              availability_status: formData.get('status'),
              availability_start: formData.get('start_date'),
              availability_end: formData.get('end_date'),
              availability_notes: formData.get('notes'),
            };

            try {
              const response = await fetch(`/api/users/${employeeId}/availability`, {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json',
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify(statusData),
              });

              if (response.ok) {
                alert('Verf√ºgbarkeitsstatus erfolgreich aktualisiert');
                hideModal('employee-status-modal');
                // Seite neu laden f√ºr vollst√§ndige Aktualisierung
                window.location.reload();
              } else {
                const error = await response.json();
                alert(`Fehler: ${error.message || 'Status konnte nicht aktualisiert werden'}`);
              }
            } catch (error) {
              console.error('Error updating availability status:', error);
              alert('Ein Fehler ist aufgetreten beim Aktualisieren des Status');
            }
          });
        }
      });

      // Abteilung l√∂schen
      async function deleteDepartment(departmentId) {
        console.log(`Deleting department ${departmentId}`);
        if (!confirm('Sind Sie sicher, dass Sie diese Abteilung l√∂schen m√∂chten?')) {
          return;
        }

        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/departments/${departmentId}`, {
            method: 'DELETE',
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            alert('Abteilung erfolgreich gel√∂scht');
            loadDepartmentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error deleting department:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Mitarbeiter bearbeiten
      async function editEmployeeAsync(employeeId) {
        console.log(`Editing employee ${employeeId}`);
        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const employee = await response.json();
            console.log('Employee data:', employee);

            // Erstelle ein Modal f√ºr die Bearbeitung
            const modalHTML = `
                        <div class="modal" id="edit-employee-modal" style="display: flex;">
                            <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                                <div class="modal-header">
                                    <h3 class="modal-title">Mitarbeiter bearbeiten</h3>
                                    <button type="button" class="modal-close" onclick="document.getElementById('edit-employee-modal').remove()">&times;</button>
                                </div>
                                <form id="edit-employee-form">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div class="form-group">
                                            <label class="form-label">Benutzername</label>
                                            <input type="text" name="username" class="form-control" value="${employee.username || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">E-Mail</label>
                                            <input type="email" name="email" class="form-control" value="${employee.email || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Vorname</label>
                                            <input type="text" name="first_name" class="form-control" value="${employee.first_name || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Nachname</label>
                                            <input type="text" name="last_name" class="form-control" value="${employee.last_name || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Telefon</label>
                                            <input type="tel" name="phone" class="form-control" value="${employee.phone || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Position</label>
                                            <input type="text" name="position" class="form-control" value="${employee.position || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Abteilung</label>
                                            <div class="custom-dropdown">
                                                <div class="dropdown-display" id="edit-employee-department-display" onclick="toggleDropdown('edit-employee-department')">
                                                    <span>${employee.department || 'Keine Abteilung'}</span>
                                                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                                        <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                                    </svg>
                                                </div>
                                                <div class="dropdown-options" id="edit-employee-department-dropdown" style="display: none">
                                                    <div class="dropdown-option" data-value="" onclick="selectDropdownOption('edit-employee-department', '', 'Keine Abteilung')">
                                                        Keine Abteilung
                                                    </div>
                                                    <!-- Wird dynamisch gef√ºllt -->
                                                </div>
                                                <input type="hidden" name="department_id" id="edit-employee-department-select" value="${employee.department_id || ''}" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Geburtsdatum</label>
                                            <input type="date" name="birthday" class="form-control" value="${employee.birthday ? employee.birthday.split('T')[0] : ''}">
                                        </div>
                                        <div class="form-group" style="grid-column: span 2;">
                                            <label class="form-label">Notizen</label>
                                            <textarea name="notes" class="form-control" rows="3">${employee.notes || ''}</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Status</label>
                                            <div class="custom-dropdown">
                                                <div class="dropdown-display" id="edit-employee-status-display" onclick="toggleDropdown('edit-employee-status')">
                                                    <span>${employee.is_active ? 'Aktiv' : 'Inaktiv'}</span>
                                                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                                        <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                                    </svg>
                                                </div>
                                                <div class="dropdown-options" id="edit-employee-status-dropdown" style="display: none">
                                                    <div class="dropdown-option" data-value="1" onclick="selectDropdownOption('edit-employee-status', '1', 'Aktiv')">
                                                        Aktiv
                                                    </div>
                                                    <div class="dropdown-option" data-value="0" onclick="selectDropdownOption('edit-employee-status', '0', 'Inaktiv')">
                                                        Inaktiv
                                                    </div>
                                                </div>
                                                <input type="hidden" name="is_active" id="edit-employee-status-select" value="${employee.is_active ? '1' : '0'}" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Neues Passwort (optional)</label>
                                            <input type="password" name="password" id="edit-employee-password" class="form-control" placeholder="Leer lassen f√ºr keine √Ñnderung">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Passwort best√§tigen</label>
                                            <input type="password" name="password_confirm" id="edit-employee-password-confirm" class="form-control" placeholder="Passwort wiederholen">
                                        </div>
                                    </div>
                                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('edit-employee-modal').remove()">
                                            Abbrechen
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="updateEmployee(${employeeId})">
                                            <i class="fas fa-save"></i> √Ñnderungen speichern
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    `;

            // Modal zum Body hinzuf√ºgen
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Lade Abteilungen f√ºr das Custom Dropdown
            const departmentDropdown = document.getElementById('edit-employee-department-dropdown');
            if (departmentDropdown) {
              // Hilfsfunktion zum Laden der Abteilungen
              const loadDepts = async () => {
                try {
                  const deptResponse = await fetch('/api/departments', {
                    headers: { Authorization: `Bearer ${token}` },
                  });

                  if (deptResponse.ok) {
                    const departments = await deptResponse.json();

                    // Clear existing options and add placeholder
                    departmentDropdown.innerHTML = `
                      <div class="dropdown-option" data-value="" onclick="selectDropdownOption('edit-employee-department', '', 'Keine Abteilung')">
                        Keine Abteilung
                      </div>
                    `;

                    // Add department options
                    departments.forEach((dept) => {
                      const optionDiv = document.createElement('div');
                      optionDiv.className = 'dropdown-option';
                      optionDiv.setAttribute('data-value', dept.id.toString());
                      optionDiv.textContent = dept.name;
                      optionDiv.onclick = () => {
                        selectDropdownOption('edit-employee-department', dept.id.toString(), dept.name);
                      };
                      departmentDropdown.appendChild(optionDiv);

                      // If this is the current department, select it
                      if (dept.id == employee.department_id) {
                        selectDropdownOption('edit-employee-department', dept.id.toString(), dept.name);
                      }
                    });
                  }
                } catch (err) {
                  console.error('Error loading departments:', err);
                }
              };

              loadDepts();
            }
          } else {
            console.error('Failed to load employee data');
            alert('Fehler beim Laden der Mitarbeiterdaten.');
          }
        } catch (error) {
          console.error('Error loading employee:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Mitarbeiter aktualisieren
      async function updateEmployee(employeeId) {
        console.log(`Updating employee ${employeeId}`);
        const token = localStorage.getItem('token');
        const form = document.getElementById('edit-employee-form');

        if (!form) {
          console.error('Edit employee form not found');
          return;
        }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        // Password validation
        if (data.password && data.password.trim() !== '') {
          if (data.password !== data.password_confirm) {
            alert('Die Passw√∂rter stimmen nicht √ºberein!');
            return;
          }
          // Remove password_confirm from data as it's not needed for the API
          delete data.password_confirm;
        } else {
          // Remove both password fields if empty
          delete data.password;
          delete data.password_confirm;
        }

        // Convert string values to proper types
        if (data.department_id === '') {
          data.department_id = null;
        } else if (data.department_id) {
          data.department_id = parseInt(data.department_id);
        }

        // Convert is_active to boolean and add status field
        data.is_active = data.is_active === '1';
        // Also set the status field based on is_active
        data.status = data.is_active ? 'active' : 'inactive';

        // Clean up empty values but keep is_active and status even if false
        Object.keys(data).forEach((key) => {
          if (key !== 'is_active' && key !== 'status' && (data[key] === '' || data[key] === null)) {
            delete data[key];
          }
        });

        // Debug log to check what we're sending
        console.log('Sending update data:', data);

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            alert('Mitarbeiter erfolgreich aktualisiert');
            // Modal schlie√üen
            const modal = document.getElementById('edit-employee-modal');
            if (modal) modal.remove();
            // Tabelle neu laden
            if (typeof loadEmployeesTable === 'function') {
              loadEmployeesTable();
            }
            // Diese Funktionen sind m√∂glicherweise nicht global verf√ºgbar
            if (typeof window.loadRecentEmployees === 'function') {
              window.loadRecentEmployees();
            }
            if (typeof window.loadDashboardStats === 'function') {
              window.loadDashboardStats();
            }
            // Als Fallback die Seite neu laden um alle Daten zu aktualisieren
            if (typeof loadEmployeesTable !== 'function') {
              window.location.reload();
            }
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message || 'Unbekannter Fehler'}`);
          }
        } catch (error) {
          console.error('Error updating employee:', error);
          alert('Ein Fehler ist aufgetreten beim Aktualisieren des Mitarbeiters.');
        }
      }

      // Mitarbeiter l√∂schen
      async function deleteEmployee(employeeId) {
        // This function is now handled by employee-deletion.ts
        // Call the enhanced delete dialog from employee-deletion.ts
        if (window.deleteEmployee) {
          window.deleteEmployee(employeeId);
        } else {
          console.error('Delete employee function not loaded from employee-deletion.ts');
          alert('L√∂schfunktion nicht verf√ºgbar. Bitte laden Sie die Seite neu.');
        }
      }

      // Mitarbeiterstatus √§ndern
      async function toggleEmployeeStatus(employeeId, currentStatus) {
        console.log(`Toggling employee ${employeeId} status from ${currentStatus}`);
        const token = localStorage.getItem('token');
        const newStatus = currentStatus === 'inactive' ? 'active' : 'inactive';

        try {
          const response = await fetch(`/admin/toggle-employee-status/${employeeId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ status: newStatus }),
          });

          if (response.ok) {
            alert(`Mitarbeiterstatus wurde zu "${newStatus}" ge√§ndert`);
            loadEmployeesTable('reload');
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error toggling employee status:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Add event listener for payslip upload form
      document.addEventListener('DOMContentLoaded', () => {
        // Payslip form removed - now using documents-payroll.html
      });

      // Upload payslip function removed - now using documents-payroll.html
      // Logo und √úbersicht verarbeiten
      document.addEventListener('DOMContentLoaded', () => {
        // Logo-Klick behandeln
        const logoContainer = document.querySelector('.logo-container');
        if (logoContainer) {
          logoContainer.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = '/admin-dashboard';
          });
        }

        // √úbersicht-Link in der Seitennavigation
        const dashboardLink = document.querySelector('.sidebar-link[href="#dashboard"]');
        if (dashboardLink) {
          dashboardLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.reload();
          });
        }

        // Logout wird von unified-navigation behandelt
      });

      // Modal functions redefined for redundancy
      function showModal(modalId) {
        console.log('Inline showModal called with:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found in inline function, showing it');
          modal.style.display = 'flex';
        } else {
          console.error('Modal element not found in inline function:', modalId);
        }
      }

      function hideModal(modalId) {
        console.log('hideModal called for:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found in hideModal, hiding it');
          modal.style.display = 'none';
        } else {
          console.error('Modal element not found in hideModal:', modalId);
        }
      }

      function showEmployeeModal() {
        console.log('showEmployeeModal function called');
        const modal = document.getElementById('employee-modal');
        if (modal) {
          console.log('employee-modal found, showing directly');
          modal.style.display = 'flex';
          // Abteilungen f√ºr das Formular laden
          if (typeof loadDepartmentsForEmployeeSelect === 'function') {
            loadDepartmentsForEmployeeSelect();
          } else {
            console.error('loadDepartmentsForEmployeeSelect is not a function');
          }
        } else {
          console.error('employee-modal not found');
          alert('Das Mitarbeiterformular konnte nicht ge√∂ffnet werden.');
        }
      }

      function showDocumentModal() {
        console.log('Document upload modal requested');
        const modal = document.getElementById('document-modal');
        if (modal) {
          console.log('Modal found, showing it');
          modal.style.display = 'flex';
          // Mitarbeiter-Select f√ºllen
          loadEmployeesForSelect();
        } else {
          console.error('Modal element not found!');
          alert('Dokument-Upload-Formular konnte nicht geladen werden.');
        }
      }

      // showDepartmentModal wurde nach departments.html verschoben

      function showTeamModal() {
        showModal('team-modal');
        // Abteilungen f√ºr Select laden
        loadDepartmentsForSelect();
      }

      function hideTeamModal() {
        hideModal('team-modal');
      }

      // Modal schlie√üen bei Klick au√üerhalb
      window.addEventListener('click', function (event) {
        const modals = ['employee-modal', 'document-modal', 'team-modal'];
        modals.forEach((modalId) => {
          const modal = document.getElementById(modalId);
          if (event.target == modal) {
            console.log(`Clicked outside of ${modalId}, closing it`);
            modal.style.display = 'none';
          }
        });
      });

      // Placeholder functions for "view all" links
      function showAllEmployees() {
        console.log('Show all employees');
      }

      // Load employees table
      async function loadEmployeesTable() {
        console.log('Loading employees table...');
        const token = localStorage.getItem('token');

        try {
          const response = await fetch('/api/users?role=employee', {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error('Failed to load employees');
          }

          const employees = await response.json();
          console.log('Loaded employees:', employees); // Debug
          const tableBody = document.getElementById('employees-table-body');

          if (!tableBody) {
            console.error('employees-table-body not found');
            return;
          }

          tableBody.innerHTML = '';

          if (employees.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="8" class="text-center text-muted">Keine Mitarbeiter gefunden</td>
              </tr>
            `;
            return;
          }

          employees.forEach((employee) => {
            const row = document.createElement('tr');

            // Verf√ºgbarkeitsstatus bestimmen - pr√ºfe ob innerhalb des Datumbereichs
            let effectiveStatus = employee.availability_status || 'available';
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Zeit auf Mitternacht setzen f√ºr korrekten Vergleich

            // Debug-Ausgabe f√ºr ersten Mitarbeiter
            if (employee.id === 19) {
              console.log('Employee 19 debug:', {
                availability_status: employee.availability_status,
                availability_start: employee.availability_start,
                availability_end: employee.availability_end,
                today: today.toISOString(),
              });
            }

            // Pr√ºfe ob Verf√ºgbarkeitsdaten vorhanden sind und ob wir im Zeitraum sind
            if (employee.availability_status !== 'available' && employee.availability_start && employee.availability_end) {
              const startDate = new Date(employee.availability_start);
              const endDate = new Date(employee.availability_end);
              startDate.setHours(0, 0, 0, 0);
              endDate.setHours(23, 59, 59, 999);

              // Debug f√ºr Employee 19
              if (employee.id === 19) {
                console.log('Date comparison:', {
                  startDate: startDate.toISOString(),
                  endDate: endDate.toISOString(),
                  todayIsAfterStart: today >= startDate,
                  todayIsBeforeEnd: today <= endDate,
                  shouldShowStatus: today >= startDate && today <= endDate,
                });
              }

              // Wenn heute au√üerhalb des Zeitraums liegt, ist der Mitarbeiter verf√ºgbar
              if (today < startDate || today > endDate) {
                effectiveStatus = 'available';
              }
            }

            const availabilityBadgeClass =
              {
                available: 'badge-success',
                vacation: 'badge-warning',
                sick: 'badge-danger',
                unavailable: 'badge-secondary',
              }[effectiveStatus] || 'badge-success';

            const availabilityText =
              {
                available: 'Verf√ºgbar',
                vacation: 'Urlaub',
                sick: 'Krank',
                unavailable: 'Beurlaubt',
              }[effectiveStatus] || 'Verf√ºgbar';

            row.innerHTML = `
              <td>${employee.first_name || ''} ${employee.last_name || ''}</td>
              <td>${employee.email || ''}</td>
              <td>${employee.id || ''}</td>
              <td>${employee.position || 'Mitarbeiter'}</td>
              <td>${employee.department || 'Keine Abteilung'}</td>
              <td>
                <span class="badge ${employee.is_active ? 'badge-success' : 'badge-danger'}">
                  ${employee.is_active ? 'Aktiv' : 'Inaktiv'}
                </span>
              </td>
              <td>
                <span class="badge ${availabilityBadgeClass}">
                  ${availabilityText}
                </span>
                ${
                  effectiveStatus !== 'available' && employee.availability_start && employee.availability_end
                    ? `<br><small class="text-muted">${new Date(employee.availability_start).toLocaleDateString('de-DE')} - ${new Date(employee.availability_end).toLocaleDateString('de-DE')}</small>`
                    : ''
                }
              </td>
              <td>
                <button class="btn btn-sm btn-info" onclick="changeEmployeeStatus(${employee.id})">
                  <i class="fas fa-user-clock"></i> Status √§ndern
                </button>
                <button class="btn btn-sm btn-secondary" onclick="editEmployee(${employee.id})">
                  <i class="fas fa-edit"></i> Bearbeiten
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                  <i class="fas fa-trash"></i> L√∂schen
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error('Error loading employees:', error);
          const tableBody = document.getElementById('employees-table-body');
          if (tableBody) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" class="text-center text-danger">Fehler beim Laden der Mitarbeiter</td>
              </tr>
            `;
          }
        }
      }

      // Make functions globally available (delay to ensure they're defined)
      document.addEventListener('DOMContentLoaded', () => {
        window.loadEmployeesTable = loadEmployeesTable;
        window.editEmployee = editEmployee;
        window.editEmployeeAsync = editEmployeeAsync;
        window.updateEmployee = updateEmployee;
        window.deleteEmployee = deleteEmployee;
        window.loadDocumentsTable = loadDocumentsTable || (() => console.log('loadDocumentsTable not implemented'));
        // loadPayslipsTable removed - now using documents-payroll.html
        // loadEmployeesForPayslipSelect removed - now using documents-payroll.html
        // Define loadDepartmentsTable function
        window.loadDepartmentsTable = function () {
          console.log('loadDepartmentsTable called - redirecting to departments page');
          // Since we're using a separate departments page, just reload if needed
          if (window.location.pathname.includes('departments')) {
            window.location.reload();
          }
        };
        // Temporary fix: Define loadTeamsTable if not available
        window.loadTeamsTable =
          window.loadTeamsTable ||
          function () {
            console.log('loadTeamsTable called but not yet implemented');
            // TODO: Implement team loading functionality
          };
        window.loadRecentEmployees = window.loadRecentEmployees || (() => console.log('loadRecentEmployees not implemented'));
        window.loadDashboardStats = window.loadDashboardStats || (() => console.log('loadDashboardStats not implemented'));
      });

      // Edit employee - Placeholder function, actual implementation below
      function editEmployee(employeeId) {
        // This is overridden by the async function below
        window.editEmployeeAsync(employeeId);
      }

      // Delete employee
      async function deleteEmployee(employeeId) {
        if (!confirm('Sind Sie sicher, dass Sie diesen Mitarbeiter l√∂schen m√∂chten?')) {
          return;
        }

        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            method: 'DELETE',
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            alert('Mitarbeiter erfolgreich gel√∂scht');
            loadEmployeesTable(); // Reload the table
            loadRecentEmployees(); // Update recent employees
            loadDashboardStats(); // Update statistics
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error deleting employee:', error);
          alert('Ein Fehler ist aufgetreten');
        }
      }

      function showAllDocuments() {
        console.log('Show all documents');
      }

      function showAllDepartments() {
        window.location.href = '/departments';
      }

      function showAllTeams() {
        console.log('Show all teams');
      }

      // Dokument herunterladen
      async function downloadDocument(documentId) {
        const token = localStorage.getItem('token');
        try {
          window.location.href = `/api/documents/download/${documentId}?token=${token}`;
        } catch (error) {
          console.error('Error downloading document:', error);
          alert('Fehler beim Herunterladen des Dokuments');
        }
      }

      // Dokument archivieren
      async function archiveDocument(documentId) {
        if (!confirm('M√∂chten Sie dieses Dokument archivieren?')) {
          return;
        }

        const token = localStorage.getItem('token');
        try {
          const response = await fetch(`/api/documents/archive/${documentId}`, {
            method: 'PUT',
            headers: {
              Authorization: `Bearer ${token}`,
              'Content-Type': 'application/json',
            },
          });

          if (response.ok) {
            alert('Dokument erfolgreich archiviert');
            loadDocumentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message || 'Unbekannter Fehler'}`);
          }
        } catch (error) {
          console.error('Error archiving document:', error);
          alert('Fehler beim Archivieren des Dokuments');
        }
      }

      // Dokument l√∂schen
      async function deleteDocument(documentId) {
        if (
          !confirm(
            'Sind Sie sicher, dass Sie dieses Dokument dauerhaft l√∂schen m√∂chten? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.',
          )
        ) {
          return;
        }

        const token = localStorage.getItem('token');
        try {
          const response = await fetch(`/api/documents/${documentId}`, {
            method: 'DELETE',
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            alert('Dokument erfolgreich gel√∂scht');
            loadDocumentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message || 'Unbekannter Fehler'}`);
          }
        } catch (error) {
          console.error('Error deleting document:', error);
          alert('Fehler beim L√∂schen des Dokuments');
        }
      }

      // Section Navigation is now handled by show-section.ts module
    </script>

    <style>
      /* Search Styles */
      .search-container {
        display: flex;
        gap: var(--spacing-sm);
        margin-left: auto;
      }

      .search-input {
        min-width: 300px;
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        background-color: var(--background-dark);
        color: var(--text-primary);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
      }

      .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--spacing-md);
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
      }

      .button-group {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        margin-top: 20px;
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: var(--spacing-lg);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: fadeInUp 0.3s ease-out;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-secondary);
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-sm);
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background-color: var(--background-dark);
        color: var(--error-color);
      }

      .table-responsive {
        overflow-x: auto;
        margin-top: var(--spacing-md);
      }

      .btn-group {
        display: flex;
        gap: var(--spacing-sm);
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 20px;
        transition: all 0.2s ease;
      }

      .badge-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .badge-secondary {
        background-color: var(--secondary-color);
        color: white;
      }

      .badge-success {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(76, 175, 80, 0.9);
        background: rgba(76, 175, 80, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(76, 175, 80, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }

      .badge-danger {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(244, 67, 54, 0.9);
        background: rgba(244, 67, 54, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(244, 67, 54, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }

      tr:hover .badge-success {
        background: rgba(76, 175, 80, 0.15);
        border-color: rgba(76, 175, 80, 0.3);
      }

      tr:hover .badge-danger {
        background: rgba(244, 67, 54, 0.15);
        border-color: rgba(244, 67, 54, 0.3);
      }

      .badge-warning {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(255, 152, 0, 0.9);
        background: rgba(255, 152, 0, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(255, 152, 0, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }

      tr:hover .badge-warning {
        background: rgba(255, 152, 0, 0.15);
        border-color: rgba(255, 152, 0, 0.3);
      }

      .department-list,
      .team-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .department-item,
      .team-item {
        padding: var(--spacing-sm);
        background-color: var(--background-dark);
        border-radius: var(--radius-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    </style>

    <!-- Mark body as loaded after all scripts -->
    <script>
      window.addEventListener('load', function () {
        // Add 'loaded' class to enable transitions after initial load
        setTimeout(() => {
          document.body.classList.add('loaded');
        }, 100);
      });
    </script>
  </body>
</html>
