<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      @import url('/styles/dashboard-theme.css');
      /* Glassmorphismus Design-Standards */

      /* Fix for sidebar title alignment */
      .sidebar-title {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 16px;
        margin: 0 0 16px 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        background: rgba(33, 150, 243, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(33, 150, 243, 0.2);
      }

      .sidebar-title .title-icon {
        display: flex;
        align-items: center;
        font-size: 1.1rem;
      }

      /* Dramatischer Hintergrund-Gradient */
      body {
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        background: #000;
      }

      body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          transparent 0%,
          rgba(0, 142, 255, 0.08) 100%,
          #01000482 60%,
          rgba(0, 0, 4, 0.6) 90%,
          black 100%
        );
        pointer-events: none;
        z-index: -1;
      }

      /* Glassmorphismus f√ºr Header */
      .header {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      /* Glassmorphismus f√ºr Sidebar */
      .sidebar {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow:
          8px 0 32px rgba(0, 0, 0, 0.3),
          inset -1px 0 0 rgba(255, 255, 255, 0.1);
      }

      /* Glassmorphismus f√ºr Stat-Cards */
      .stat-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.03);
      }

      /* Glassmorphismus f√ºr Cards */
      .card,
      .compact-card {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
      }

      /* Ansprechendere Compact-Cards */
      .compact-card {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .compact-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .compact-card:hover::before {
        opacity: 1;
      }

      .compact-card:hover {
        transform: translateY(-5px);
        box-shadow:
          0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: rgba(255, 255, 255, 0.03);
      }

      .compact-card .card-header {
        background: rgba(255, 255, 255, 0.01);
        backdrop-filter: blur(10px);
        padding: var(--spacing-md) var(--spacing-lg);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 10px 10px 0 0;
      }

      .compact-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
      }

      .compact-card .card-title::before {
        content: '';
        width: 4px;
        height: 20px;
        background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
        border-radius: 2px;
      }

      .compact-content {
        padding: var(--spacing-lg);
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .compact-list {
        margin: var(--spacing-md) 0;
        flex: 1;
      }

      .compact-list .list-item {
        padding: var(--spacing-sm) var(--spacing-md);
        margin-bottom: var(--spacing-sm);
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius-sm);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.2s ease;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .compact-list .list-item:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(0, 142, 255, 0.3);
        transform: translateX(5px);
        color: var(--text-primary);
      }

      .compact-list .list-item strong {
        color: var(--text-primary);
        font-weight: 500;
      }

      .view-all-link {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.85rem;
        transition: color 0.2s ease;
        padding: 8px 0;
        margin-top: auto;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        text-transform: uppercase;
        letter-spacing: 0.3px;
      }

      .view-all-link:hover {
        color: var(--primary-light);
      }

      .view-all-link .arrow {
        font-size: 0.9rem;
        transition: transform 0.2s ease;
      }

      .view-all-link:hover .arrow {
        transform: translateX(3px);
      }

      /* Button in Compact-Cards */
      .compact-card .btn-block {
        width: 100%;
        padding: 10px 16px;
        font-weight: 500;
        font-size: 0.9rem;
        letter-spacing: 0.3px;
        margin-bottom: var(--spacing-md);
      }

      /* Form-Controls mit Glassmorphismus */
      .form-control,
      .search-input {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        color: #fff;
        transition: all 0.3s ease;
      }

      .form-control:focus,
      .search-input:focus {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(0, 142, 255, 0.5);
        box-shadow:
          0 0 0 3px rgba(0, 142, 255, 0.15),
          inset 0 1px 2px rgba(0, 0, 0, 0.2);
        outline: none;
      }

      /* Buttons mit Glassmorphismus und Shine-Effekt */
      .btn {
        position: relative;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, rgba(0, 142, 255, 0.2), rgba(0, 142, 255, 0.1));
        border-color: rgba(0, 142, 255, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      }

      .btn::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
        transform: rotate(45deg) translate(-70%, -70%);
        transition: transform 0.6s;
      }

      .btn:hover::after {
        transform: rotate(45deg) translate(-30%, -30%);
      }

      /* Tabellen mit Glassmorphismus */
      .table {
        background: transparent;
      }

      .table thead th {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .table tbody tr {
        background: rgba(255, 255, 255, 0.01);
        transition: all 0.3s ease;
      }

      .table tbody tr:hover {
        background: rgba(255, 255, 255, 0.03);
      }

      /* Admin Grid - Gleiche H√∂he f√ºr alle Cards */
      .admin-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: var(--spacing-lg);
        align-items: stretch;
      }

      @media (max-width: 1200px) {
        .admin-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .admin-grid {
          grid-template-columns: 1fr;
        }
      }

      .admin-grid > div {
        display: flex;
      }

      /* Animationen */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stat-card,
      .card,
      .compact-card {
        animation: fadeInUp 0.6s ease-out;
      }

      @keyframes subtle-pulse {
        0% {
          box-shadow:
            0 8px 32px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        50% {
          box-shadow:
            0 8px 32px rgba(0, 142, 255, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        100% {
          box-shadow:
            0 8px 32px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
      }

      .stat-card:hover {
        animation: subtle-pulse 2s infinite;
      }
      
      /* Action buttons in tables - equal width */
      .table td:last-child .btn {
        min-width: 110px;
        margin: 2px;
      }
      
      /* Status buttons - Outline style like Secondary buttons */
      .btn-status-active {
        background: transparent;
        border: 1px solid #ff6b35;
        color: #ff6b35;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }
      
      .btn-status-active:hover {
        background: rgba(255, 107, 53, 0.1);
        border-color: #ff5722;
        color: #ff5722;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(255, 107, 53, 0.2);
      }
      
      .btn-status-inactive {
        background: transparent;
        border: 1px solid #28a745;
        color: #28a745;
        padding: 0.375rem 0.75rem;
        border-radius: var(--radius-sm);
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }
      
      .btn-status-inactive:hover {
        background: rgba(40, 167, 69, 0.1);
        border-color: #218838;
        color: #218838;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
      }
      
      /* Blackboard Preview Styles */
      .blackboard-preview {
        min-height: 200px;
      }
      
      .blackboard-preview .list-item {
        padding: 12px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.02);
        margin-bottom: 8px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .blackboard-preview .list-item:hover {
        background: rgba(255, 255, 255, 0.04);
        border-color: rgba(255, 255, 255, 0.1);
        transform: translateX(4px);
      }
      
      .blackboard-preview .list-item::before {
        content: 'üìå';
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 14px;
        opacity: 0.8;
      }
      
      .blackboard-preview .list-item-content {
        margin-left: 24px;
      }
      
      .blackboard-preview .list-item-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .blackboard-preview .list-item-meta {
        font-size: 0.85rem;
        color: var(--text-secondary);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .blackboard-preview .priority-badge {
        display: inline-flex;
        align-items: center;
        font-size: 0.75rem;
        padding: 2px 8px;
        border-radius: 12px;
        font-weight: 500;
      }
      
      .blackboard-preview .priority-urgent {
        background: rgba(244, 67, 54, 0.2);
        color: #f44336;
        border: 1px solid rgba(244, 67, 54, 0.3);
      }
      
      .blackboard-preview .priority-high {
        background: rgba(255, 152, 0, 0.2);
        color: #ff9800;
        border: 1px solid rgba(255, 152, 0, 0.3);
      }
      
      .blackboard-preview .priority-normal {
        background: rgba(33, 150, 243, 0.2);
        color: #2196f3;
        border: 1px solid rgba(33, 150, 243, 0.3);
      }
      
      .blackboard-preview .priority-low {
        background: rgba(76, 175, 80, 0.2);
        color: #4caf50;
        border: 1px solid rgba(76, 175, 80, 0.3);
      }
      
      /* Skeleton Loading */
      .loading-placeholder {
        padding: 8px 0;
      }
      
      .skeleton {
        background: linear-gradient(90deg, 
          rgba(255, 255, 255, 0.05) 25%, 
          rgba(255, 255, 255, 0.1) 50%, 
          rgba(255, 255, 255, 0.05) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: 4px;
        margin-bottom: 8px;
      }
      
      .skeleton-text {
        height: 48px;
        width: 100%;
      }
      
      @keyframes skeleton-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
      
      /* Empty State */
      .blackboard-empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-secondary);
      }
      
      .blackboard-empty-state i {
        font-size: 48px;
        opacity: 0.3;
        margin-bottom: 16px;
      }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />
    <link rel="stylesheet" href="/styles/blackboard-widget.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <a href="/pages/admin-dashboard.html" class="logo-container">
        <img src="/assets/images/logo.png" alt="Assixx Logo" class="logo" style="height: 40px; width: auto; filter: none" />
      </a>
      <div class="header-actions">
        <div id="user-info">
          <img id="user-avatar" src="/assets/images/default-avatar.svg" alt="Avatar" />
          <span id="user-name">Lade...</span>
        </div>
        <button id="logout-btn" class="btn-logout" class="btn btn-secondary">
          <i class="fas fa-sign-out-alt"></i>
          Abmelden
        </button>
      </div>
    </header>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Unified Sidebar Navigation -->
      <aside class="sidebar">
        <!-- Navigation wird durch unified-navigation.js injiziert -->
      </aside>

      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="content-section">
          <h1 class="text-center mb-4">Admin Dashboard</h1>

          <!-- Dashboard Stats Grid -->
          <div class="dashboard-grid">
            <div class="stat-card">
              <div class="stat-value" id="employee-count">0</div>
              <div class="stat-label">Mitarbeiter</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="document-count">0</div>
              <div class="stat-label">Dokumente</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="department-count">0</div>
              <div class="stat-label">Abteilungen</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="team-count">0</div>
              <div class="stat-label">Teams</div>
            </div>
          </div>

          <!-- Blackboard Widget -->
          <div id="blackboard-widget-container" style="margin-top: 2rem;"></div>

          <!-- Main Grid Container -->
          <div class="admin-grid">
            <!-- Employee Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Mitarbeiter</h2>
              </div>
              <div class="compact-content">
                <button class="btn btn-primary btn-block mb-3" id="new-employee-button" onclick="showEmployeeModal()">
                  Neuer Mitarbeiter
                </button>
                <div class="compact-list" id="recent-employees">
                  <!-- Wird dynamisch gef√ºllt: Letzte 5 Mitarbeiter -->
                </div>
                <a href="#" class="view-all-link" id="manage-employees-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Document Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Dokumente</h2>
              </div>
              <div class="compact-content">
                <a href="/document-upload" class="btn btn-primary btn-block mb-3">Dokument hochladen</a>
                <div class="compact-list" id="recent-documents">
                  <!-- Wird dynamisch gef√ºllt: Letzte 5 Dokumente -->
                </div>
                <a href="#" class="view-all-link" id="manage-documents-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Department Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Abteilungen</h2>
              </div>
              <div class="compact-content">
                <button class="btn btn-primary btn-block mb-3" onclick="showDepartmentModal()">Neue Abteilung</button>
                <div class="compact-list" id="department-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </div>
                <a href="#" class="view-all-link" id="manage-departments-link">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Team Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Teams</h2>
              </div>
              <div class="compact-content">
                <button class="btn btn-primary btn-block mb-3" onclick="showTeamModal()">Neues Team</button>
                <div class="compact-list" id="team-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </div>
                <a href="#" class="view-all-link" onclick="showAllTeams()">
                  Verwalten
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Kalender Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Kalender</h2>
              </div>
              <div class="compact-content">
                <a href="/calendar" class="btn btn-primary btn-block mb-3">Kalender √∂ffnen</a>
                <div class="compact-list" id="calendar-events-list">
                  <!-- Wird dynamisch gef√ºllt -->
                  <div class="list-item">
                    <div class="list-item-content">
                      <strong>N√§chste Termine</strong>
                      <p class="text-secondary">Keine anstehenden Termine</p>
                    </div>
                  </div>
                </div>
                <a href="/calendar" class="view-all-link">
                  Alle anzeigen
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>

            <!-- Blackboard Card -->
            <div class="card compact-card">
              <div class="card-header">
                <h2 class="card-title">Schwarzes Brett</h2>
              </div>
              <div class="compact-content">
                <div class="blackboard-preview" id="blackboard-preview">
                  <div class="loading-placeholder">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-text"></div>
                  </div>
                </div>
                <a href="/pages/blackboard.html" class="view-all-link">
                  Alle anzeigen
                  <span class="arrow">‚Üí</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Recently Added Section -->
          <div class="card mt-4">
            <div class="card-header">
              <h2 class="card-title">K√ºrzlich hinzugef√ºgt</h2>
            </div>
            <div class="recent-activity-grid">
              <div class="recent-section">
                <h3>Neue Mitarbeiter</h3>
                <ul id="recent-employees-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
              <div class="recent-section">
                <h3>Neue Dokumente</h3>
                <ul id="recent-documents-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
              <div class="recent-section">
                <h3>Aktivit√§ten</h3>
                <ul id="recent-activities-list" class="recent-list">
                  <!-- Wird dynamisch gef√ºllt -->
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- Payslips Section -->
        <section id="payslips-section" class="content-section" style="display: none">
          <h1>Gehaltsabrechnungen</h1>
          <div class="card mb-4">
            <div class="card-header">
              <h2 class="card-title">Gehaltsabrechnung hochladen</h2>
            </div>
            <form id="payslip-upload-form" enctype="multipart/form-data">
              <div class="form-group">
                <label class="form-label">Mitarbeiter ausw√§hlen</label>
                <select name="employeeId" id="payslip-employee-select" class="form-control" required>
                  <option value="">Bitte w√§hlen...</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Monat</label>
                <input type="month" name="month" class="form-control" required />
              </div>
              <div class="form-group">
                <label class="form-label">Datei ausw√§hlen (PDF)</label>
                <input type="file" name="file" class="form-control" accept="application/pdf" required />
              </div>
              <div class="form-group">
                <label class="form-label">Beschreibung</label>
                <textarea name="description" class="form-control" rows="2"></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Gehaltsabrechnung hochladen</button>
            </form>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Aktuelle Gehaltsabrechnungen</h2>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Mitarbeiter</th>
                    <th>Monat</th>
                    <th>Hochgeladen am</th>
                    <th>Datei</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="payslips-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Employees Section -->
        <section id="employees-section" class="content-section" style="display: none">
          <h1>Mitarbeiterverwaltung</h1>
          <button class="btn btn-primary mb-3" id="employees-section-new-button" onclick="showNewEmployeeModal()">Neuer Mitarbeiter</button>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Mitarbeiter√ºbersicht</h2>
            </div>
            <div class="flex-between mb-3">
              <div class="filter-buttons">
                <button id="show-all-employees" class="btn btn-sm btn-primary">Alle anzeigen</button>
                <button id="filter-employees-active" class="btn btn-sm btn-secondary">Aktive anzeigen</button>
                <button id="filter-employees-inactive" class="btn btn-sm btn-secondary">Inaktive anzeigen</button>
              </div>
              <div class="search-container">
                <input type="text" id="employee-search" class="search-input" placeholder="Name, E-Mail oder Position..." />
                <button id="employee-search-btn" class="btn btn-secondary">Suchen</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>E-Mail</th>
                    <th>Mitarbeiter-ID</th>
                    <th>Position</th>
                    <th>Abteilung</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="employees-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Documents Section -->
        <section id="documents-section" class="content-section" style="display: none">
          <h1>Dokumentenverwaltung</h1>
          <div class="flex-between mb-3">
            <a href="/document-upload" class="btn btn-primary">Dokument hochladen</a>
            <div class="search-container">
              <input type="text" id="document-search" class="search-input" placeholder="Dokumentname, Mitarbeiter oder Kategorie..." />
              <button id="document-search-btn" class="btn btn-secondary">Suchen</button>
            </div>
          </div>

          <div class="mb-3">
            <button id="show-all-documents" class="btn btn-sm btn-secondary">Alle anzeigen</button>
            <button id="filter-documents-archived" class="btn btn-sm btn-secondary">Archivierte anzeigen</button>
            <button id="filter-documents-active" class="btn btn-sm btn-secondary">Aktive anzeigen</button>
          </div>

          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Dokumenten√ºbersicht</h2>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Dateiname</th>
                    <th>Mitarbeiter</th>
                    <th>Kategorie</th>
                    <th>Hochgeladen am</th>
                    <th>Status</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="documents-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Departments Section -->
        <section id="departments-section" class="content-section" style="display: none">
          <h1>Abteilungsverwaltung</h1>
          <button class="btn btn-primary mb-3" id="direct-department-button">Neue Abteilung</button>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Abteilungs√ºbersicht</h2>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Beschreibung</th>
                    <th>Status</th>
                    <th>Sichtbarkeit</th>
                    <th>Manager</th>
                    <th>Mitarbeiter</th>
                    <th>Teams</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="departments-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Teams Section -->
        <section id="teams-section" class="content-section" style="display: none">
          <h1>Teamverwaltung</h1>
          <button class="btn btn-primary mb-3" onclick="showTeamModal()">Neues Team</button>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">Team√ºbersicht</h2>
            </div>
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Abteilung</th>
                    <th>Beschreibung</th>
                    <th>Mitglieder</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="teams-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>
            </div>
          </div>
        </section>


        <!-- Settings Section -->
        <section id="settings-section" class="content-section" style="display: none">
          <h1>Einstellungen</h1>
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">System-Einstellungen</h2>
            </div>
            <p>Einstellungen werden hier implementiert...</p>
          </div>
        </section>
      </main>
    </div>

    <!-- Modals -->
    <!-- Department Modal -->
    <div id="department-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Neue Abteilung</h3>
          <button class="modal-close" onclick="hideModal('department-modal')">&times;</button>
        </div>
        <form id="department-form">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Beschreibung</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Status</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="department-status-display" onclick="toggleDropdown('department-status')">
                <span>Aktiv</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="department-status-dropdown" style="display: none">
                <div class="dropdown-option" onclick="selectDropdownOption('department-status', 'active', 'Aktiv')">Aktiv</div>
                <div class="dropdown-option" onclick="selectDropdownOption('department-status', 'inactive', 'Inaktiv')">Inaktiv</div>
              </div>
              <input type="hidden" name="status" id="department-status-select" value="active" />
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Sichtbarkeit</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="department-visibility-display" onclick="toggleDropdown('department-visibility')">
                <span>√ñffentlich</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="department-visibility-dropdown" style="display: none">
                <div class="dropdown-option" onclick="selectDropdownOption('department-visibility', 'public', '√ñffentlich')">√ñffentlich</div>
                <div class="dropdown-option" onclick="selectDropdownOption('department-visibility', 'private', 'Privat')">Privat</div>
              </div>
              <input type="hidden" name="visibility" id="department-visibility-select" value="public" />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Abteilung erstellen</button>
        </form>
      </div>
    </div>

    <!-- Team Modal -->
    <div id="team-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Neues Team</h3>
          <button class="modal-close" onclick="hideTeamModal()">&times;</button>
        </div>
        <form id="team-form">
          <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Beschreibung</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Abteilung</label>
            <select name="department_id" class="form-control">
              <option value="">Keine Abteilung</option>
              <!-- Wird dynamisch gef√ºllt -->
            </select>
          </div>
          <button type="submit" class="btn btn-primary">Team erstellen</button>
        </form>
      </div>
    </div>

    <!-- Employee Modal -->
    <div id="employee-modal" class="modal" style="display: none" data-debug="employee-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Neuer Mitarbeiter</h3>
          <button class="modal-close" id="close-employee-modal">&times;</button>
        </div>
        <form id="create-employee-form">
          <div class="form-group">
            <label class="form-label">Benutzername</label>
            <input type="text" name="username" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">E-Mail</label>
            <input type="email" name="email" id="email" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">E-Mail best√§tigen</label>
            <input type="email" name="email_confirm" id="email_confirm" class="form-control" required />
            <small id="email-error" class="error-message" style="color: red; display: none">
              Die E-Mail-Adressen stimmen nicht √ºberein
            </small>
          </div>
          <div class="form-group">
            <label class="form-label">Passwort</label>
            <input type="password" name="password" id="password" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Passwort best√§tigen</label>
            <input type="password" name="password_confirm" id="password_confirm" class="form-control" required />
            <small id="password-error" class="error-message" style="color: red; display: none">Die Passw√∂rter stimmen nicht √ºberein</small>
          </div>
          <div class="form-group">
            <label class="form-label">Vorname</label>
            <input type="text" name="first_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Nachname</label>
            <input type="text" name="last_name" class="form-control" required />
          </div>
          <div class="form-group">
            <label class="form-label">Alter</label>
            <input type="number" name="age" class="form-control" min="18" max="100" required />
          </div>
          <!-- Mitarbeiter-ID wird automatisch generiert -->
          <!-- IBAN-Feld wurde entfernt -->
          <div class="form-group">
            <label class="form-label">Position</label>
            <input type="text" name="position" class="form-control" />
          </div>
          <div class="form-group">
            <label class="form-label">Abteilung</label>
            <div class="custom-dropdown">
              <div class="dropdown-display" id="employee-department-display" onclick="toggleDropdown('employee-department')">
                <span>Keine Abteilung</span>
                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </div>
              <div class="dropdown-options" id="employee-department-dropdown" style="display: none">
                <div class="dropdown-option" data-value="" onclick="selectDropdownOption('employee-department', '', 'Keine Abteilung')">
                  Keine Abteilung
                </div>
                <!-- Wird dynamisch gef√ºllt -->
              </div>
              <input type="hidden" name="department_id" id="employee-department-select" />
            </div>
          </div>
          <div class="button-group">
            <button type="submit" class="btn btn-primary">Mitarbeiter erstellen</button>
            <button type="button" class="btn btn-secondary" id="cancel-employee-button">Abbrechen</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Document Modal -->
    <div id="document-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Dokument hochladen</h3>
          <button class="modal-close" onclick="hideModal('document-modal')">&times;</button>
        </div>
        <form id="document-upload-form" enctype="multipart/form-data">
          <div class="form-group">
            <label class="form-label">Mitarbeiter ausw√§hlen</label>
            <select name="employeeId" id="upload-employee-select" class="form-control" required>
              <option value="">Bitte w√§hlen...</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Dokumenttyp</label>
            <select name="category" class="form-control">
              <option value="payslip">Lohnabrechnung</option>
              <option value="contract">Vertrag</option>
              <option value="certificate">Bescheinigung</option>
              <option value="other">Sonstiges</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Datei ausw√§hlen</label>
            <input type="file" name="document" class="form-control" accept="application/pdf" required />
          </div>
          <button type="submit" class="btn btn-primary">Dokument hochladen</button>
        </form>
      </div>
    </div>

    <!-- Department Modal ist bereits weiter oben definiert -->
    <!-- Team Modal ist bereits weiter oben definiert -->

    <!-- Modal Styles -->
    <style>
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(10px);
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        animation: fadeInUp 0.3s ease-out;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: var(--text-secondary);
        cursor: pointer;
      }

      .modal-close:hover {
        color: var(--text-primary);
      }

      .table-row-inactive {
        background-color: rgba(255, 165, 0, 0.1);
      }

      .table-row-archived {
        background-color: rgba(128, 128, 128, 0.1);
      }

      .modal form {
        padding: var(--spacing-lg);
      }
    </style>
    
    <!-- Custom Dropdown Styles -->
    <style>
      .custom-dropdown {
        position: relative;
        width: 100%;
      }

      .dropdown-display {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .dropdown-display:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.2);
      }

      .dropdown-display.active svg {
        transform: rotate(180deg);
      }

      .dropdown-display svg {
        transition: transform 0.3s ease;
      }

      .dropdown-options {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(18, 18, 18, 0.98);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        max-height: 200px;
        overflow-y: auto;
        z-index: 1001;
      }

      .dropdown-option {
        padding: 10px 12px;
        color: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: all 0.2s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .dropdown-option:last-child {
        border-bottom: none;
      }

      .dropdown-option:hover {
        background: rgba(33, 150, 243, 0.2);
        color: white;
        padding-left: 16px;
      }
    </style>

    <!-- JavaScript -->
    <!-- Verhindert mehrfache Best√§tigungsdialoge -->
    <script type="module" src="/scripts/confirm-once.ts"></script>

    <script>
      console.log('Admin dashboard HTML loaded');

      // Globale Modal-Funktionen direkt definieren
      window.showModal = function (modalId) {
        console.log('showModal called with:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found, showing it');
          modal.style.display = 'flex';
        } else {
          console.error('Modal element not found:', modalId);
        }
      };

      window.hideModal = function (modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.style.display = 'none';
        } else {
          console.error('Modal element not found:', modalId);
        }
      };
    </script>
    <!-- Unified Navigation -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
    <script type="module" src="/scripts/show-section.ts"></script>
    <script type="module" src="/scripts/admin-dashboard.ts"></script>
    <script type="module" src="/scripts/employee-deletion.ts"></script>
    <script src="/scripts/blackboard-widget.js" type="module"></script>
    <script>
      // Direkte Event-Listener hinzuf√ºgen
      console.log('Adding direct event listeners');
      document.addEventListener('DOMContentLoaded', () => {
        // Event-Listener f√ºr das Schlie√üen des Mitarbeiter-Modals
        const closeEmployeeModalBtn = document.getElementById('close-employee-modal');
        const cancelEmployeeBtn = document.getElementById('cancel-employee-button');
        const employeeModal = document.getElementById('employee-modal');

        if (closeEmployeeModalBtn && employeeModal) {
          console.log('Close employee modal button found, adding event listener');
          closeEmployeeModalBtn.addEventListener('click', function () {
            console.log('Close button clicked, hiding employee modal');
            employeeModal.style.display = 'none';
          });
        }

        if (cancelEmployeeBtn && employeeModal) {
          console.log('Cancel employee button found, adding event listener');
          cancelEmployeeBtn.addEventListener('click', function () {
            console.log('Cancel button clicked, hiding employee modal');
            employeeModal.style.display = 'none';
          });
        }

        // Schlie√üen des Modals beim Klick au√üerhalb
        employeeModal?.addEventListener('click', function (event) {
          if (event.target === employeeModal) {
            console.log('Clicked outside modal content, hiding employee modal');
            employeeModal.style.display = 'none';
          }
        });
        console.log('DOM loaded, setting up debugging handlers');

        // Debug-Funktionen f√ºr alle Buttons
        document.querySelectorAll('button').forEach((button) => {
          console.log('Found button:', button.textContent || button.innerHTML);
          button.addEventListener('click', function (e) {
            console.log('Button clicked:', this.textContent || this.innerHTML);
          });
        });

        // Spezieller Listener f√ºr den Dokument-Upload-Button
        const docUploadBtn = document.querySelector('button[type="submit"]');
        if (docUploadBtn && docUploadBtn.textContent.includes('Gehaltsabrechnung hochladen')) {
          console.log('Dokument Upload Button gefunden:', docUploadBtn.textContent);
          // Button ist bereits Teil eines Formulars, kein zus√§tzlicher Listener n√∂tig
        } else {
          console.log('Dokument Upload Button ist ein Submit-Button im Formular');
        }

        // Direkter Link f√ºr Sidebar-Links
        document.querySelectorAll('.sidebar-link').forEach((link) => {
          console.log('Found sidebar link:', link.textContent);
          link.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            console.log('Sidebar link clicked:', href);

            if (href === '#departments') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing departments section');
              document.querySelectorAll('.content-section').forEach((section) => {
                section.style.display = 'none';
              });
              document.getElementById('departments-section').style.display = 'block';

              // Update active state
              document.querySelectorAll('.sidebar-item').forEach((item) => {
                item.classList.remove('active');
              });
              this.parentElement.classList.add('active');
            } else if (href === '#employees') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing employees section');
              showSection('employees');
            } else if (href === '#documents') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing documents section');
              showSection('documents');
            } else if (href === '#teams') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing teams section');
              showSection('teams');
            } else if (href === '#payslips') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing payslips section');
              showSection('payslips');
            } else if (href === '#settings') {
              e.preventDefault();
              e.stopPropagation();
              console.log('Showing settings section');
              showSection('settings');
            }
          });
        });

        // Direkter Listener f√ºr den Abteilungs-Button
        const departmentBtn = document.getElementById('direct-department-button');
        if (departmentBtn) {
          console.log('Department button found');
          departmentBtn.addEventListener('click', function () {
            console.log('Department button clicked');
            const deptModal = document.getElementById('department-modal');
            if (deptModal) {
              console.log('Department modal found, displaying it');
              deptModal.style.display = 'flex';
            } else {
              console.error('Department modal NOT found');
              alert('Das Abteilungs-Modal konnte nicht gefunden werden.');
            }
          });
        } else {
          console.error('Department button NOT found');
        }

        // Listener f√ºr "Abteilungen verwalten" Link
        const manageDepartmentsLink = document.getElementById('manage-departments-link');
        if (manageDepartmentsLink) {
          console.log('Manage departments link found');
          manageDepartmentsLink.addEventListener('click', function (e) {
            e.preventDefault();
            console.log('Manage departments link clicked');
            // Zeige die Abteilungs-Sektion an
            document.querySelectorAll('.content-section').forEach((section) => {
              section.style.display = 'none';
            });
            document.getElementById('departments-section').style.display = 'block';

            // Update active state in sidebar
            document.querySelectorAll('.sidebar-item').forEach((item) => {
              item.classList.remove('active');
            });

            // Finde und aktiviere die Abteilungen-Sidebar
            document.querySelectorAll('.sidebar-link').forEach((link) => {
              if (link.getAttribute('href') === '#departments') {
                link.parentElement.classList.add('active');
              }
            });

            // Lade Abteilungstabelle
            loadDepartmentsTable();
          });
        } else {
          console.error('Manage departments link NOT found');
        }
      });
    </script>
    <script>
      // Custom Dropdown Funktionen
      function toggleDropdown(dropdownId) {
        const dropdown = document.getElementById(dropdownId + '-dropdown');
        const display = document.getElementById(dropdownId + '-display');
        
        if (dropdown && display) {
          dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
          display.classList.toggle('active');
          
          // Optional: Close when clicking outside
          if (dropdown.style.display === 'block') {
            setTimeout(() => {
              document.addEventListener('click', function closeDropdown(e) {
                if (!e.target.closest('.custom-dropdown')) {
                  dropdown.style.display = 'none';
                  display.classList.remove('active');
                  document.removeEventListener('click', closeDropdown);
                }
              });
            }, 100);
          }
        }
      }
      
      function selectDropdownOption(dropdownId, value, text) {
        const hiddenInput = document.getElementById(dropdownId + '-select');
        const display = document.getElementById(dropdownId + '-display');
        const dropdown = document.getElementById(dropdownId + '-dropdown');
        
        if (hiddenInput && display && dropdown) {
          hiddenInput.value = value;
          display.querySelector('span').textContent = text;
          dropdown.style.display = 'none';
          display.classList.remove('active');
        }
      }
    </script>
    <script>
      // Funktionstabelle direkt definieren

      // Departments-Tabelle laden
      async function loadDepartmentsTable() {
        console.log('Loading departments table');
        const token = localStorage.getItem('token');

        try {
          const response = await fetch('/api/departments', {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const departments = await response.json();
            console.log(`Loaded ${departments.length} departments`);
            // Debug: Show first department data
            if (departments.length > 0) {
              console.log('Department data:', departments[0]);
            }

            const tbody = document.getElementById('departments-table-body');
            if (tbody) {
              tbody.innerHTML = departments
                .map(
                  (dept) => {
                    // Convert Buffer to String if needed
                    let description = '-';
                    if (dept.description) {
                      if (dept.description.type === 'Buffer' && dept.description.data) {
                        description = String.fromCharCode(...dept.description.data);
                      } else if (typeof dept.description === 'string') {
                        description = dept.description;
                      }
                    }
                    
                    return `
                            <tr>
                                <td>${dept.name}</td>
                                <td>${description}</td>
                                <td>
                                    <span class="badge ${dept.status === 'active' ? 'badge-success' : 'badge-warning'}">
                                        ${dept.status === 'active' ? 'Aktiv' : 'Inaktiv'}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge ${dept.visibility === 'public' ? 'badge-primary' : 'badge-secondary'}">
                                        ${dept.visibility === 'public' ? '√ñffentlich' : 'Privat'}
                                    </span>
                                </td>
                                <td>${dept.manager_name || '-'}</td>
                                <td>${dept.employee_count || 0}</td>
                                <td>${dept.team_count || 0}</td>
                                <td>
                                    <button class="btn btn-sm ${dept.status === 'active' ? 'btn-status-active' : 'btn-status-inactive'}" onclick="toggleDepartmentStatus(${dept.id}, '${dept.status}')">
                                        ${dept.status === 'active' ? 'Deaktivieren' : 'Aktivieren'}
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="editDepartment(${dept.id})">Bearbeiten</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteDepartment(${dept.id})">L√∂schen</button>
                                </td>
                            </tr>
                        `;
                  })
                .join('');
            } else {
              console.error('Departments table body not found');
            }
          } else {
            console.error('Failed to load departments');
          }
        } catch (error) {
          console.error('Error loading departments table:', error);
        }
      }

      // Abteilung-Status wechseln
      async function toggleDepartmentStatus(departmentId, currentStatus) {
        console.log(`Toggling department ${departmentId} status from ${currentStatus}`);
        const token = localStorage.getItem('token');
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';

        try {
          const response = await fetch(`/api/departments/${departmentId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ status: newStatus }),
          });

          if (response.ok) {
            alert(`Abteilung wurde ${newStatus === 'active' ? 'aktiviert' : 'deaktiviert'}`);
            loadDepartmentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error toggling department status:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Abteilung bearbeiten
      async function editDepartment(departmentId) {
        console.log(`Editing department ${departmentId}`);
        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/departments/${departmentId}`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const department = await response.json();
            console.log('Department data:', department);
            
            // Convert Buffer to String if needed
            let description = '';
            if (department.description) {
              if (department.description.type === 'Buffer' && department.description.data) {
                // Convert Buffer array to string
                description = String.fromCharCode(...department.description.data);
              } else if (typeof department.description === 'string') {
                description = department.description;
              }
            }

            // Erstelle ein Modal f√ºr die Bearbeitung
            const modalHTML = `
                        <div class="modal" id="edit-department-modal" style="display: flex;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h3 class="modal-title">Abteilung bearbeiten</h3>
                                    <button class="modal-close" onclick="document.getElementById('edit-department-modal').remove()">&times;</button>
                                </div>
                                <form id="edit-department-form">
                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" name="name" class="form-control" value="${department.name}" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Beschreibung</label>
                                        <textarea name="description" class="form-control" rows="3">${description}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Status</label>
                                        <div class="custom-dropdown">
                                            <div class="dropdown-display" id="edit-department-status-display" onclick="toggleDropdown('edit-department-status')">
                                                <span>${department.status === 'active' ? 'Aktiv' : 'Inaktiv'}</span>
                                                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                                    <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                                </svg>
                                            </div>
                                            <div class="dropdown-options" id="edit-department-status-dropdown" style="display: none">
                                                <div class="dropdown-option" onclick="selectDropdownOption('edit-department-status', 'active', 'Aktiv')">Aktiv</div>
                                                <div class="dropdown-option" onclick="selectDropdownOption('edit-department-status', 'inactive', 'Inaktiv')">Inaktiv</div>
                                            </div>
                                            <input type="hidden" name="status" id="edit-department-status-select" value="${department.status}" />
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Sichtbarkeit</label>
                                        <div class="custom-dropdown">
                                            <div class="dropdown-display" id="edit-department-visibility-display" onclick="toggleDropdown('edit-department-visibility')">
                                                <span>${department.visibility === 'public' ? '√ñffentlich' : 'Privat'}</span>
                                                <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                                    <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                                </svg>
                                            </div>
                                            <div class="dropdown-options" id="edit-department-visibility-dropdown" style="display: none">
                                                <div class="dropdown-option" onclick="selectDropdownOption('edit-department-visibility', 'public', '√ñffentlich')">√ñffentlich</div>
                                                <div class="dropdown-option" onclick="selectDropdownOption('edit-department-visibility', 'private', 'Privat')">Privat</div>
                                            </div>
                                            <input type="hidden" name="visibility" id="edit-department-visibility-select" value="${department.visibility}" />
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="updateDepartment(${departmentId})">√Ñnderungen speichern</button>
                                </form>
                            </div>
                        </div>
                    `;

            // Modal zum Body hinzuf√ºgen
            document.body.insertAdjacentHTML('beforeend', modalHTML);
          } else {
            console.error('Failed to load department data');
            alert('Fehler beim Laden der Abteilungsdaten.');
          }
        } catch (error) {
          console.error('Error loading department:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Abteilung aktualisieren
      async function updateDepartment(departmentId) {
        console.log(`Updating department ${departmentId}`);
        const token = localStorage.getItem('token');
        const form = document.getElementById('edit-department-form');

        if (!form) {
          console.error('Edit department form not found');
          return;
        }

        const formData = new FormData(form);
        const data = {
          name: formData.get('name'),
          description: formData.get('description'),
          status: formData.get('status'),
          visibility: formData.get('visibility'),
        };

        try {
          const response = await fetch(`/api/departments/${departmentId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            alert('Abteilung erfolgreich aktualisiert');
            // Modal schlie√üen
            const modal = document.getElementById('edit-department-modal');
            if (modal) modal.remove();
            // Tabelle neu laden
            loadDepartmentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error updating department:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Load documents table
      async function loadDocumentsTable() {
        console.log('Loading documents table');
        const token = localStorage.getItem('token');
        
        try {
          const response = await fetch('/api/documents', {
            headers: { Authorization: `Bearer ${token}` },
          });
          
          if (response.ok) {
            const documents = await response.json();
            console.log(`Loaded ${documents.length} documents`);
            
            const tbody = document.getElementById('documents-table-body');
            if (tbody) {
              tbody.innerHTML = documents
                .map(
                  (doc) => `
                    <tr>
                      <td>${doc.filename}</td>
                      <td>${doc.category || '-'}</td>
                      <td>${doc.uploaded_by_name || 'Unbekannt'}</td>
                      <td>${new Date(doc.upload_date).toLocaleDateString('de-DE')}</td>
                      <td>
                        <button class="btn btn-sm btn-primary" onclick="downloadDocument(${doc.id})">
                          Download
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteDocument(${doc.id})">
                          L√∂schen
                        </button>
                      </td>
                    </tr>
                  `,
                )
                .join('');
            }
          }
        } catch (error) {
          console.error('Error loading documents:', error);
        }
      }

      // Abteilung l√∂schen
      async function deleteDepartment(departmentId) {
        console.log(`Deleting department ${departmentId}`);
        if (!confirm('Sind Sie sicher, dass Sie diese Abteilung l√∂schen m√∂chten?')) {
          return;
        }

        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/departments/${departmentId}`, {
            method: 'DELETE',
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            alert('Abteilung erfolgreich gel√∂scht');
            loadDepartmentsTable();
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error deleting department:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Mitarbeiter bearbeiten
      async function editEmployeeAsync(employeeId) {
        console.log(`Editing employee ${employeeId}`);
        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (response.ok) {
            const employee = await response.json();
            console.log('Employee data:', employee);

            // Erstelle ein Modal f√ºr die Bearbeitung
            const modalHTML = `
                        <div class="modal" id="edit-employee-modal" style="display: flex;">
                            <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
                                <div class="modal-header">
                                    <h3 class="modal-title">Mitarbeiter bearbeiten</h3>
                                    <button type="button" class="modal-close" onclick="document.getElementById('edit-employee-modal').remove()">&times;</button>
                                </div>
                                <form id="edit-employee-form">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                        <div class="form-group">
                                            <label class="form-label">Benutzername</label>
                                            <input type="text" name="username" class="form-control" value="${employee.username || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">E-Mail</label>
                                            <input type="email" name="email" class="form-control" value="${employee.email || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Vorname</label>
                                            <input type="text" name="first_name" class="form-control" value="${employee.first_name || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Nachname</label>
                                            <input type="text" name="last_name" class="form-control" value="${employee.last_name || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Telefon</label>
                                            <input type="tel" name="phone" class="form-control" value="${employee.phone || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Mitarbeiter-ID</label>
                                            <input type="text" name="employee_id" class="form-control" value="${employee.employee_id || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Position</label>
                                            <input type="text" name="position" class="form-control" value="${employee.position || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Abteilung</label>
                                            <select name="department_id" class="form-control" id="edit-employee-department-select">
                                                <option value="">Keine Abteilung</option>
                                                <!-- Wird dynamisch gef√ºllt -->
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">IBAN</label>
                                            <input type="text" name="iban" class="form-control" value="${employee.iban || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Geburtsdatum</label>
                                            <input type="date" name="birthday" class="form-control" value="${employee.birthday ? employee.birthday.split('T')[0] : ''}">
                                        </div>
                                        <div class="form-group" style="grid-column: span 2;">
                                            <label class="form-label">Adresse</label>
                                            <textarea name="address" class="form-control" rows="2">${employee.address || ''}</textarea>
                                        </div>
                                        <div class="form-group" style="grid-column: span 2;">
                                            <label class="form-label">Notizen</label>
                                            <textarea name="notes" class="form-control" rows="3">${employee.notes || ''}</textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Status</label>
                                            <div class="custom-dropdown">
                                                <div class="dropdown-display" id="edit-employee-status-display" onclick="toggleDropdown('edit-employee-status')">
                                                    <span>${employee.is_active ? 'Aktiv' : 'Inaktiv'}</span>
                                                    <svg width="12" height="8" viewBox="0 0 12 8" fill="none">
                                                        <path d="M1 1L6 6L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                                                    </svg>
                                                </div>
                                                <div class="dropdown-options" id="edit-employee-status-dropdown" style="display: none">
                                                    <div class="dropdown-option" data-value="1" onclick="selectDropdownOption('edit-employee-status', '1', 'Aktiv')">
                                                        Aktiv
                                                    </div>
                                                    <div class="dropdown-option" data-value="0" onclick="selectDropdownOption('edit-employee-status', '0', 'Inaktiv')">
                                                        Inaktiv
                                                    </div>
                                                </div>
                                                <input type="hidden" name="is_active" id="edit-employee-status-select" value="${employee.is_active ? '1' : '0'}" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Neues Passwort (optional)</label>
                                            <input type="password" name="password" class="form-control" placeholder="Leer lassen f√ºr keine √Ñnderung">
                                        </div>
                                    </div>
                                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('edit-employee-modal').remove()">
                                            Abbrechen
                                        </button>
                                        <button type="button" class="btn btn-primary" onclick="updateEmployee(${employeeId})">
                                            <i class="fas fa-save"></i> √Ñnderungen speichern
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    `;

            // Modal zum Body hinzuf√ºgen
            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Lade Abteilungen f√ºr das Select-Feld
            const departmentSelect = document.getElementById('edit-employee-department-select');
            if (departmentSelect) {
              // Hilfsfunktion zum Laden der Abteilungen
              const loadDepts = async () => {
                try {
                  const deptResponse = await fetch('/api/departments', {
                    headers: { Authorization: `Bearer ${token}` },
                  });

                  if (deptResponse.ok) {
                    const departments = await deptResponse.json();
                    departmentSelect.innerHTML =
                      '<option value="">Keine Abteilung</option>' +
                      departments
                        .map(
                          (dept) => `
                                            <option value="${dept.id}" ${dept.id == employee.department_id ? 'selected' : ''}>
                                                ${dept.name}
                                            </option>
                                        `,
                        )
                        .join('');
                  }
                } catch (err) {
                  console.error('Error loading departments:', err);
                }
              };

              loadDepts();
            }
          } else {
            console.error('Failed to load employee data');
            alert('Fehler beim Laden der Mitarbeiterdaten.');
          }
        } catch (error) {
          console.error('Error loading employee:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Mitarbeiter aktualisieren
      async function updateEmployee(employeeId) {
        console.log(`Updating employee ${employeeId}`);
        const token = localStorage.getItem('token');
        const form = document.getElementById('edit-employee-form');

        if (!form) {
          console.error('Edit employee form not found');
          return;
        }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        // Convert string values to proper types
        if (data.department_id === '') {
          data.department_id = null;
        } else if (data.department_id) {
          data.department_id = parseInt(data.department_id);
        }

        // Convert is_active to boolean and add status field
        data.is_active = data.is_active === '1';
        // Also set the status field based on is_active
        data.status = data.is_active ? 'active' : 'inactive';

        // Remove password if empty
        if (!data.password || data.password.trim() === '') {
          delete data.password;
        }

        // Clean up empty values but keep is_active and status even if false
        Object.keys(data).forEach(key => {
          if (key !== 'is_active' && key !== 'status' && (data[key] === '' || data[key] === null)) {
            delete data[key];
          }
        });

        // Debug log to check what we're sending
        console.log('Sending update data:', data);

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            alert('Mitarbeiter erfolgreich aktualisiert');
            // Modal schlie√üen
            const modal = document.getElementById('edit-employee-modal');
            if (modal) modal.remove();
            // Tabelle neu laden
            if (typeof loadEmployeesTable === 'function') {
              loadEmployeesTable();
            }
            // Diese Funktionen sind m√∂glicherweise nicht global verf√ºgbar
            if (typeof window.loadRecentEmployees === 'function') {
              window.loadRecentEmployees();
            }
            if (typeof window.loadDashboardStats === 'function') {
              window.loadDashboardStats();
            }
            // Als Fallback die Seite neu laden um alle Daten zu aktualisieren
            if (typeof loadEmployeesTable !== 'function') {
              window.location.reload();
            }
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message || 'Unbekannter Fehler'}`);
          }
        } catch (error) {
          console.error('Error updating employee:', error);
          alert('Ein Fehler ist aufgetreten beim Aktualisieren des Mitarbeiters.');
        }
      }

      // Mitarbeiter l√∂schen
      async function deleteEmployee(employeeId) {
        // This function is now handled by employee-deletion.ts
        // Call the enhanced delete dialog from employee-deletion.ts
        if (window.deleteEmployee) {
          window.deleteEmployee(employeeId);
        } else {
          console.error('Delete employee function not loaded from employee-deletion.ts');
          alert('L√∂schfunktion nicht verf√ºgbar. Bitte laden Sie die Seite neu.');
        }
      }

      // Mitarbeiterstatus √§ndern
      async function toggleEmployeeStatus(employeeId, currentStatus) {
        console.log(`Toggling employee ${employeeId} status from ${currentStatus}`);
        const token = localStorage.getItem('token');
        const newStatus = currentStatus === 'inactive' ? 'active' : 'inactive';

        try {
          const response = await fetch(`/admin/toggle-employee-status/${employeeId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ status: newStatus }),
          });

          if (response.ok) {
            alert(`Mitarbeiterstatus wurde zu "${newStatus}" ge√§ndert`);
            loadEmployeesTable('reload');
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error toggling employee status:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }

      // Add event listener for payslip upload form
      document.addEventListener('DOMContentLoaded', () => {
        const payslipForm = document.getElementById('payslip-upload-form');
        if (payslipForm) {
          payslipForm.addEventListener('submit', uploadPayslip);
        }
      });

      // Upload payslip function
      async function uploadPayslip(e) {
        e.preventDefault();
        const token = localStorage.getItem('token');
        const formData = new FormData(e.target);

        // Set category to payslip
        formData.append('category', 'payslip');

        try {
          const response = await fetch('/documents/upload', {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${token}`,
            },
            body: formData,
          });

          if (response.ok) {
            alert('Gehaltsabrechnung erfolgreich hochgeladen');
            e.target.reset();
            // TODO: Implement loadPayslipsTable() when payslips table is added
            if (typeof loadPayslipsTable === 'function') {
              loadPayslipsTable();
            }
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Fehler beim Hochladen der Gehaltsabrechnung:', error);
          alert('Ein Fehler ist aufgetreten.');
        }
      }
      // Logo und √úbersicht verarbeiten
      document.addEventListener('DOMContentLoaded', () => {
        // Logo-Klick behandeln
        document.querySelector('.logo-container').addEventListener('click', (e) => {
          e.preventDefault();
          window.location.reload();
        });

        // √úbersicht-Link in der Seitennavigation
        const dashboardLink = document.querySelector('.sidebar-link[href="#dashboard"]');
        if (dashboardLink) {
          dashboardLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.reload();
          });
        }

        // Logout-Button behandeln
        const logoutBtn = document.getElementById('logout-btn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', () => {
            if (confirm('M√∂chten Sie sich wirklich abmelden?')) {
              localStorage.removeItem('token');
              localStorage.removeItem('role');
              localStorage.removeItem('username');
              window.location.href = '/';
            }
          });
        }
      });

      // Modal functions redefined for redundancy
      function showModal(modalId) {
        console.log('Inline showModal called with:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found in inline function, showing it');
          modal.style.display = 'flex';
        } else {
          console.error('Modal element not found in inline function:', modalId);
        }
      }

      function hideModal(modalId) {
        console.log('hideModal called for:', modalId);
        const modal = document.getElementById(modalId);
        if (modal) {
          console.log('Modal element found in hideModal, hiding it');
          modal.style.display = 'none';
        } else {
          console.error('Modal element not found in hideModal:', modalId);
        }
      }

      function showEmployeeModal() {
        console.log('showEmployeeModal function called');
        const modal = document.getElementById('employee-modal');
        if (modal) {
          console.log('employee-modal found, showing directly');
          modal.style.display = 'flex';
          // Abteilungen f√ºr das Formular laden
          if (typeof loadDepartmentsForEmployeeSelect === 'function') {
            loadDepartmentsForEmployeeSelect();
          } else {
            console.error('loadDepartmentsForEmployeeSelect is not a function');
          }
        } else {
          console.error('employee-modal not found');
          alert('Das Mitarbeiterformular konnte nicht ge√∂ffnet werden.');
        }
      }

      function showDocumentModal() {
        console.log('Document upload modal requested');
        const modal = document.getElementById('document-modal');
        if (modal) {
          console.log('Modal found, showing it');
          modal.style.display = 'flex';
          // Mitarbeiter-Select f√ºllen
          loadEmployeesForSelect();
        } else {
          console.error('Modal element not found!');
          alert('Dokument-Upload-Formular konnte nicht geladen werden.');
        }
      }

      function showDepartmentModal() {
        showModal('department-modal');
      }

      function showTeamModal() {
        showModal('team-modal');
        // Abteilungen f√ºr Select laden
        loadDepartmentsForSelect();
      }

      function hideTeamModal() {
        hideModal('team-modal');
      }

      // Modal schlie√üen bei Klick au√üerhalb
      window.addEventListener('click', function (event) {
        const modals = ['employee-modal', 'document-modal', 'department-modal', 'team-modal'];
        modals.forEach((modalId) => {
          const modal = document.getElementById(modalId);
          if (event.target == modal) {
            console.log(`Clicked outside of ${modalId}, closing it`);
            modal.style.display = 'none';
          }
        });
      });

      // Placeholder functions for "view all" links
      function showAllEmployees() {
        console.log('Show all employees');
      }

      // Load employees table
      async function loadEmployeesTable() {
        console.log('Loading employees table...');
        const token = localStorage.getItem('token');
        
        try {
          const response = await fetch('/api/users?role=employee', {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            throw new Error('Failed to load employees');
          }

          const employees = await response.json();
          const tableBody = document.getElementById('employees-table-body');
          
          if (!tableBody) {
            console.error('employees-table-body not found');
            return;
          }

          tableBody.innerHTML = '';

          if (employees.length === 0) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" class="text-center text-muted">Keine Mitarbeiter gefunden</td>
              </tr>
            `;
            return;
          }

          employees.forEach((employee) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${employee.first_name || ''} ${employee.last_name || ''}</td>
              <td>${employee.email || ''}</td>
              <td>${employee.id || ''}</td>
              <td>${employee.position || 'Mitarbeiter'}</td>
              <td>${employee.department || 'Keine Abteilung'}</td>
              <td>
                <span class="badge ${employee.is_active ? 'badge-success' : 'badge-danger'}">
                  ${employee.is_active ? 'Aktiv' : 'Inaktiv'}
                </span>
              </td>
              <td>
                <button class="btn btn-sm btn-secondary" onclick="editEmployee(${employee.id})">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        } catch (error) {
          console.error('Error loading employees:', error);
          const tableBody = document.getElementById('employees-table-body');
          if (tableBody) {
            tableBody.innerHTML = `
              <tr>
                <td colspan="7" class="text-center text-danger">Fehler beim Laden der Mitarbeiter</td>
              </tr>
            `;
          }
        }
      }

      // Make functions globally available (delay to ensure they're defined)
      document.addEventListener('DOMContentLoaded', () => {
        window.loadEmployeesTable = loadEmployeesTable;
        window.editEmployee = editEmployee;
        window.editEmployeeAsync = editEmployeeAsync;
        window.updateEmployee = updateEmployee;
        window.deleteEmployee = deleteEmployee;
        window.loadDocumentsTable = loadDocumentsTable || (() => console.log('loadDocumentsTable not implemented'));
        window.loadPayslipsTable = loadPayslipsTable || (() => console.log('loadPayslipsTable not implemented'));
        window.loadEmployeesForPayslipSelect = loadEmployeesForPayslipSelect || (() => console.log('loadEmployeesForPayslipSelect not implemented'));
        window.loadDepartmentsTable = loadDepartmentsTable;
        window.loadTeamsTable = loadTeamsTable || (() => console.log('loadTeamsTable not implemented'));
        window.loadRecentEmployees = window.loadRecentEmployees || (() => console.log('loadRecentEmployees not implemented'));
        window.loadDashboardStats = window.loadDashboardStats || (() => console.log('loadDashboardStats not implemented'));
      });

      // Edit employee - Placeholder function, actual implementation below
      function editEmployee(employeeId) {
        // This is overridden by the async function below
        window.editEmployeeAsync(employeeId);
      }

      // Delete employee
      async function deleteEmployee(employeeId) {
        if (!confirm('Sind Sie sicher, dass Sie diesen Mitarbeiter l√∂schen m√∂chten?')) {
          return;
        }

        const token = localStorage.getItem('token');

        try {
          const response = await fetch(`/api/users/${employeeId}`, {
            method: 'DELETE',
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (response.ok) {
            alert('Mitarbeiter erfolgreich gel√∂scht');
            loadEmployeesTable(); // Reload the table
            loadRecentEmployees(); // Update recent employees
            loadDashboardStats(); // Update statistics
          } else {
            const error = await response.json();
            alert(`Fehler: ${error.message}`);
          }
        } catch (error) {
          console.error('Error deleting employee:', error);
          alert('Ein Fehler ist aufgetreten');
        }
      }

      function showAllDocuments() {
        console.log('Show all documents');
      }

      function showAllDepartments() {
        showSection('departments-section');
      }

      function showAllTeams() {
        console.log('Show all teams');
      }

      // Section Navigation is now handled by show-section.ts module
    </script>

    <style>
      /* Search Styles */
      .search-container {
        display: flex;
        gap: var(--spacing-sm);
        margin-left: auto;
      }

      .search-input {
        min-width: 300px;
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        background-color: var(--background-dark);
        color: var(--text-primary);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
      }

      .flex-between {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: var(--spacing-md);
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
      }

      .button-group {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        margin-top: 20px;
      }

      .modal-content {
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: var(--spacing-lg);
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow:
          0 8px 32px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        animation: fadeInUp 0.3s ease-out;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-secondary);
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: var(--radius-sm);
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        background-color: var(--background-dark);
        color: var(--error-color);
      }

      .table-responsive {
        overflow-x: auto;
        margin-top: var(--spacing-md);
      }

      .btn-group {
        display: flex;
        gap: var(--spacing-sm);
      }

      .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 20px;
        transition: all 0.2s ease;
      }

      .badge-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .badge-secondary {
        background-color: var(--secondary-color);
        color: white;
      }

      .badge-success {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(76, 175, 80, 0.9);
        background: rgba(76, 175, 80, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(76, 175, 80, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }

      .badge-danger {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(244, 67, 54, 0.9);
        background: rgba(244, 67, 54, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(244, 67, 54, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }
      
      tr:hover .badge-success {
        background: rgba(76, 175, 80, 0.15);
        border-color: rgba(76, 175, 80, 0.3);
      }
      
      tr:hover .badge-danger {
        background: rgba(244, 67, 54, 0.15);
        border-color: rgba(244, 67, 54, 0.3);
      }

      .badge-warning {
        display: inline-flex;
        align-items: center;
        font-size: 11px;
        color: rgba(255, 152, 0, 0.9);
        background: rgba(255, 152, 0, 0.1);
        padding: 3px 8px;
        border-radius: 6px;
        text-transform: uppercase;
        letter-spacing: 0.8px;
        font-weight: 700;
        border: 1px solid rgba(255, 152, 0, 0.2);
        width: fit-content;
        transition: all 0.2s ease;
      }
      
      tr:hover .badge-warning {
        background: rgba(255, 152, 0, 0.15);
        border-color: rgba(255, 152, 0, 0.3);
      }

      .department-list,
      .team-list {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
      }

      .department-item,
      .team-item {
        padding: var(--spacing-sm);
        background-color: var(--background-dark);
        border-radius: var(--radius-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
    </style>
  </body>
</html>
