<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Critical Layout State - Prevents Layout Shift -->
    <script src="/scripts/critical/sidebar-init.js"></script>

    <!-- CSS Styles -->
    <link rel="stylesheet" href="/styles/admin-dashboard.css" />
    <link rel="stylesheet" href="/styles/lib/fontawesome.min.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />
    <link rel="stylesheet" href="/styles/blackboard-widget.css" />

    <!-- Unified Navigation CSS - Load immediately to prevent FOUC -->
    <link id="unified-navigation-styles" rel="stylesheet" href="/styles/unified-navigation.css" />
  </head>
  <body class="admin-dashboard">
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Breadcrumb Navigation -->
        <div id="breadcrumb-container"></div>

        <div class="container">
          <!-- Dashboard Section -->
          <section id="dashboard-section" class="content-section">
            <!-- Dashboard Stats Grid -->
            <div class="dashboard-grid">
              <div class="stat-card">
                <div class="stat-value" id="employee-count">0</div>
                <div class="stat-label">Mitarbeiter</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="document-count">0</div>
                <div class="stat-label">Dokumente</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="department-count">0</div>
                <div class="stat-label">Abteilungen</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="team-count">0</div>
                <div class="stat-label">Teams</div>
              </div>
            </div>

            <!-- Blackboard Widget -->
            <div id="blackboard-widget-container" style="margin-top: 2rem" data-sidebar-state="loading">
              <!-- Loading placeholder with same styles as final widget -->
              <div class="blackboard-widget" style="animation: subtle-pulse 2s ease-in-out infinite">
                <div class="blackboard-widget-header">
                  <h3 class="blackboard-widget-title">
                    <i class="fas fa-thumbtack"></i>
                    Schwarzes Brett
                  </h3>
                  <a href="/blackboard" class="blackboard-widget-link" style="opacity: 0.5">
                    Alle anzeigen
                    <i class="fas fa-arrow-right"></i>
                  </a>
                </div>
                <div id="blackboard-widget-content" style="min-height: 200px; display: flex; align-items: center; justify-content: center">
                  <div class="text-muted" style="text-align: center">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem"></i>
                    <p>Lade Einträge...</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Main Grid Container -->
            <div class="admin-grid">
              <!-- Employee Card -->
              <div class="card compact-card">
                <div class="card-header">
                  <h2 class="card-title">Mitarbeiter</h2>
                  <p class="text-secondary u-mt-text">Mitarbeiter verwalten und hinzufügen</p>
                </div>
                <div class="compact-content">
                  <a
                    href="/pages/manage-employees.html"
                    class="btn btn-primary btn-block mb-3"
                    style="display: flex; align-items: center; justify-content: center; text-decoration: none"
                  >
                    Mitarbeiter verwalten
                  </a>
                  <div class="compact-list" id="recent-employees">
                    <!-- Wird dynamisch gefüllt: Letzte 5 Mitarbeiter -->
                  </div>
                  <a href="/manage-employees" class="view-all-link" id="manage-employees-link">
                    Alle anzeigen
                    <span class="arrow">→</span>
                  </a>
                </div>
              </div>

              <!-- Document Card -->
              <div class="card compact-card">
                <div class="card-header">
                  <h2 class="card-title">Dokumente</h2>
                  <p class="text-secondary u-mt-text">Dokumente hochladen und verwalten</p>
                </div>
                <div class="compact-content">
                  <a href="/document-upload" class="btn btn-primary btn-block mb-3">Dokument hochladen</a>
                  <div class="compact-list" id="recent-documents">
                    <!-- Wird dynamisch gefüllt: Letzte 5 Dokumente -->
                  </div>
                  <a href="/documents-search" class="view-all-link" id="manage-documents-link">
                    Verwalten
                    <span class="arrow">→</span>
                  </a>
                </div>
              </div>

              <!-- Department Card -->
              <div class="card compact-card">
                <div class="card-header">
                  <h2 class="card-title">Abteilungen</h2>
                  <p class="text-secondary u-mt-text">Abteilungsstruktur organisieren</p>
                </div>
                <div class="compact-content">
                  <a href="/manage-departments" class="btn btn-primary btn-block mb-3">Abteilungen verwalten</a>
                  <div class="compact-list" id="department-list">
                    <!-- Wird dynamisch gefüllt -->
                  </div>
                  <a href="/manage-departments" class="view-all-link" id="manage-departments-link">
                    Verwalten
                    <span class="arrow">→</span>
                  </a>
                </div>
              </div>

              <!-- Team Card -->
              <div class="card compact-card">
                <div class="card-header">
                  <h2 class="card-title">Teams</h2>
                  <p class="text-secondary u-mt-text">Teams erstellen und verwalten</p>
                </div>
                <div class="compact-content">
                  <a href="/manage-teams" class="btn btn-primary btn-block mb-3">Teams verwalten</a>
                  <div class="compact-list" id="team-list">
                    <!-- Wird dynamisch gefüllt -->
                  </div>
                  <a href="/manage-teams" class="view-all-link">
                    Verwalten
                    <span class="arrow">→</span>
                  </a>
                </div>
              </div>

              <!-- Kalender Card -->
              <div class="card compact-card">
                <div class="card-header">
                  <h2 class="card-title">Kalender</h2>
                  <p class="text-secondary u-mt-text">Termine und Events verwalten</p>
                </div>
                <div class="compact-content">
                  <a href="/calendar" class="btn btn-primary btn-block mb-3">Kalender öffnen</a>
                  <div class="compact-list" id="calendar-events-list">
                    <!-- Wird dynamisch gefüllt -->
                    <div class="list-item">
                      <div class="list-item-content">
                        <strong>Nächste Termine</strong>
                        <p class="text-secondary">Keine anstehenden Termine</p>
                      </div>
                    </div>
                  </div>
                  <a href="/calendar" class="view-all-link">
                    Alle anzeigen
                    <span class="arrow">→</span>
                  </a>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- JavaScript Modules -->
    <!-- Unified Navigation -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>

    <!-- Dashboard Functionality -->
    <script type="module" src="/scripts/admin/dashboard/index.ts"></script>

    <!-- Role Switch for Admin -->
    <script type="module" src="/scripts/auth/role-switch.ts"></script>

    <!-- Force dashboard to be active on page load -->
    <script type="module">
      import { SessionManager } from '/scripts/utils/session-manager.ts';

      const session = SessionManager.getInstance();
      session.validateDashboardAccess('admin');

      document.addEventListener('DOMContentLoaded', () => {
        // Clear any stored active navigation to ensure dashboard is selected
        localStorage.removeItem('activeNavigation');

        // Dashboard section is always visible (no more section switching)
        const dashboardSection = document.querySelector('#dashboard-section');
        if (dashboardSection) {
          dashboardSection.style.display = 'block';
        }
      });
    </script>

    <!-- Breadcrumb Component -->
    <script type="module">
      import { initBreadcrumb } from '/scripts/components/breadcrumb.js';
      // Breadcrumb wird automatisch generiert basierend auf der URL
      initBreadcrumb();
    </script>

    <!-- Mark body as loaded after all scripts -->
    <script>
      window.addEventListener('load', function () {
        setTimeout(() => {
          document.body.classList.add('loaded');
        }, 100);
      });
    </script>
  </body>
</html>
