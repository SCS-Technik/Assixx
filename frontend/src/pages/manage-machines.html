<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maschinen verwalten - Assixx</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Google Fonts - Outfit -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Critical Layout State - Prevents Layout Shift -->
    <script src="/scripts/critical/sidebar-init.js"></script>

    <!-- Unified Navigation CSS - Load immediately to prevent FOUC -->
    <link rel="stylesheet" href="/styles/unified-navigation.css" />
    <link rel="stylesheet" href="/styles/manage-machines.css" />
    <link rel="stylesheet" href="/styles/user-info-update.css" />

    <!-- Common Scripts with ApiClient -->
    <script type="module" src="/scripts/common.js"></script>
  </head>
  <body>
    <!-- Unified Navigation -->
    <div id="navigation-container"></div>

    <!-- Main Layout with Sidebar -->
    <div class="layout-container">
      <!-- Main Content Area -->
      <main class="main-content">
        <!-- Breadcrumb -->
        <div id="breadcrumb-container"></div>

        <div class="container">
          <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center">
              <div>
                <h2 class="card-title">Maschinen√ºbersicht</h2>
                <p class="text-secondary">Alle Maschinen verwalten und bearbeiten</p>
              </div>
            </div>

            <div class="flex-between mb-3">
              <div class="filter-buttons">
                <button id="show-all-machines" class="btn btn-sm btn-primary">Alle anzeigen</button>
                <button id="filter-machines-operational" class="btn btn-sm btn-secondary">Betriebsbereit</button>
                <button id="filter-machines-maintenance" class="btn btn-sm btn-secondary">In Wartung</button>
                <button id="filter-machines-repair" class="btn btn-sm btn-secondary">In Reparatur</button>
              </div>
              <div class="search-container">
                <input type="text" id="machine-search" class="search-input" placeholder="Name, Modell, Hersteller oder Abteilung..." />
                <button id="machine-search-btn" class="btn btn-secondary">Suchen</button>
              </div>
            </div>

            <div class="table-responsive">
              <div id="machines-loading" class="loading u-hidden">
                <div class="spinner"></div>
                <p>Maschinen werden geladen...</p>
              </div>

              <table class="admin-table" id="machines-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Modell</th>
                    <th>Hersteller</th>
                    <th>Abteilung</th>
                    <th>Status</th>
                    <th>Betriebsstunden</th>
                    <th>N√§chste Wartung</th>
                    <th>Aktionen</th>
                  </tr>
                </thead>
                <tbody id="machines-table-body">
                  <!-- Wird dynamisch gef√ºllt -->
                </tbody>
              </table>

              <div id="machines-empty" class="empty-state u-hidden">
                <div class="empty-state-icon">üè≠</div>
                <div class="empty-state-text">Keine Maschinen gefunden</div>
                <div class="empty-state-subtext">F√ºgen Sie Ihre erste Maschine hinzu</div>
              </div>
            </div>
          </div>
          <!-- End of card -->
        </div>
        <!-- End of container -->
      </main>
    </div>

    <!-- Add/Edit Machine Modal -->
    <div id="machine-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="machine-modal-title">Neue Maschine</h3>
          <button class="modal-close" id="close-machine-modal">&times;</button>
        </div>
        <form id="machine-form">
          <div class="modal-body">
            <input type="hidden" id="machine-id" />

            <div class="form-group">
              <label class="form-label" for="machine-name">Name *</label>
              <input type="text" id="machine-name" name="name" class="form-control" required />
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-model">Modell</label>
              <input type="text" id="machine-model" name="model" class="form-control" />
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-manufacturer">Hersteller</label>
              <input type="text" id="machine-manufacturer" name="manufacturer" class="form-control" />
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-serial">Seriennummer</label>
              <input type="text" id="machine-serial" name="serialNumber" class="form-control" />
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-department">Abteilung</label>
              <select id="machine-department" name="departmentId" class="form-control">
                <option value="">Keine Abteilung</option>
                <!-- Wird dynamisch gef√ºllt -->
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-area">Bereich</label>
              <select id="machine-area" name="areaId" class="form-control">
                <option value="">Kein Bereich</option>
                <!-- Wird dynamisch gef√ºllt -->
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-type">Maschinentyp</label>
              <select id="machine-type" name="machineType" class="form-control">
                <option value="production">Produktion</option>
                <option value="packaging">Verpackung</option>
                <option value="quality_control">Qualit√§tskontrolle</option>
                <option value="logistics">Logistik</option>
                <option value="utility">Versorgung</option>
                <option value="other">Sonstiges</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-status">Status</label>
              <select id="machine-status" name="status" class="form-control">
                <option value="operational">Betriebsbereit</option>
                <option value="maintenance">In Wartung</option>
                <option value="repair">In Reparatur</option>
                <option value="standby">Standby</option>
                <option value="decommissioned">Au√üer Betrieb</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-hours">Betriebsstunden</label>
              <input type="number" id="machine-hours" name="operatingHours" class="form-control" min="0" step="0.1" />
            </div>

            <div class="form-group">
              <label class="form-label" for="machine-next-maintenance">N√§chste Wartung</label>
              <input type="date" id="machine-next-maintenance" name="nextMaintenance" class="form-control" />
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-machine-modal">Abbrechen</button>
            <button type="submit" class="btn btn-primary">Speichern</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-machine-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Maschine l√∂schen</h3>
          <button class="modal-close" id="close-delete-modal">&times;</button>
        </div>
        <div class="modal-body">
          <p>M√∂chten Sie diese Maschine wirklich l√∂schen?</p>
          <p class="text-secondary">Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.</p>
          <input type="hidden" id="delete-machine-id" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancel-delete-modal">Abbrechen</button>
          <button type="button" class="btn btn-primary" id="confirm-delete-machine">L√∂schen</button>
        </div>
      </div>
    </div>

    <!-- Floating Add Button -->
    <button id="add-machine-btn" class="add-machine-btn">+</button>

    <!-- Navigation Components -->
    <script type="module" src="/scripts/components/unified-navigation.ts"></script>
    <script type="module" src="/scripts/auth/role-switch.ts"></script>
    <!-- Breadcrumb -->
    <script type="module" src="/scripts/components/breadcrumb.js"></script>

    <!-- Page Script -->
    <script type="module" src="/scripts/manage/machines.ts"></script>
  </body>
</html>
