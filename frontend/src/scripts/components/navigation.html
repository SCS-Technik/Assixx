<!-- Main Navigation Component -->
<nav class="main-nav">
  <div class="nav-logo">
    <span class="nav-title">Lohnabrechnung Online</span>
  </div>

  <div class="nav-user">
    <div id="nav-profile-pic" class="nav-profile-pic">
      <!-- Wird dynamisch bef√ºllt (Bild oder Initialen) -->
    </div>
    <div class="nav-user-info">
      <span id="nav-username" class="nav-username">Benutzername</span>
      <span id="nav-role" class="nav-role">Rolle</span>
    </div>
  </div>

  <ul class="nav-menu">
    <!-- Diese Men√ºpunkte werden je nach Benutzerrolle ein-/ausgeblendet -->
    <li class="nav-item" data-role="employee,admin,root">
      <a href="/dashboard" class="nav-link">
        <i class="nav-icon dashboard-icon"></i>
        <span>Dashboard</span>
      </a>
    </li>

    <li class="nav-item" data-role="employee">
      <a href="/employee-profile" class="nav-link">
        <i class="nav-icon profile-icon"></i>
        <span>Mein Profil</span>
      </a>
    </li>

    <li class="nav-item" data-role="employee">
      <a href="/employee-documents" class="nav-link">
        <i class="nav-icon documents-icon"></i>
        <span>Meine Dokumente</span>
      </a>
    </li>

    <!-- Neuer Men√ºpunkt f√ºr Gehaltsabrechnungen -->
    <li class="nav-item" data-role="employee">
      <a href="/salary-documents" class="nav-link">
        <i class="nav-icon salary-icon"></i>
        <span>Gehaltsabrechnungen</span>
      </a>
    </li>

    <style>
      /* Icon f√ºr Gehaltsabrechnungen */
      .salary-icon::before {
        content: 'üí∞';
      }
    </style>

    <li class="nav-item" data-role="admin,root">
      <a href="/admin-dashboard" class="nav-link">
        <i class="nav-icon admin-icon"></i>
        <span>Mitarbeiter</span>
      </a>
    </li>

    <li class="nav-item" data-role="admin,root">
      <a href="/org-management" class="nav-link">
        <i class="nav-icon org-icon"></i>
        <span>Abteilungen & Teams</span>
      </a>
    </li>

    <li class="nav-item" data-role="admin,root">
      <a href="/document-upload" class="nav-link">
        <i class="nav-icon upload-icon"></i>
        <span>Dokumente hochladen</span>
      </a>
    </li>

    <li class="nav-item" data-role="root">
      <a href="/root-dashboard" class="nav-link">
        <i class="nav-icon root-icon"></i>
        <span>Root Dashboard</span>
      </a>
    </li>

    <li class="nav-item" data-role="admin,root">
      <a href="/api-test" class="nav-link">
        <i class="nav-icon api-icon"></i>
        <span>API Test</span>
      </a>
    </li>

    <li class="nav-item" data-role="employee,admin,root">
      <a href="/settings" class="nav-link">
        <i class="nav-icon settings-icon"></i>
        <span>Einstellungen</span>
      </a>
    </li>
  </ul>

  <div class="nav-footer">
    <button id="logout-btn" class="nav-logout">
      <i class="nav-icon logout-icon"></i>
      <span>Abmelden</span>
    </button>
  </div>
</nav>

<style>
  /* Main Navigation Styles */
  .main-nav {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 250px;
    background-color: #333;
    color: #fff;
    display: flex;
    flex-direction: column;
    padding: 20px 0;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
    z-index: 1000;
  }

  .nav-logo {
    display: flex;
    align-items: center;
    padding: 0 20px;
    margin-bottom: 20px;
  }

  .nav-logo img {
    width: 40px;
    height: 40px;
    margin-right: 10px;
  }

  .nav-title {
    font-size: 18px;
    font-weight: bold;
  }

  .nav-user {
    display: flex;
    align-items: center;
    padding: 15px 20px;
    background-color: #444;
    margin-bottom: 20px;
  }

  .nav-profile-pic {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #1b8e01;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    margin-right: 10px;
    overflow: hidden;
  }

  .nav-profile-pic img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .nav-user-info {
    display: flex;
    flex-direction: column;
  }

  .nav-username {
    font-weight: bold;
    margin-bottom: 2px;
  }

  .nav-role {
    font-size: 12px;
    color: #ccc;
  }

  .nav-menu {
    flex-grow: 1;
    list-style: none;
    padding: 0;
    margin: 0;
    overflow-y: auto;
  }

  .nav-item {
    margin-bottom: 5px;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 12px 20px;
    color: #ddd;
    text-decoration: none;
    transition: background-color 0.3s;
  }

  .nav-link:hover,
  .nav-link.active {
    background-color: #1b8e01;
    color: #fff;
  }

  .nav-icon {
    margin-right: 10px;
    width: 20px;
    height: 20px;
    display: inline-block;
    opacity: 0%.8;
    /*
    Here we would normally add background-image for each icon,
    but for simplicity we'll use Unicode symbols
    */
  }

  .dashboard-icon::before {
    content: 'üìä';
  }
  .profile-icon::before {
    content: 'üë§';
  }
  .documents-icon::before {
    content: 'üìÑ';
  }
  .admin-icon::before {
    content: 'üë•';
  }
  .org-icon::before {
    content: 'üè¢';
  }
  .upload-icon::before {
    content: 'üì§';
  }
  .root-icon::before {
    content: '‚öôÔ∏è';
  }
  .api-icon::before {
    content: 'üß™';
  }
  .settings-icon::before {
    content: 'üîß';
  }
  .logout-icon::before {
    content: 'üö™';
  }

  .nav-footer {
    padding: 24px;
    border-top: 1px solid #444;
  }

  .nav-logout {
    width: 100%;
    display: flex;
    align-items: center;
    padding: 10px 15px;
    background-color: transparent;
    color: #ddd;
    border: 1px solid #666;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .nav-logout:hover {
    background-color: #d9534f;
    color: #fff;
    border-color: #d9534f;
  }

  /* Responsive layout */
  @media (max-width: 992px) {
    .main-nav {
      width: 200px;
    }
  }

  @media (max-width: 768px) {
    .main-nav {
      width: 60px;
      transition: width 0.3s;
    }

    .nav-title,
    .nav-user-info,
    .nav-link span {
      display: none;
    }

    .nav-link {
      justify-content: center;
    }

    .nav-icon {
      margin-right: 0;
    }

    .nav-logout span {
      display: none;
    }

    .main-nav:hover {
      width: 200px;
    }

    .main-nav:hover .nav-title,
    .main-nav:hover .nav-user-info,
    .main-nav:hover .nav-link span,
    .main-nav:hover .nav-logout span {
      display: block;
    }

    .main-nav:hover .nav-link {
      justify-content: flex-start;
    }

    .main-nav:hover .nav-icon {
      margin-right: 10px;
    }
  }

  /* Adjust main content to make room for the navigation */
  body {
    margin-left: 250px;
  }

  @media (max-width: 992px) {
    body {
      margin-left: 200px;
    }
  }

  @media (max-width: 768px) {
    body {
      margin-left: 60px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Elemente ausw√§hlen
    const navUsername = document.getElementById('nav-username');
    const navRole = document.getElementById('nav-role');
    const navProfilePic = document.getElementById('nav-profile-pic');
    const logoutBtn = document.getElementById('logout-btn');
    const navLinks = document.querySelectorAll('.nav-link');

    // Aktuelle Seite hervorheben
    const currentPage = window.location.pathname;
    navLinks.forEach((link) => {
      if (link.getAttribute('href') === currentPage) {
        link.classList.add('active');
      }
    });

    // Men√ºelemente basierend auf der Benutzerrolle anzeigen/ausblenden
    const userRole = localStorage.getItem('role') || '';
    const navItems = document.querySelectorAll('.nav-item');

    navItems.forEach((item) => {
      const roles = item.getAttribute('data-role').split(',');
      if (!roles.includes(userRole)) {
        item.style.display = 'none';
      }
    });

    // Benutzerdaten laden
    loadUserData();

    // Logout-Funktion
    if (logoutBtn) {
      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('token');
        localStorage.removeItem('role');
        window.location.href = '/';
      });
    }

    // Benutzerdaten f√ºr die Navigation laden
    async function loadUserData() {
      try {
        const response = await fetch('/users/current', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('token')}`,
          },
        });

        if (response.ok) {
          const userData = await response.json();

          // Benutzernamen anzeigen
          if (navUsername) {
            navUsername.textContent = userData.username;
          }

          // Rolle anzeigen (erster Buchstabe gro√ü)
          if (navRole && userData.role) {
            navRole.textContent = userData.role.charAt(0).toUpperCase() + userData.role.slice(1);
          }

          // Profilbild oder Initialen anzeigen
          if (navProfilePic) {
            if (userData.profile_picture) {
              // Sicher: DOM-Methoden statt innerHTML verwenden
              const img = document.createElement('img');
              img.src = `/${userData.profile_picture}`;
              img.alt = userData.username || '';
              navProfilePic.innerHTML = ''; // Clear existing content
              navProfilePic.appendChild(img);
            } else {
              const initials = getInitials(userData.first_name, userData.last_name);
              navProfilePic.textContent = initials;
            }
          }
        } else {
          console.error('Failed to load user data');
        }
      } catch (error) {
        console.error('Error loading user data:', error);
      }
    }

    // Initialen aus Vor- und Nachname extrahieren
    function getInitials(firstName = '', lastName = '') {
      const firstInitial = firstName ? firstName.charAt(0).toUpperCase() : '';
      const lastInitial = lastName ? lastName.charAt(0).toUpperCase() : '';
      return `${firstInitial}${lastInitial}`;
    }
  });
</script>
