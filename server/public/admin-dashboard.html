<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css/profile-picture.css">
    <style>
        :root {
            --primary-color: #1b8e01;
            --secondary-color: #156600;
            --accent-color: #007bff;
            --danger-color: #d9534f;
            --text-color: #333;
            --light-text: #f7f7f7;
            --bg-color: #f7f7f7;
            --dark-bg: rgb(81, 80, 80);
            --card-bg: #ffffff;
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            display: flex;
        }

        /* Main content area */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            margin-left: 250px;
            transition: margin-left 0.3s;
        }

        @media (max-width: 992px) {
            .main-content {
                margin-left: 200px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-left: 60px;
            }
        }

        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 28px;
            color: var(--primary-color);
        }

        .welcome-message {
            display: flex;
            align-items: center;
        }

        .welcome-text {
            margin-right: 15px;
        }

        .user-name {
            font-weight: bold;
        }

        .section {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .section-action {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .section-action:hover {
            background-color: var(--secondary-color);
        }

        /* Dashboard statistics */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        .stat-card:nth-child(1) {
            border-left: 4px solid #1b8e01;
        }

        .stat-card:nth-child(2) {
            border-left: 4px solid #007bff;
        }

        .stat-card:nth-child(3) {
            border-left: 4px solid #ffc107;
        }

        .stat-card:nth-child(4) {
            border-left: 4px solid #17a2b8;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        tbody tr:hover {
            background-color: #f9f9f9;
        }

        /* Forms */
        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        button.secondary {
            background-color: #6c757d;
        }

        button.secondary:hover {
            background-color: #5a6268;
        }

        button.danger {
            background-color: var(--danger-color);
        }

        button.danger:hover {
            background-color: #c82333;
        }

        /* Search container */
        .search-container {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* Employee cards */
        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .employee-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            flex-direction: column;
        }

        .employee-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .employee-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 15px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .employee-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .employee-info {
            flex-grow: 1;
        }

        .employee-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .employee-position {
            color: #666;
            font-size: 14px;
        }

        .employee-details {
            margin-bottom: 15px;
        }

        .employee-detail {
            display: flex;
            margin-bottom: 8px;
        }

        .detail-label {
            width: 100px;
            font-weight: bold;
            color: #666;
        }

        .detail-value {
            flex-grow: 1;
        }

        .employee-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        .employee-actions button {
            flex: 1;
            font-size: 13px;
            padding: 8px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            list-style: none;
            margin-top: 20px;
        }

        .page-item {
            margin: 0 5px;
        }

        .page-link {
            display: block;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            color: var(--primary-color);
            background-color: white;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .page-item.disabled .page-link {
            color: #ccc;
            cursor: not-allowed;
        }

        /* Badge styles */
        .badge {
            display: inline-block;
            padding: 3px 7px;
            font-size: 12px;
            border-radius: 10px;
            background-color: #e9ecef;
            margin-left: 5px;
        }

        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-info {
            background-color: var(--accent-color);
            color: white;
        }

        /* Tabs for multi-section content */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            color: #666;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 600px;
            padding: 20px;
            box-shadow: var(--box-shadow);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        /* Toggle switch for settings */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(100%, 1fr));
            }

            .employee-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation will be loaded here -->
    <div id="navigation-container"></div>

    <div class="main-content">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <div class="welcome-message">
                <div class="welcome-text">
                    Willkommen, <span id="welcome-name" class="user-name">Admin</span>!
                </div>
                <div id="header-profile-pic" class="nav-profile-pic">
                    <!-- Wird dynamisch befüllt -->
                </div>
            </div>
        </div>

        <!-- Dashboard Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="stats-employees">0</div>
                <div class="stat-label">Mitarbeiter insgesamt</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stats-departments">0</div>
                <div class="stat-label">Abteilungen</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stats-teams">0</div>
                <div class="stat-label">Teams</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stats-documents">0</div>
                <div class="stat-label">Dokumente hochgeladen</div>
            </div>
        </div>

        <!-- Dashboard Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="employees">Mitarbeiter</button>
            <button class="tab" data-tab="departments">Abteilungen & Teams</button>
            <button class="tab" data-tab="documents">Dokumente</button>
            <button class="tab" data-tab="create-employee">Neuer Mitarbeiter</button>
        </div>

        <!-- Employees Tab -->
        <div id="employees" class="tab-content active">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Mitarbeiter verwalten</h2>
                    <button class="section-action" onclick="showTab('create-employee')">Neuen Mitarbeiter erstellen</button>
                </div>
                
                <div class="search-container">
                    <form id="employee-search-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <label for="employee-search-input">Suche</label>
                                <input type="text" id="employee-search-input" placeholder="Name, E-Mail, Mitarbeiter-ID...">
                            </div>
                            <div class="form-group">
                                <label for="department-filter">Abteilung</label>
                                <select id="department-filter">
                                    <option value="">Alle Abteilungen</option>
                                    <!-- Wird dynamisch gefüllt -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="team-filter">Team</label>
                                <select id="team-filter">
                                    <option value="">Alle Teams</option>
                                    <!-- Wird dynamisch gefüllt -->
                                </select>
                            </div>
                            <div class="form-group" style="flex: 0.5; display: flex; align-items: flex-end;">
                                <button type="submit">Suchen</button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="employee-view-toggle" style="margin-bottom: 20px;">
                    <button id="grid-view-btn" class="active" onclick="switchView('grid')">Kachelansicht</button>
                    <button id="table-view-btn" onclick="switchView('table')">Tabellenansicht</button>
                </div>

                <!-- Grid view for employees -->
                <div id="employee-grid-view" class="employee-grid">
                    <!-- Wird dynamisch gefüllt -->
                </div>

                <!-- Table view for employees -->
                <div id="employee-table-view" style="display: none;">
                    <table>
                        <thead>
                            <tr>
                                <th>Mitarbeiter</th>
                                <th>E-Mail</th>
                                <th>Mitarbeiter-ID</th>
                                <th>Abteilung</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="employee-table-body">
                            <!-- Wird dynamisch gefüllt -->
                        </tbody>
                    </table>
                </div>

                <div id="pagination-container" class="pagination">
                    <!-- Wird dynamisch gefüllt -->
                </div>
            </div>
        </div>

        <!-- Departments & Teams Tab -->
        <div id="departments" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Abteilungen & Teams</h2>
                    <a href="/org-management.html" class="section-action">Zur Detailansicht</a>
                </div>

                <div class="tabs">
                    <button class="tab active" data-subtab="departments-list">Abteilungen</button>
                    <button class="tab" data-subtab="teams-list">Teams</button>
                    <button class="tab" data-subtab="org-chart">Organisationsstruktur</button>
                </div>

                <div id="departments-list" class="subtab-content active">
                    <div class="search-container">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <input type="text" id="department-search-input" placeholder="Abteilung suchen...">
                            </div>
                            <div class="form-group" style="flex: 0.5;">
                                <button onclick="showDepartmentModal()">Neue Abteilung</button>
                            </div>
                        </div>
                    </div>

                    <div id="departments-container">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <div id="teams-list" class="subtab-content">
                    <div class="search-container">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <input type="text" id="team-search-input" placeholder="Team suchen...">
                            </div>
                            <div class="form-group">
                                <select id="team-department-filter">
                                    <option value="">Alle Abteilungen</option>
                                    <!-- Wird dynamisch gefüllt -->
                                </select>
                            </div>
                            <div class="form-group" style="flex: 0.5;">
                                <button onclick="showTeamModal()">Neues Team</button>
                            </div>
                        </div>
                    </div>

                    <div id="teams-container">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <div id="org-chart" class="subtab-content">
                    <div id="org-chart-container" style="min-height: 400px; padding: 20px;">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Documents Tab -->
        <div id="documents" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Dokumente verwalten</h2>
                    <button class="section-action" onclick="showUploadDocumentModal()">Dokument hochladen</button>
                </div>

                <div class="search-container">
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <input type="text" id="document-search-input" placeholder="Dokument suchen...">
                        </div>
                        <div class="form-group">
                            <select id="document-employee-filter">
                                <option value="">Alle Mitarbeiter</option>
                                <!-- Wird dynamisch gefüllt -->
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="date" id="document-date-filter" placeholder="Datum">
                        </div>
                        <div class="form-group" style="flex: 0.5;">
                            <button id="document-search-btn">Suchen</button>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Dateiname</th>
                                <th>Mitarbeiter</th>
                                <th>Hochgeladen am</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="document-table-body">
                            <!-- Wird dynamisch gefüllt -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Create Employee Tab -->
        <div id="create-employee" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">Neuen Mitarbeiter erstellen</h2>
                    <button class="section-action secondary" onclick="showTab('employees')">Zurück zur Übersicht</button>
                </div>

                <form id="create-employee-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="username">Benutzername *</label>
                            <input type="text" id="username" name="username" required>
                        </div>
                        <div class="form-group">
                            <label for="email">E-Mail *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="password">Passwort *</label>
                            <input type="password" id="password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirm_password">Passwort bestätigen *</label>
                            <input type="password" id="confirm_password" name="confirm_password" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="first_name">Vorname *</label>
                            <input type="text" id="first_name" name="first_name" required>
                        </div>
                        <div class="form-group">
                            <label for="last_name">Nachname *</label>
                            <input type="text" id="last_name" name="last_name" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="employee_id">Mitarbeiter-ID *</label>
                            <input type="text" id="employee_id" name="employee_id" required>
                        </div>
                        <div class="form-group">
                            <label for="position">Position</label>
                            <input type="text" id="position" name="position">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="department_id">Abteilung</label>
                            <select id="department_id" name="department_id">
                                <option value="">Keine Abteilung</option>
                                <!-- Wird dynamisch gefüllt -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="age">Alter</label>
                            <input type="number" id="age" name="age" min="18" max="100">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phone">Telefon</label>
                            <input type="tel" id="phone" name="phone">
                        </div>
                        <div class="form-group">
                            <label for="iban">IBAN *</label>
                            <input type="text" id="iban" name="iban" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="address">Adresse</label>
                        <textarea id="address" name="address" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="birthday">Geburtstag</label>
                            <input type="date" id="birthday" name="birthday">
                        </div>
                        <div class="form-group">
                            <label for="hire_date">Einstellungsdatum</label>
                            <input type="date" id="hire_date" name="hire_date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="emergency_contact">Notfallkontakt</label>
                        <input type="text" id="emergency_contact" name="emergency_contact">
                    </div>

                    <div class="form-group">
                        <label for="notes">Notizen</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>

                    <div class="form-group" style="margin-top: 20px;">
                        <button type="submit">Mitarbeiter erstellen</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <!-- Department Modal -->
    <div id="department-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="department-modal-title">Neue Abteilung</h3>
                <button class="modal-close" onclick="hideDepartmentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="department-form">
                    <input type="hidden" id="department-id" name="id">
                    
                    <div class="form-group">
                        <label for="department-name">Name *</label>
                        <input type="text" id="department-name" name="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="department-description">Beschreibung</label>
                        <textarea id="department-description" name="description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="department-manager">Manager</label>
                        <select id="department-manager" name="manager_id" class="form-control">
                            <option value="">Kein Manager</option>
                            <!-- Wird dynamisch gefüllt -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="department-parent">Übergeordnete Abteilung</label>
                        <select id="department-parent" name="parent_id" class="form-control">
                            <option value="">Keine übergeordnete Abteilung</option>
                            <!-- Wird dynamisch gefüllt -->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="hideDepartmentModal()">Abbrechen</button>
                <button class="primary" onclick="saveDepartment()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="team-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="team-modal-title">Neues Team</h3>
                <button class="modal-close" onclick="hideTeamModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="team-form">
                    <input type="hidden" id="team-id" name="id">
                    
                    <div class="form-group">
                        <label for="team-name">Name *</label>
                        <input type="text" id="team-name" name="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="team-description">Beschreibung</label>
                        <textarea id="team-description" name="description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="team-department">Abteilung</label>
                        <select id="team-department" name="department_id" class="form-control">
                            <option value="">Keine Abteilung</option>
                            <!-- Wird dynamisch gefüllt -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="team-leader">Teamleiter</label>
                        <select id="team-leader" name="leader_id" class="form-control">
                            <option value="">Kein Teamleiter</option>
                            <!-- Wird dynamisch gefüllt -->
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="hideTeamModal()">Abbrechen</button>
                <button class="primary" onclick="saveTeam()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Upload Document Modal -->
    <div id="upload-document-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Dokument hochladen</h3>
                <button class="modal-close" onclick="hideUploadDocumentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="upload-document-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="document-employee">Mitarbeiter *</label>
                        <select id="document-employee" name="employeeId" class="form-control" required>
                            <option value="">Mitarbeiter auswählen</option>
                            <!-- Wird dynamisch gefüllt -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="document-file">Dokument (PDF) *</label>
                        <input type="file" id="document-file" name="document" accept="application/pdf" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="document-category">Kategorie</label>
                        <select id="document-category" name="category">
                            <option value="payslip">Lohnabrechnung</option>
                            <option value="contract">Vertrag</option>
                            <option value="certificate">Zertifikat</option>
                            <option value="other">Sonstiges</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="document-notes">Notizen</label>
                        <textarea id="document-notes" name="notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="hideUploadDocumentModal()">Abbrechen</button>
                <button class="primary" onclick="uploadDocument()">Hochladen</button>
            </div>
        </div>
    </div>

    <!-- Employee Detail Modal -->
    <div id="employee-detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="employee-detail-name">Mitarbeiterdetails</h3>
                <button class="modal-close" onclick="hideEmployeeDetailModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="employee-detail-content">
                    <!-- Wird dynamisch gefüllt -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" onclick="hideEmployeeDetailModal()">Schließen</button>
                <button class="primary" id="edit-employee-btn">Bearbeiten</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Load navigation
        document.addEventListener('DOMContentLoaded', function() {
        // Lade Navigation
fetch('/js/components/navigation.html')
    .then(response => response.text())
    .then(data => {
        document.getElementById('navigation-container').innerHTML = data;
    })
    .catch(error => console.error('Error loading navigation:', error));

            // Lade Daten
            loadDashboardData();
            loadDepartments();
            loadTeams();
            loadEmployees();
            loadDocuments();

            // Event-Listener
            document.getElementById('create-employee-form').addEventListener('submit', createEmployee);
            document.getElementById('employee-search-form').addEventListener('submit', function(e) {
                e.preventDefault();
                loadEmployees(1); // Bei Suche immer auf Seite 1 zurücksetzen
            });

            // Tab-Wechsel
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });

            // Subtab-Wechsel
            document.querySelectorAll('[data-subtab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const subtabName = this.getAttribute('data-subtab');
                    showSubtab(subtabName);
                });
            });
        });

        // Funktionen zum Tab-Wechsel
        function showTab(tabName) {
            // Alle Tabs und Inhalte deaktivieren
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Ausgewählten Tab aktivieren
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
            document.getElementById(tabName).style.display = 'block';
        }

        function showSubtab(subtabName) {
            // Alle Subtabs und Inhalte deaktivieren
            document.querySelectorAll('[data-subtab]').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.subtab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Ausgewählten Subtab aktivieren
            document.querySelector(`[data-subtab="${subtabName}"]`).classList.add('active');
            document.getElementById(subtabName).classList.add('active');
            document.getElementById(subtabName).style.display = 'block';
        }

        // Ansicht wechseln (Kachel/Tabelle)
        function switchView(viewType) {
            if (viewType === 'grid') {
                document.getElementById('employee-grid-view').style.display = 'grid';
                document.getElementById('employee-table-view').style.display = 'none';
                document.getElementById('grid-view-btn').classList.add('active');
                document.getElementById('table-view-btn').classList.remove('active');
            } else {
                document.getElementById('employee-grid-view').style.display = 'none';
                document.getElementById('employee-table-view').style.display = 'block';
                document.getElementById('grid-view-btn').classList.remove('active');
                document.getElementById('table-view-btn').classList.add('active');
            }
        }

        // Dashboard-Daten laden
        async function loadDashboardData() {
            try {
                const response = await fetch('/admin/dashboard-stats', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const stats = await response.json();
                    
                    // Statistiken anzeigen
                    document.getElementById('stats-employees').textContent = stats.employeeCount || 0;
                    document.getElementById('stats-departments').textContent = stats.departmentCount || 0;
                    document.getElementById('stats-teams').textContent = stats.teamCount || 0;
                    document.getElementById('stats-documents').textContent = stats.documentCount || 0;
                    
                    // Benutzername im Header
                    document.getElementById('welcome-name').textContent = stats.adminName || 'Admin';
                } else {
                    console.error('Fehler beim Laden der Dashboard-Daten');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Dashboard-Daten:', error);
            }
        }

        // Abteilungen laden
        async function loadDepartments() {
            try {
                const response = await fetch('/departments', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const departments = await response.json();
                    
                    // Abteilungen für Dropdown-Menüs befüllen
                    const departmentFilters = document.querySelectorAll('#department-filter, #team-department-filter, #department_id');
                    departmentFilters.forEach(select => {
                        select.innerHTML = '<option value="">Alle Abteilungen</option>';
                        departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept.id;
                            option.textContent = dept.name;
                            select.appendChild(option);
                        });
                    });
                    
                    // Abteilungs-Manager Dropdown befüllen
                    if (document.getElementById('department-parent')) {
                        const parentSelect = document.getElementById('department-parent');
                        parentSelect.innerHTML = '<option value="">Keine übergeordnete Abteilung</option>';
                        departments.forEach(dept => {
                            const option = document.createElement('option');
                            option.value = dept.id;
                            option.textContent = dept.name;
                            parentSelect.appendChild(option);
                        });
                    }
                    
                    // Abteilungen in der Liste anzeigen
                    displayDepartments(departments);
                } else {
                    console.error('Fehler beim Laden der Abteilungen');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Abteilungen:', error);
            }
        }

        // Teams laden
        async function loadTeams() {
            try {
                const response = await fetch('/teams', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const teams = await response.json();
                    
                    // Teams für Dropdown-Menüs befüllen
                    const teamFilters = document.querySelectorAll('#team-filter');
                    teamFilters.forEach(select => {
                        select.innerHTML = '<option value="">Alle Teams</option>';
                        teams.forEach(team => {
                            const option = document.createElement('option');
                            option.value = team.id;
                            option.textContent = team.name;
                            select.appendChild(option);
                        });
                    });
                    
                    // Teams in der Liste anzeigen
                    displayTeams(teams);
                } else {
                    console.error('Fehler beim Laden der Teams');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Teams:', error);
            }
        }

        // Mitarbeiter laden
        async function loadEmployees(page = 1) {
            try {
                // Suchparameter aufbauen
                const searchTerm = document.getElementById('employee-search-input').value.trim();
                const departmentId = document.getElementById('department-filter').value;
                const teamId = document.getElementById('team-filter').value;
                
                // URL mit Parametern erstellen
                let url = `/users/search?role=employee&page=${page}&limit=10`;
                
                if (searchTerm) {
                    url += `&search=${encodeURIComponent(searchTerm)}`;
                }
                
                if (departmentId) {
                    url += `&department_id=${departmentId}`;
                }
                
                if (teamId) {
                    url += `&team_id=${teamId}`;
                }
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Mitarbeiter anzeigen (Grid und Tabelle)
                    displayEmployeesGrid(data.users);
                    displayEmployeesTable(data.users);
                    
                    // Pagination erstellen
                    createPagination(data.pagination, page);
                    
                    // Mitarbeiter für Dokument-Upload Dropdown
                    const employeeSelect = document.getElementById('document-employee');
                    if (employeeSelect) {
                        employeeSelect.innerHTML = '<option value="">Mitarbeiter auswählen</option>';
                        data.users.forEach(employee => {
                            const option = document.createElement('option');
                            option.value = employee.id;
                            option.textContent = `${employee.first_name} ${employee.last_name}`;
                            employeeSelect.appendChild(option);
                        });
                    }
                    
                    // Benutzer für Manager und Teamleiter Dropdowns
                    const managerSelects = document.querySelectorAll('#department-manager, #team-leader');
                    managerSelects.forEach(select => {
                        select.innerHTML = '<option value="">Keiner ausgewählt</option>';
                        data.users.forEach(employee => {
                            const option = document.createElement('option');
                            option.value = employee.id;
                            option.textContent = `${employee.first_name} ${employee.last_name}`;
                            select.appendChild(option);
                        });
                    });
                } else {
                    console.error('Fehler beim Laden der Mitarbeiter');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Mitarbeiter:', error);
            }
        }

        // Dokumente laden
        async function loadDocuments() {
            try {
                const response = await fetch('/admin/documents', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const documents = await response.json();
                    displayDocuments(documents);
                } else {
                    console.error('Fehler beim Laden der Dokumente');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Dokumente:', error);
            }
        }

        // Mitarbeiter erstellen
        async function createEmployee(e) {
            e.preventDefault();
            
            // Passwörter vergleichen
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm_password').value;
            
            if (password !== confirmPassword) {
                alert('Die Passwörter stimmen nicht überein!');
                return;
            }
            
            const formData = new FormData(e.target);
            const employeeData = Object.fromEntries(formData.entries());
            
            // confirm_password entfernen, da es nicht im Backend benötigt wird
            delete employeeData.confirm_password;
            
            try {
                const response = await fetch('/admin/create-employee', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(employeeData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    alert('Mitarbeiter erfolgreich erstellt');
                    
                    // Formular zurücksetzen
                    e.target.reset();
                    
                    // Zurück zur Mitarbeiterübersicht
                    showTab('employees');
                    
                    // Mitarbeiterliste neu laden
                    loadEmployees();
                    
                    // Dashboard-Daten aktualisieren
                    loadDashboardData();
                } else {
                    const error = await response.json();
                    alert(`Fehler: ${error.message}`);
                }
            } catch (error) {
                console.error('Fehler beim Erstellen des Mitarbeiters:', error);
                alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
            }
        }

        // Abteilungen anzeigen
        function displayDepartments(departments) {
            const container = document.getElementById('departments-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (departments.length === 0) {
                container.innerHTML = '<p style="text-align: center;">Keine Abteilungen gefunden</p>';
                return;
            }
            
            departments.forEach(dept => {
                // Manager-Info
                let managerInfo = 'Kein Manager';
                if (dept.manager_name) {
                    managerInfo = dept.manager_name;
                }
                
                // Übergeordnete Abteilung
                let parentInfo = '';
                if (dept.parent_name) {
                    parentInfo = `<span class="badge badge-primary">${dept.parent_name}</span>`;
                }
                
                const card = document.createElement('div');
                card.className = 'card';
                card.style.marginBottom = '15px';
                card.innerHTML = `
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${dept.name}</h3>
                            <p class="card-subtitle">Manager: ${managerInfo} ${parentInfo}</p>
                        </div>
                        <div>
                            <span class="badge">${dept.employee_count || 0} Mitarbeiter</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>${dept.description || 'Keine Beschreibung'}</p>
                    </div>
                    <div class="card-footer">
                        <button class="secondary" onclick="editDepartment(${dept.id})">Bearbeiten</button>
                        <button class="danger" onclick="deleteDepartment(${dept.id})">Löschen</button>
                        <button class="primary" onclick="viewDepartmentMembers(${dept.id})">Mitarbeiter anzeigen</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Teams anzeigen
        function displayTeams(teams) {
            const container = document.getElementById('teams-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (teams.length === 0) {
                container.innerHTML = '<p style="text-align: center;">Keine Teams gefunden</p>';
                return;
            }
            
            teams.forEach(team => {
                // Teamleiter-Info
                let leaderInfo = 'Kein Teamleiter';
                if (team.leader_name) {
                    leaderInfo = team.leader_name;
                }
                
                // Abteilungs-Info
                let departmentInfo = '';
                if (team.department_name) {
                    departmentInfo = `<span class="badge badge-primary">${team.department_name}</span>`;
                }
                
                const card = document.createElement('div');
                card.className = 'card';
                card.style.marginBottom = '15px';
                card.innerHTML = `
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${team.name}</h3>
                            <p class="card-subtitle">Teamleiter: ${leaderInfo} ${departmentInfo}</p>
                        </div>
                        <div>
                            <span class="badge">${team.member_count || 0} Mitglieder</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>${team.description || 'Keine Beschreibung'}</p>
                    </div>
                    <div class="card-footer">
                        <button class="secondary" onclick="editTeam(${team.id})">Bearbeiten</button>
                        <button class="danger" onclick="deleteTeam(${team.id})">Löschen</button>
                        <button class="primary" onclick="manageTeamMembers(${team.id})">Mitglieder verwalten</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Mitarbeiter im Grid anzeigen
        function displayEmployeesGrid(employees) {
            const container = document.getElementById('employee-grid-view');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (employees.length === 0) {
                container.innerHTML = '<div class="no-results" style="grid-column: 1 / -1; text-align: center; padding: 20px;">Keine Mitarbeiter gefunden</div>';
                return;
            }
            
            employees.forEach(employee => {
                const card = document.createElement('div');
                card.className = 'employee-card';
                
                // Profilbild oder Initialen
                let avatarContent;
                if (employee.profile_picture) {
                    avatarContent = `<img src="/${employee.profile_picture}" alt="${employee.first_name}">`;
                } else {
                    const initials = getInitials(employee.first_name, employee.last_name);
                    avatarContent = initials;
                }
                
                // Abteilung und Team
                let deptTeamInfo = '';
                if (employee.department_name) {
                    deptTeamInfo += `<span class="badge badge-primary">${employee.department_name}</span>`;
                }
                
                card.innerHTML = `
                    <div class="employee-header">
                        <div class="employee-avatar">${avatarContent}</div>
                        <div class="employee-info">
                            <h3 class="employee-name">${employee.first_name} ${employee.last_name}</h3>
                            <p class="employee-position">${employee.position || 'Keine Position'}</p>
                        </div>
                    </div>
                    <div class="employee-details">
                        <div class="employee-detail">
                            <span class="detail-label">E-Mail:</span>
                            <span class="detail-value">${employee.email}</span>
                        </div>
                        <div class="employee-detail">
                            <span class="detail-label">Mitarbeiter-ID:</span>
                            <span class="detail-value">${employee.employee_id}</span>
                        </div>
                        <div class="employee-detail">
                            <span class="detail-label">Telefon:</span>
                            <span class="detail-value">${employee.phone || '-'}</span>
                        </div>
                        <div class="employee-detail">
                            <span class="detail-label">Abteilung:</span>
                            <span class="detail-value">${employee.department_name || '-'} ${deptTeamInfo}</span>
                        </div>
                    </div>
                    <div class="employee-actions">
                        <button class="primary" onclick="viewEmployee(${employee.id})">Details</button>
                        <button class="secondary" onclick="editEmployee(${employee.id})">Bearbeiten</button>
                        <button class="danger" onclick="deleteEmployee(${employee.id}, '${employee.first_name} ${employee.last_name}')">Löschen</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Mitarbeiter in Tabelle anzeigen
        function displayEmployeesTable(employees) {
            const tableBody = document.getElementById('employee-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (employees.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Keine Mitarbeiter gefunden</td></tr>';
                return;
            }
            
            employees.forEach(employee => {
                const row = document.createElement('tr');
                
                // Profilbild oder Initialen
                let avatarContent;
                if (employee.profile_picture) {
                    avatarContent = `<img src="/${employee.profile_picture}" alt="${employee.first_name}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">`;
                } else {
                    const initials = getInitials(employee.first_name, employee.last_name);
                    avatarContent = `<div style="width: 40px; height: 40px; border-radius: 50%; background-color: #1b8e01; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">${initials}</div>`;
                }
                
                // Abteilung und Team
                let deptTeamInfo = '';
                if (employee.department_name) {
                    deptTeamInfo = `<span class="badge badge-primary">${employee.department_name}</span>`;
                }
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div style="margin-right: 10px;">${avatarContent}</div>
                            <div>
                                <div style="font-weight: bold;">${employee.first_name} ${employee.last_name}</div>
                                <div style="font-size: 12px; color: #666;">${employee.position || ''}</div>
                            </div>
                        </div>
                    </td>
                    <td>${employee.email}</td>
                    <td>${employee.employee_id}</td>
                    <td>${employee.department_name || '-'} ${deptTeamInfo}</td>
                    <td>
                        <button class="primary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="viewEmployee(${employee.id})">Details</button>
                        <button class="secondary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="editEmployee(${employee.id})">Bearbeiten</button>
                        <button class="danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEmployee(${employee.id}, '${employee.first_name} ${employee.last_name}')">Löschen</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Dokumente anzeigen
        function displayDocuments(documents) {
            const tableBody = document.getElementById('document-table-body');
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (documents.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Keine Dokumente gefunden</td></tr>';
                return;
            }
            
            documents.forEach(doc => {
                const row = document.createElement('tr');
                
                // Datum formatieren
                const date = new Date(doc.upload_date).toLocaleString('de-DE', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                row.innerHTML = `
                    <td>${doc.file_name}</td>
                    <td>${doc.employee_name || '-'}</td>
                    <td>${date}</td>
                    <td>
                        <button class="primary" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="downloadDocument('${doc.id}')">Herunterladen</button>
                        <button class="danger" style="padding: 5px 10px; font-size: 12px;" onclick="deleteDocument('${doc.id}')">Löschen</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Pagination erstellen
        function createPagination(pagination, currentPage) {
            const container = document.getElementById('pagination-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!pagination || pagination.pages <= 1) {
                return;
            }
            
            // Zurück-Button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            const prevLink = document.createElement('a');
            prevLink.className = 'page-link';
            prevLink.textContent = 'Zurück';
            if (currentPage > 1) {
                prevLink.href = '#';
                prevLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadEmployees(currentPage - 1);
                });
            }
            prevLi.appendChild(prevLink);
            container.appendChild(prevLi);
            
            // Seitenzahlen
            const maxPages = 5; // Maximale Anzahl von Seiten, die angezeigt werden
            const startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            const endPage = Math.min(pagination.pages, startPage + maxPages - 1);
            
            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                const link = document.createElement('a');
                link.className = 'page-link';
                link.textContent = i;
                link.href = '#';
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadEmployees(i);
                });
                li.appendChild(link);
                container.appendChild(li);
            }
            
            // Weiter-Button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === pagination.pages ? 'disabled' : ''}`;
            const nextLink = document.createElement('a');
            nextLink.className = 'page-link';
            nextLink.textContent = 'Weiter';
            if (currentPage < pagination.pages) {
                nextLink.href = '#';
                nextLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadEmployees(currentPage + 1);
                });
            }
            nextLi.appendChild(nextLink);
            container.appendChild(nextLi);
        }

        // Initialen aus Vor- und Nachname generieren
        function getInitials(firstName, lastName) {
            return (firstName ? firstName.charAt(0) : '') + (lastName ? lastName.charAt(0) : '');
        }

        // Modal-Funktionen
        function showDepartmentModal(departmentId) {
            const modal = document.getElementById('department-modal');
            modal.style.display = 'flex';
        }

        function hideDepartmentModal() {
            const modal = document.getElementById('department-modal');
            modal.style.display = 'none';
        }

        function showTeamModal(teamId) {
            const modal = document.getElementById('team-modal');
            modal.style.display = 'flex';
        }

        function hideTeamModal() {
            const modal = document.getElementById('team-modal');
            modal.style.display = 'none';
        }

        function showUploadDocumentModal() {
            const modal = document.getElementById('upload-document-modal');
            modal.style.display = 'flex';
        }

        function hideUploadDocumentModal() {
            const modal = document.getElementById('upload-document-modal');
            modal.style.display = 'none';
        }

        function showEmployeeDetailModal(employee) {
            const modal = document.getElementById('employee-detail-modal');
            const nameTitle = document.getElementById('employee-detail-name');
            const content = document.getElementById('employee-detail-content');
            const editBtn = document.getElementById('edit-employee-btn');
            
            // Titel und Bearbeiten-Button
            nameTitle.textContent = `${employee.first_name} ${employee.last_name}`;
            editBtn.onclick = () => editEmployee(employee.id);
            
            // Inhalt erstellen
            let detailsHtml = `
                <div class="employee-header" style="margin-bottom: 20px;">
                    <div class="employee-avatar" style="width: 80px; height: 80px; font-size: 30px;">
                        ${employee.profile_picture ? 
                          `<img src="/${employee.profile_picture}" alt="${employee.first_name}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                          getInitials(employee.first_name, employee.last_name)}
                    </div>
                    <div class="employee-info">
                        <h3 class="employee-name">${employee.first_name} ${employee.last_name}</h3>
                        <p class="employee-position">${employee.position || 'Keine Position'}</p>
                        <p>${employee.department_name ? `<span class="badge badge-primary">${employee.department_name}</span>` : ''}</p>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab active" data-detailtab="personal-details">Persönliche Daten</button>
                    <button class="tab" data-detailtab="work-details">Arbeitsdaten</button>
                    <button class="tab" data-detailtab="documents-list">Dokumente</button>
                </div>
                
                <div id="personal-details" class="tab-content active" style="display: block;">
                    <div class="detail-group">
                        <div class="detail-row">
                            <div class="detail-label">Benutzername:</div>
                            <div class="detail-value">${employee.username}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">E-Mail:</div>
                            <div class="detail-value">${employee.email}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Telefon:</div>
                            <div class="detail-value">${employee.phone || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Adresse:</div>
                            <div class="detail-value">${employee.address || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Geburtstag:</div>
                            <div class="detail-value">${employee.birthday ? new Date(employee.birthday).toLocaleDateString() : '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Notfallkontakt:</div>
                            <div class="detail-value">${employee.emergency_contact || '-'}</div>
                        </div>
                    </div>
                </div>
                
                <div id="work-details" class="tab-content">
                    <div class="detail-group">
                        <div class="detail-row">
                            <div class="detail-label">Mitarbeiter-ID:</div>
                            <div class="detail-value">${employee.employee_id}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Position:</div>
                            <div class="detail-value">${employee.position || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Abteilung:</div>
                            <div class="detail-value">${employee.department_name || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Teams:</div>
                            <div class="detail-value" id="employee-teams">Wird geladen...</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Einstellungsdatum:</div>
                            <div class="detail-value">${employee.hire_date ? new Date(employee.hire_date).toLocaleDateString() : '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">IBAN:</div>
                            <div class="detail-value">${employee.iban || '-'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Notizen:</div>
                            <div class="detail-value">${employee.notes || '-'}</div>
                        </div>
                    </div>
                </div>
                
                <div id="documents-list" class="tab-content">
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Dateiname</th>
                                <th>Hochgeladen am</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="employee-documents-body">
                            <tr><td colspan="3" style="text-align: center;">Wird geladen...</td></tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            content.innerHTML = detailsHtml;
            
            // Event-Listener für Tabs
            content.querySelectorAll('[data-detailtab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Alle Tabs und Inhalte deaktivieren
                    content.querySelectorAll('[data-detailtab]').forEach(t => t.classList.remove('active'));
                    content.querySelectorAll('.tab-content').forEach(c => {
                        c.classList.remove('active');
                        c.style.display = 'none';
                    });
                    
                    // Ausgewählten Tab aktivieren
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-detailtab');
                    const tabContent = content.querySelector(`#${tabId}`);
                    tabContent.classList.add('active');
                    tabContent.style.display = 'block';
                });
            });
            
            // Teams laden
            loadEmployeeTeams(employee.id);
            
            // Dokumente laden
            loadEmployeeDocuments(employee.id);
            
            // Modal anzeigen
            modal.style.display = 'flex';
        }

        function hideEmployeeDetailModal() {
            const modal = document.getElementById('employee-detail-modal');
            modal.style.display = 'none';
        }

        // Mitarbeiter-Aktionen
        async function viewEmployee(employeeId) {
            try {
                const response = await fetch(`/users/${employeeId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const employee = await response.json();
                    showEmployeeDetailModal(employee);
                } else {
                    console.error('Fehler beim Laden der Mitarbeiterdaten');
                    alert('Fehler beim Laden der Mitarbeiterdaten');
                }
            } catch (error) {
                console.error('Fehler beim Laden der Mitarbeiterdaten:', error);
                alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
            }
        }

        function editEmployee(employeeId) {
            // Hier könnte ein Modal zum Bearbeiten des Mitarbeiters geöffnet werden
            // oder zur Bearbeitungsseite navigiert werden
            alert('Mitarbeiter bearbeiten: ' + employeeId);
        }

        async function deleteEmployee(employeeId, employeeName) {
            if (confirm(`Sind Sie sicher, dass Sie den Mitarbeiter "${employeeName}" löschen möchten?`)) {
                try {
                    const response = await fetch(`/admin/delete-employee/${employeeId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        }
                    });
                    
                    if (response.ok) {
                        alert(`Mitarbeiter "${employeeName}" wurde erfolgreich gelöscht.`);
                        // Mitarbeiterliste neu laden
                        loadEmployees();
                        // Dashboard-Daten aktualisieren
                        loadDashboardData();
                    } else {
                        const error = await response.json();
                        alert(`Fehler: ${error.message}`);
                    }
                } catch (error) {
                    console.error('Fehler beim Löschen des Mitarbeiters:', error);
                    alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
                }
            }
        }

        // Dokument-Aktionen
        async function uploadDocument() {
            const form = document.getElementById('upload-document-form');
            const formData = new FormData(form);
            
            if (!formData.get('employeeId')) {
                alert('Bitte wählen Sie einen Mitarbeiter aus.');
                return;
            }
            
            if (!formData.get('document')) {
                alert('Bitte wählen Sie ein Dokument aus.');
                return;
            }
            
            try {
                const response = await fetch(`/admin/upload-document/${formData.get('employeeId')}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    alert('Dokument erfolgreich hochgeladen');
                    // Modal schließen
                    hideUploadDocumentModal();
                    // Formular zurücksetzen
                    form.reset();
                    // Dokumente neu laden
                    loadDocuments();
                    // Dashboard-Daten aktualisieren
                    loadDashboardData();
                } else {
                    const error = await response.json();
                    alert(`Fehler: ${error.message}`);
                }
            } catch (error) {
                console.error('Fehler beim Hochladen des Dokuments:', error);
                alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
            }
        }

        async function downloadDocument(documentId) {
            try {
                const response = await fetch(`/documents/${documentId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    
                    // Dateinamen aus Header extrahieren
                    const contentDisposition = response.headers.get('Content-Disposition');
                    const fileName = contentDisposition ? contentDisposition.split('filename=')[1] : 'document.pdf';
                    
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                } else {
                    alert('Fehler beim Herunterladen des Dokuments');
                }
            } catch (error) {
                console.error('Fehler beim Herunterladen des Dokuments:', error);
                alert('Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.');
            }
        }

        function deleteDocument(documentId) {
            if (confirm('Sind Sie sicher, dass Sie dieses Dokument löschen möchten?')) {
                // Hier Löschfunktionalität implementieren
                alert('Dokument löschen: ' + documentId);
            }
        }

        // Abteilungs- und Team-Aktionen
        function saveDepartment() {
            // Hier Speicherfunktionalität implementieren
            alert('Abteilung speichern');
            hideDepartmentModal();
        }

        function saveTeam() {
            // Hier Speicherfunktionalität implementieren
            alert('Team speichern');
            hideTeamModal();
        }

        function editDepartment(departmentId) {
            // Hier Bearbeitungsfunktionalität implementieren
            alert('Abteilung bearbeiten: ' + departmentId);
        }

        function deleteDepartment(departmentId) {
            if (confirm('Sind Sie sicher, dass Sie diese Abteilung löschen möchten?')) {
                // Hier Löschfunktionalität implementieren
                alert('Abteilung löschen: ' + departmentId);
            }
        }

        function viewDepartmentMembers(departmentId) {
            // Hier Anzeigefunktionalität implementieren
            alert('Abteilungsmitglieder anzeigen: ' + departmentId);
        }

        function editTeam(teamId) {
            // Hier Bearbeitungsfunktionalität implementieren
            alert('Team bearbeiten: ' + teamId);
        }

        function deleteTeam(teamId) {
            if (confirm('Sind Sie sicher, dass Sie dieses Team löschen möchten?')) {
                // Hier Löschfunktionalität implementieren
                alert('Team löschen: ' + teamId);
            }
        }

        function manageTeamMembers(teamId) {
            // Hier Verwaltungsfunktionalität implementieren
            alert('Team-Mitglieder verwalten: ' + teamId);
        }

        // Zusätzliche Funktionen für Detailansicht
        async function loadEmployeeTeams(employeeId) {
            try {
                const teamsContainer = document.getElementById('employee-teams');
                if (!teamsContainer) return;
                
                const response = await fetch(`/users/${employeeId}/teams`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const teams = await response.json();
                    
                    if (teams.length === 0) {
                        teamsContainer.textContent = 'Keine Team-Zugehörigkeit';
                        return;
                    }
                    
                    teamsContainer.innerHTML = '';
                    teams.forEach(team => {
                        const badge = document.createElement('span');
                        badge.className = 'badge badge-info';
                        badge.style.marginRight = '5px';
                        badge.textContent = team.name;
                        teamsContainer.appendChild(badge);
                    });
                } else {
                    teamsContainer.textContent = 'Fehler beim Laden der Teams';
                }
            } catch (error) {
                console.error('Fehler beim Laden der Teams:', error);
                const teamsContainer = document.getElementById('employee-teams');
                if (teamsContainer) {
                    teamsContainer.textContent = 'Fehler beim Laden der Teams';
                }
            }
        }

        async function loadEmployeeDocuments(employeeId) {
            try {
                const documentsBody = document.getElementById('employee-documents-body');
                if (!documentsBody) return;
                
                const response = await fetch(`/admin/employee-documents/${employeeId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (response.ok) {
                    const documents = await response.json();
                    
                    if (documents.length === 0) {
                        documentsBody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Keine Dokumente vorhanden</td></tr>';
                        return;
                    }
                    
                    documentsBody.innerHTML = '';
                    documents.forEach(doc => {
                        const row = document.createElement('tr');
                        
                        // Datum formatieren
                        const date = new Date(doc.upload_date).toLocaleString('de-DE', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        row.innerHTML = `
                            <td>${doc.file_name}</td>
                            <td>${date}</td>
                            <td>
                                <button class="primary" style="padding: 3px 8px; font-size: 12px;" onclick="downloadDocument('${doc.id}')">Herunterladen</button>
                            </td>
                        `;
                        
                        documentsBody.appendChild(row);
                    });
                } else {
                    documentsBody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Fehler beim Laden der Dokumente</td></tr>';
                }
            } catch (error) {
                console.error('Fehler beim Laden der Dokumente:', error);
                const documentsBody = document.getElementById('employee-documents-body');
                if (documentsBody) {
                    documentsBody.innerHTML = '<tr><td colspan="3" style="text-align: center;">Fehler beim Laden der Dokumente</td></tr>';
                }
            }
        }
    </script>
</body>
</html>